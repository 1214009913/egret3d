"use strict";var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,a){function s(e){try{c(o.next(e))}catch(t){a(t)}}function i(e){try{c(o["throw"](e))}catch(t){a(t)}}function c(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,i)}c((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,a&&(s=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,a=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){c.label=r[1];break}if(6===r[0]&&c.label<s[1]){c.label=s[1],s=r;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(r);break}s[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(o){r=[6,o],a=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,s,i,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},paper;!function(e){var t;!function(t){var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initialize=function(){},t}(e.Behaviour);t.Bootstrap=r,__reflect(r.prototype,"paper.debug.Bootstrap")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pickTarget=null,t}return __extends(t,e),t.prototype.onDestroy=function(){this.pickTarget=null},t}(e.Behaviour);t.GizmoPickComponent=r,__reflect(r.prototype,"paper.debug.GizmoPickComponent")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r;!function(e){e.SceneSelected="SceneSelected",e.SceneUnselected="SceneUnselected",e.GameObjectHovered="GameObjectHovered",e.GameObjectSelected="GameObjectSelected",e.GameObjectUnselected="GameObjectUnselected"}(r=t.GUIComponentEvent||(t.GUIComponentEvent={}));var o=function(r){function o(){var e=null!==r&&r.apply(this,arguments)||this;return e.selectedGameObjects=[],e.selectedScene=null,e.hoverGameObject=null,e.selectedGameObject=null,e}return __extends(o,r),o.prototype.initialize=function(){r.prototype.initialize.call(this);e.Application.systemManager.getOrRegisterSystem(t.GUISceneSystem)},o.prototype.select=function(t,r){if(t)if(t instanceof e.Scene){if(this.selectedScene===t)return}else if(this.selectedGameObject===t||this.selectedGameObjects.indexOf(t)>=0)return;if((!t||t instanceof e.Scene||this.selectedScene)&&(r=!0),r)if(this.selectedScene){var o=this.selectedScene;this.selectedScene=null,e.EventPool.dispatchEvent("SceneUnselected",this,o)}else if(this.selectedGameObjects.length>0){var n=this.selectedGameObjects.concat();this.selectedGameObjects.length=0,this.selectedGameObject=null;for(var a=0,s=n;a<s.length;a++){var i=s[a];e.EventPool.dispatchEvent("GameObjectUnselected",this,i)}}t&&(t instanceof e.Scene?(this.selectedScene=t,e.EventPool.dispatchEvent("SceneSelected",this,t)):(this.selectedGameObjects.push(t),this.selectedGameObject=t,e.EventPool.dispatchEvent("GameObjectSelected",this,t))),(global||window).psgo=t},o.prototype.unselect=function(t){if(t instanceof e.Scene)this.selectedScene===t&&(this.selectedScene=null,e.EventPool.dispatchEvent("SceneUnselected",this,t));else{var r=this.selectedGameObjects.indexOf(t);r>=0&&(this.selectedGameObject===t&&(this.selectedGameObject=null),this.selectedGameObjects.splice(r,1),e.EventPool.dispatchEvent("GameObjectUnselected",this,t))}},o.prototype.hover=function(t){this.hoverGameObject!==t&&(this.hoverGameObject=t,e.EventPool.dispatchEvent("GameObjectHovered",this,this.hoverGameObject))},o}(e.SingletonComponent);t.GUIComponent=o,__reflect(o.prototype,"paper.debug.GUIComponent"),setTimeout(function(){e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent)},1e3)}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r;!function(e){e[e.TRANSLATE=0]="TRANSLATE",e[e.ROTATE=1]="ROTATE",e[e.SCALE=2]="SCALE"}(r||(r={}));var o;!function(e){e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z",e[e.E=4]="E"}(o||(o={}));var n=function(r){function o(){var o=null!==r&&r.apply(this,arguments)||this;return o._interests=[[{componentClass:egret3d.Transform}]],o._camerasAndLights=e.GameObject.globalGameObject.getOrAddComponent(egret3d.CamerasAndLights),o._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),o._orbitControls=null,o._buttons=0,o._mouseStart=egret3d.Vector3.create(),o._startPoint=egret3d.Vector3.create(),o._endPoint=egret3d.Vector3.create(),o._axises=null,o._hoverBox=null,o._grids=null,o._touchPlane=null,o._cameraViewFrustum=null,o._transformMode=0,o._transformAxis=0,o._pickableSelected=[],o._boxes={},o._pickableTool={},o._gizomsMap={},o._positionStart=egret3d.Vector3.create(),o._startWorldPosition=egret3d.Vector3.create(),o._startWorldQuaternion=egret3d.Quaternion.create(),o._startWorldScale=egret3d.Vector3.create(1,1,1),o._selectedWorldPostion=egret3d.Vector3.create(),o._selectedWorldQuaternion=egret3d.Quaternion.create(),o._cameraPosition=egret3d.Vector3.create(),o._eye=egret3d.Vector3.create(),o._onMouseDown=function(e){var r=egret3d.Vector3.create(e.clientX,e.clientY,0);if(egret3d.InputManager.mouse.convertPosition(r,r),0===e.button){if(2&e.buttons)return;if(0!==o._transformAxis){var n=t.Helper.raycast([o._touchPlane],r.x,r.y),a=o._guiComponent.selectedGameObject;a.transform.getWorldMatrix().decompose(o._startWorldPosition,o._startWorldQuaternion,o._startWorldScale);var s=n[0].position;o._startPoint.copy(s).subtract(o._startWorldPosition,o._startPoint),o._positionStart.copy(a.transform.getPosition())}}else 2===e.button;o._buttons=e.buttons,o._mouseStart.set(e.clientX,e.clientY,0),r.release(),e.preventDefault()},o._onMouseMove=function(r){var n=egret3d.Vector3.create(r.clientX,r.clientY);if(egret3d.InputManager.mouse.convertPosition(n,n),2&r.buttons);else if(1&r.buttons){if(0!==o._transformAxis){var a=t.Helper.raycast([o._touchPlane],n.x,n.y);if(0==a.length)return;var s=o._guiComponent.selectedGameObject;o._orbitControls.enableMove=!1;var i=a[0],c=i.position;if(o._endPoint.copy(c).subtract(o._startWorldPosition,o._endPoint),0===o._transformMode){switch(o._transformAxis){case 1:o._endPoint.y=o._startPoint.y,o._endPoint.z=o._startPoint.z;break;case 2:o._endPoint.x=o._startPoint.x,o._endPoint.z=o._startPoint.z;break;case 3:o._endPoint.x=o._startPoint.x,o._endPoint.y=o._startPoint.y}o._endPoint.subtract(o._startPoint,o._endPoint).add(o._positionStart),s.transform.setPosition(o._endPoint)}else if(1===o._transformMode){var l=egret3d.Camera.editor,d=egret3d.Vector3.create(),u=egret3d.Vector3.create(),m=egret3d.Quaternion.create(),p=egret3d.Vector3.create(),h=20/o._selectedWorldPostion.getDistance(d.applyMatrix(l.gameObject.transform.getWorldMatrix())),f=0;if(4===o._transformAxis)d.copy(o._endPoint).cross(o._startPoint),u.copy(o._eye),f=o._endPoint.getAngle(o._startPoint)*(d.dot(o._eye)<0?1:-1);else{switch(o._transformAxis){case 1:p.set(1,0,0);break;case 2:p.set(0,1,0);break;case 3:p.set(0,0,1)}u.copy(p),o._endPoint.subtract(o._startPoint,o._endPoint),f=o._endPoint.dot(p.cross(o._eye).normalize())*h}m.fromAxis(u,f).multiply(o._startWorldQuaternion),s.transform.setRotation(m),d.release(),u.release(),m.release(),p.release()}else if(2===o._transformMode){var _=o._endPoint.clone().divide(o._startPoint);switch(o._transformAxis){case 1:_.y=1,_.z=1;break;case 2:_.x=1,_.z=1;break;case 3:_.x=1,_.y=1}o._endPoint.copy(o._startWorldScale).multiply(_),s.transform.setScale(o._endPoint)}}}else{if(o._guiComponent.selectedGameObject){var a=t.Helper.raycast(o._pickableTool[o._transformMode],n.x,n.y);if(a.length>0){var g=a[0].transform;switch(g.gameObject.name){case"pickX":o._transformAxis=1;break;case"pickY":o._transformAxis=2;break;case"pickZ":o._transformAxis=3;break;case"pickE":o._transformAxis=4;break;default:o._transformAxis=0}}else o._transformAxis=0}else o._transformAxis=0;if(0===o._transformAxis){var a=t.Helper.raycast(e.Scene.activeScene.getRootGameObjects(),n.x,n.y);a.length>0?o._guiComponent.hover(a[0].transform.gameObject):o._guiComponent.hover(null)}else o._guiComponent.hover(null)}n.release(),r.preventDefault()},o._onMouseUp=function(e){var r=o._buttons&~e.buttons;if(1===r)if(0!==o._transformAxis);else{var n=o._guiComponent.hoverGameObject;if(n&&Math.abs(o._mouseStart.x-e.clientX)<5&&Math.abs(o._mouseStart.y-e.clientY)<5){if(n.renderer instanceof egret3d.SkinnedMeshRenderer&&!n.transform.find("pickHelper")){var a=n.getComponentInParent(egret3d.Animation);if(a){var s=t.EditorMeshHelper.createGameObject("pickHelper",null,null,"Editor Only",n.scene);s.transform.parent=n.transform,s.addComponent(t.GizmoPickComponent).pickTarget=a.gameObject}}var i=n.transform.find("pickHelper");i?o._guiComponent.select(i.gameObject.getComponent(t.GizmoPickComponent).pickTarget,!e.ctrlKey):o._guiComponent.select(n,!e.ctrlKey)}}else 2===r&&(o._orbitControls.enableMove=!0);o._buttons=e.buttons,e.preventDefault()},o._onKeyUp=function(e){switch(e.key){case"Escape":o._guiComponent.select(null);break;case"f":o._guiComponent.selectedGameObject&&(o._orbitControls.lookAtPoint.copy(o._guiComponent.selectedGameObject.transform.position),o._orbitControls.distance=10,o._orbitControls.lookAtOffset.set(0,0,0));break;case"w":o._transformModeHandler(0);break;case"e":o._transformModeHandler(1);break;case"r":o._transformModeHandler(2)}},o._onKeyDown=function(e){},o._onGameObjectSelected=function(e,t){o._selectGameObject(t,!0)},o._onGameObjectHovered=function(e,t){t?(o._hoverBox.activeSelf=!0,o._hoverBox.scene!==t.scene&&(o._hoverBox.dontDestroy=!0,o._hoverBox.dontDestroy=!1),o._hoverBox.parent=t):(o._hoverBox.activeSelf=!1,o._hoverBox.parent=null)},o._onGameObjectUnselected=function(e,t){o._selectGameObject(t,!1)},o}return __extends(o,r),o.prototype._selectGameObject=function(e,r){if(r){this._axises.activeSelf=!0;var o=t.EditorMeshHelper.createBox("Box",egret3d.Color.create(0,1,1).release(),e.scene);o.activeSelf=!1,o.parent=e,this._boxes[e.uuid]=o}else{this._transformAxis=0,this._axises.activeSelf=!1;var o=this._boxes[e.uuid];if(!o)throw new Error;delete this._boxes[e.uuid],o.destroy()}},o.prototype._transformModeHandler=function(e){this._transformMode=e,this._axises.transform.find("translate").gameObject.activeSelf=0===e,this._axises.transform.find("rotate").gameObject.activeSelf=1===e,this._axises.transform.find("scale").gameObject.activeSelf=2===e},o.prototype._setPoint=function(e,t,r,o,n,a){var s=egret3d.Vector3.create(),i=egret3d.Matrix4.create();if(s.set(r,o,n).applyMatrix(i.inverse(e)).applyMatrix(egret3d.Matrix4.IDENTITY),void 0!==a)for(var c=0,l=a.length;l>c;c++){var d=3*a[c];t[d+0]=s.x,t[d+1]=s.y,t[d+2]=s.z}s.release(),i.release()},o.prototype._updateAxises=function(){if(this._axises.activeSelf){this._axises.transform.position=this._selectedWorldPostion;var e=this._selectedWorldPostion.getDistance(this._cameraPosition),t=(this._axises.transform.find("translate"),this._axises.transform.find("rotate"));this._axises.transform.find("scale");if(this._axises.transform.setScale(egret3d.Vector3.ONE.clone().multiplyScalar(e/10).release()),0===this._transformMode||2===this._transformMode);else if(1===this._transformMode){var r=egret3d.Quaternion.IDENTITY,o=r.clone(),n=egret3d.Quaternion.create(),a=this._eye.clone();a.applyQuaternion(o.inverse());var s=t.find("axisE"),i=t.find("pickE");n.fromMatrix(egret3d.Matrix4.create().lookAt(this._eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release()),s.setRotation(n),i.setRotation(n);var c=t.find("axisX");n.copy(o).fromAxis(egret3d.Vector3.RIGHT,Math.atan2(-a.y,a.z)),n.multiply(r),c.setRotation(n);var l=t.find("axisY");n.copy(o).fromAxis(egret3d.Vector3.UP,Math.atan2(a.x,a.z)),n.multiply(r),l.setRotation(n);var d=t.find("axisZ");n.copy(o).fromAxis(egret3d.Vector3.FORWARD,Math.atan2(a.y,a.x)),n.multiply(r),d.setRotation(n),o.release(),n.release(),a.release()}}this._guiComponent.selectedGameObject&&this._guiComponent.selectedGameObject.transform.getLocalEulerAngles()},o.prototype._updateBoxes=function(){for(var e=0,t=this._guiComponent.selectedGameObjects;e<t.length;e++){var r=t[e],o=this._boxes[r.uuid];if(!o)throw new Error;r.renderer?(o.activeSelf=!0,o.transform.localPosition=r.renderer.aabb.center,o.transform.localScale=r.renderer.aabb.size):o.activeSelf=!1}if(this._hoverBox.activeSelf){var n=this._hoverBox.parent.renderer;n?(this._hoverBox.transform.localPosition=n.aabb.center,this._hoverBox.transform.localScale=n.aabb.size):this._hoverBox.activeSelf=!1}},o.prototype._updateCameras=function(){for(var e=0,r=this._camerasAndLights.cameras;e<r.length;e++){var o=r[e];if("Editor Only"!==o.gameObject.tag){var n=o.transform.find("__editor");if(n){var a=this._selectedWorldPostion.getDistance(this._cameraPosition),s=egret3d.Quaternion.create();s.fromMatrix(egret3d.Matrix4.create().lookAt(this._eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release()),n.transform.setLocalScale(egret3d.Vector3.ONE.clone().multiplyScalar(a/40).release()),n.transform.setRotation(s)}else n=t.EditorMeshHelper.createCameraIcon("__editor",o.gameObject).transform,n.parent=o.gameObject.transform;var i=n.transform.find("pick").gameObject;this._pickableSelected.indexOf(i)<0&&this._pickableSelected.push(i)}}var c=this._guiComponent.selectedGameObject?this._guiComponent.selectedGameObject.getComponent(egret3d.Camera):null;if(c){this._cameraViewFrustum.transform.position=c.gameObject.transform.position,this._cameraViewFrustum.transform.rotation=c.gameObject.transform.rotation,this._cameraViewFrustum.activeSelf=!0;var l=this._cameraViewFrustum.getComponent(egret3d.MeshFilter).mesh,d=egret3d.Matrix4.create(),u={x:0,y:0,w:0,h:0};c.calcViewPortPixel(u),c.calcProjectMatrix(u.w/u.h,d);var m=l.getVertices();this._setPoint(d,m,0,0,-1,[38,41]),this._setPoint(d,m,0,0,1,[39]),this._setPoint(d,m,-1,-1,-1,[0,7,16,25]),this._setPoint(d,m,1,-1,-1,[1,2,18,27]),this._setPoint(d,m,-1,1,-1,[5,6,20,29]),this._setPoint(d,m,1,1,-1,[3,4,22,31]),this._setPoint(d,m,-1,-1,1,[8,15,17]),this._setPoint(d,m,1,-1,1,[9,10,19]),this._setPoint(d,m,-1,1,1,[13,14,21]),this._setPoint(d,m,1,1,1,[11,12,23]),this._setPoint(d,m,.7,1.1,-1,[32,37]),this._setPoint(d,m,-.7,1.1,-1,[33,34]),this._setPoint(d,m,0,2,-1,[35,36]),this._setPoint(d,m,-1,0,1,[42]),this._setPoint(d,m,1,0,1,[43]),this._setPoint(d,m,0,-1,1,[44]),this._setPoint(d,m,0,1,1,[45]),this._setPoint(d,m,-1,0,-1,[46]),this._setPoint(d,m,1,0,-1,[47]),this._setPoint(d,m,0,-1,-1,[48]),this._setPoint(d,m,0,1,-1,[49]),l.uploadVertexBuffer("POSITION"),d.release()}else this._cameraViewFrustum.activeSelf=!1},o.prototype._updateLights=function(){for(var e=0,r=this._camerasAndLights.lights;e<r.length;e++){var o=r[e];if("Editor Only"!==o.gameObject.tag){var n=o.transform.find("__editor");if(n){var a=this._selectedWorldPostion.getDistance(this._cameraPosition),s=egret3d.Quaternion.create();s.fromMatrix(egret3d.Matrix4.create().lookAt(this._eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release()),n.transform.setLocalScale(egret3d.Vector3.ONE.clone().multiplyScalar(a/40).release()),n.transform.setRotation(s)}else n=t.EditorMeshHelper.createLightIcon("__editor",o.gameObject).transform,n.parent=o.gameObject.transform;var i=n.transform.find("pick").gameObject;this._pickableSelected.indexOf(i)<0&&this._pickableSelected.push(i)}}},o.prototype._updateTouchPlane=function(){if(this._guiComponent.selectedGameObject&&this._touchPlane&&!this._touchPlane.isDestroyed){var e=egret3d.Camera.editor,t=this._guiComponent.selectedGameObject.transform.getPosition(),r=t.clone(),o=egret3d.Quaternion.create(),n=egret3d.Vector3.create(1,0,0),a=egret3d.Vector3.create(0,1,0),s=egret3d.Vector3.create(0,0,1);n.set(1,0,0).applyQuaternion(egret3d.Quaternion.IDENTITY),a.set(0,1,0).applyQuaternion(egret3d.Quaternion.IDENTITY),s.set(0,0,1).applyQuaternion(egret3d.Quaternion.IDENTITY);var i=a.clone(),c=egret3d.Vector3.create(),l=e.transform.getPosition().clone();switch(e.opvalue>0&&l.subtract(t,l),l.normalize(),this._transformMode){case 0:case 2:switch(this._transformAxis){case 1:i.copy(l).cross(n),c.copy(n).cross(i);break;case 2:i.copy(l).cross(a),c.copy(a).cross(i);break;case 3:i.copy(l).cross(s),c.copy(s).cross(i)}break;case 1:default:c.set(0,0,0)}if(0===c.length){var d=e.transform.getRotation();o.copy(d)}else{var u=egret3d.Matrix4.create(),m=egret3d.Vector3.create();u.lookAt(m.set(0,0,0),c,i),o.fromMatrix(u),m.release(),u.release()}this._touchPlane.transform.setPosition(r),this._touchPlane.transform.setRotation(o),r.release(),n.release(),a.release(),s.release(),i.release(),c.release(),o.release(),l.release()}},o.prototype.onAwake=function(){egret3d.WebGLCapabilities.canvas.addEventListener("contextmenu",function(e){e.preventDefault()}),this._axises=t.EditorMeshHelper.createAxises("Axis"),this._axises.activeSelf=!1,this._hoverBox=t.EditorMeshHelper.createBox("HoverBox",egret3d.Color.WHITE,e.Scene.activeScene),this._hoverBox.activeSelf=!1},o.prototype.onEnable=function(){e.Application.playerMode=1,this._orbitControls=egret3d.Camera.editor.gameObject.getOrAddComponent(t.OrbitControls),this._grids||(this._grids=t.EditorMeshHelper.createGrid("Grid")),this._touchPlane||(this._touchPlane=t.EditorMeshHelper.createTouchPlane("TouchPlane"),this._touchPlane.activeSelf=!1),this._cameraViewFrustum||(this._cameraViewFrustum=t.EditorMeshHelper.createCameraWireframed("Camera"),this._cameraViewFrustum.activeSelf=!1),this._transformAxis=0,this._gizomsMap[1]=[],this._pickableTool[0]=[],this._pickableTool[0].push(this._axises.transform.find("translate").find("pickX").gameObject),this._pickableTool[0].push(this._axises.transform.find("translate").find("pickY").gameObject),this._pickableTool[0].push(this._axises.transform.find("translate").find("pickZ").gameObject),this._pickableTool[1]=[],this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickX").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickY").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickZ").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickE").gameObject),this._pickableTool[2]=[],this._pickableTool[2].push(this._axises.transform.find("scale").find("pickX").gameObject),this._pickableTool[2].push(this._axises.transform.find("scale").find("pickY").gameObject),this._pickableTool[2].push(this._axises.transform.find("scale").find("pickZ").gameObject),this._pickableSelected.length=0,e.EventPool.addEventListener("GameObjectHovered",t.GUIComponent,this._onGameObjectHovered),e.EventPool.addEventListener("GameObjectSelected",t.GUIComponent,this._onGameObjectSelected),e.EventPool.addEventListener("GameObjectUnselected",t.GUIComponent,this._onGameObjectUnselected);var r=egret3d.WebGLCapabilities.canvas;r.addEventListener("mousedown",this._onMouseDown),r.addEventListener("mousemove",this._onMouseMove),r.addEventListener("mouseup",this._onMouseUp),window.addEventListener("keyup",this._onKeyUp),window.addEventListener("keydown",this._onKeyDown),this._transformModeHandler(this._transformMode)},o.prototype.onDisable=function(){egret3d.Camera.editor.gameObject.removeComponent(t.OrbitControls),this._orbitControls=null;for(var r=0,o=this._camerasAndLights.cameras;r<o.length;r++){var n=o[r];if("Editor Only"!==n.gameObject.tag){var a=n.transform.find("__editor");a&&a.gameObject.destroy()}}e.EventPool.removeEventListener("GameObjectHovered",t.GUIComponent,this._onGameObjectHovered),e.EventPool.removeEventListener("GameObjectSelected",t.GUIComponent,this._onGameObjectSelected),e.EventPool.removeEventListener("GameObjectUnselected",t.GUIComponent,this._onGameObjectUnselected);var s=egret3d.WebGLCapabilities.canvas;s.removeEventListener("mousedown",this._onMouseDown),s.removeEventListener("mouseup",this._onMouseUp),s.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keydown",this._onKeyDown),this._touchPlane&&!this._touchPlane.isDestroyed&&(this._touchPlane.destroy(),this._touchPlane=null),this._grids&&!this._grids.isDestroyed&&(this._grids.destroy(),this._grids=null),this._cameraViewFrustum&&!this._cameraViewFrustum.isDestroyed&&(this._cameraViewFrustum.destroy(),this._cameraViewFrustum=null),this._pickableSelected.length=0,e.Application.playerMode=0},o.prototype.onUpdate=function(e){for(var t=0,r=this._guiComponent.selectedGameObjects;t<r.length;t++){var o=r[t];o.isDestroyed&&this._guiComponent.select(null)}var n=this._guiComponent.selectedGameObject;n&&(this._selectedWorldPostion.copy(n.transform.getPosition()),this._selectedWorldQuaternion.copy(n.transform.getRotation())),this._pickableSelected.length=0,this._touchPlane&&this._touchPlane.isDestroyed&&(this._touchPlane=null),this._grids&&this._grids.isDestroyed&&(this._grids=null),this._cameraViewFrustum&&(this._cameraViewFrustum.isDestroyed?this._cameraViewFrustum=null:this._cameraViewFrustum.activeSelf=n?!0:!1);var a=egret3d.Camera.editor;this._cameraPosition.copy(a.transform.getPosition()),0==a.opvalue?this._eye.copy(this._cameraPosition).normalize():this._eye.copy(this._cameraPosition).subtract(this._selectedWorldPostion).normalize(),this._updateAxises(),this._updateBoxes(),this._updateCameras(),this._updateLights(),this._updateTouchPlane()},o}(e.BaseSystem);t.GUISceneSystem=n,__reflect(n.prototype,"paper.debug.GUISceneSystem")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(r){function o(){var o=null!==r&&r.apply(this,arguments)||this;return o._interests=[[{componentClass:egret3d.Transform}]],o._disposeCollecter=e.GameObject.globalGameObject.getOrAddComponent(e.DisposeCollecter),o._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),o._bufferedGameObjects=[],o._hierarchyFolders={},o._inspectorFolders={},o._selectFolder=null,o._sceneSelectedHandler=function(e,t){o._selectSceneOrGameObject(t)},o._sceneUnselectedHandler=function(e,t){o._selectSceneOrGameObject(null)},o._gameObjectSelectedHandler=function(e,t){o._selectSceneOrGameObject(t)},o._gameObjectUnselectedHandler=function(e,t){o._selectSceneOrGameObject(null)},o._createGameObject=function(){if(o._guiComponent.selectedScene){var e=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",o._guiComponent.selectedScene);o._guiComponent.select(e,!0)}else{var e=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",o._guiComponent.selectedGameObject.scene);e.transform.parent=o._guiComponent.selectedGameObject.transform,o._guiComponent.select(e,!0)}},o._destroySceneOrGameObject=function(){var e=o._guiComponent.inspector.instance;e&&(o._guiComponent.select(null),e.destroy())},o._nodeClickHandler=function(e){o._guiComponent.select(e.instance,!0)},o}return __extends(o,r),o.prototype._openFolder=function(e){e.open(),e.parent&&e.parent!==this._guiComponent.hierarchy&&this._openFolder(e.parent)},o.prototype._selectSceneOrGameObject=function(t){if(this._selectFolder&&(this._selectFolder.selected=!1,this._selectFolder=null),this._guiComponent.inspector.instance=t,t)if(t instanceof e.Scene)this._guiComponent.inspector.add(this,"_createGameObject","createObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);else{this._guiComponent.inspector.add(this,"_createGameObject","createChildObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);for(var r=0,o=t.components;r<o.length;r++){var n=o[r],a=this._guiComponent.inspector.addFolder(n.uuid,egret.getQualifiedClassName(n));a.instance=n,this._inspectorFolders[n.uuid]=a,this._addToInspector(a)}}else{for(var s in this._inspectorFolders)delete this._inspectorFolders[s];if(this._guiComponent.inspector.__controllers)for(var i=0,c=this._guiComponent.inspector.__controllers.concat();i<c.length;i++){var l=c[i];this._guiComponent.inspector.remove(l)}if(this._guiComponent.inspector.__folders)for(var s in this._guiComponent.inspector.__folders)this._guiComponent.inspector.removeFolder(this._guiComponent.inspector.__folders[s])}},o.prototype._addToHierarchy=function(e){if(!(e.uuid in this._hierarchyFolders||"Editor Only"===e.tag||2===e.hideFlags||3===e.hideFlags)){var t=this._hierarchyFolders[e.transform.parent?e.transform.parent.gameObject.uuid:e.scene.uuid];if(!t){if(e.transform.parent)throw new Error;t=this._guiComponent.hierarchy.addFolder(e.scene.uuid,e.scene.name+" <Scene>"),t.instance=e.scene,t.onClick=this._nodeClickHandler,this._hierarchyFolders[e.scene.uuid]=t}var r=t.addFolder(e.uuid,e.name);r.instance=e,r.onClick=this._nodeClickHandler,this._hierarchyFolders[e.uuid]=r}},o.prototype._addToInspector=function(t){for(var r,o,n,a=e.editor.getEditInfo(t.instance),s=function(e){switch(e.editType){case 0:r=i._guiComponent.inspector.add(t.instance,e.name).min(0).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 1:r=i._guiComponent.inspector.add(t.instance,e.name).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 2:r=i._guiComponent.inspector.add(t.instance,e.name).step(.1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 4:case 3:i._guiComponent.inspector.add(t.instance,e.name).listen();break;case 10:i._guiComponent.inspector.add(t.instance,e.name,e.option.listItems).listen();break;case 5:var a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(a)if(a.get&&a.set){var s=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),r.onChange(s),o.onChange(s)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen();break;case 6:var a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(a){if(a.get&&a.set){var s=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen(),r.onChange(s),o.onChange(s),n.onChange(s)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen();e.option&&(void 0!==e.option.minimum&&(r.min(e.option.minimum),o.min(e.option.minimum),n.min(e.option.minimum)),void 0!==e.option.maximum&&(r.max(e.option.maximum),o.max(e.option.maximum),n.max(e.option.maximum)),void 0!==e.option.step&&(r.step(e.option.step),o.step(e.option.step),n.step(e.option.step)))}break;case 7:case 8:break;case 9:break;case 11:break;case 14:}},i=this,c=0,l=a;c<l.length;c++){var d=l[c];s(d)}},o.prototype.onAwake=function(){},o.prototype.onEnable=function(){e.EventPool.addEventListener("SceneSelected",t.GUIComponent,this._sceneSelectedHandler),e.EventPool.addEventListener("SceneUnselected",t.GUIComponent,this._sceneUnselectedHandler),e.EventPool.addEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.addEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler),this._guiComponent.select(e.Scene.activeScene),this._bufferedGameObjects.push(e.GameObject.globalGameObject);for(var r=0,o=this._groups[0].gameObjects;r<o.length;r++){var n=o[r];this._bufferedGameObjects.push(n)}},o.prototype.onAddGameObject=function(e,t){this._bufferedGameObjects.push(e)},o.prototype.onUpdate=function(e){for(var t=0;this._bufferedGameObjects.length>0&&t++<5;)this._addToHierarchy(this._bufferedGameObjects.shift());if(!this._selectFolder){var r=this._guiComponent.selectedScene||this._guiComponent.selectedGameObject;r&&r.uuid in this._hierarchyFolders&&(this._selectFolder=this._hierarchyFolders[r.uuid],this._selectFolder.selected=!0,this._openFolder(this._selectFolder.parent))}if(this._guiComponent.inspector.updateDisplay(),this._guiComponent.inspector.__folders)for(var o in this._guiComponent.inspector.__folders)this._guiComponent.inspector.__folders[o].updateDisplay();for(var n=0,a=this._disposeCollecter.scenes;n<a.length;n++){var s=a[n],i=this._hierarchyFolders[s.uuid];if(delete this._hierarchyFolders[s.uuid],i&&i.parent)try{i.parent.removeFolder(i)}catch(c){}}for(var l=0,d=this._disposeCollecter.gameObjects;l<d.length;l++){var u=d[l],i=this._hierarchyFolders[u.uuid];if(delete this._hierarchyFolders[u.uuid],i&&i.parent)try{i.parent.removeFolder(i)}catch(c){}}for(var m=0,p=this._disposeCollecter.components;m<p.length;m++){var h=p[m],i=this._inspectorFolders[h.uuid];if(delete this._inspectorFolders[h.uuid],i&&i.parent)try{i.parent.removeFolder(i)}catch(c){}}},o.prototype.onRemoveGameObject=function(e,t){var r=this._bufferedGameObjects.indexOf(e);r>=0&&(this._bufferedGameObjects[r]=null)},o.prototype.onDisable=function(){e.EventPool.removeEventListener("SceneSelected",t.GUIComponent,this._sceneSelectedHandler),e.EventPool.removeEventListener("SceneUnselected",t.GUIComponent,this._sceneUnselectedHandler),e.EventPool.removeEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.removeEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler);for(var r in this._hierarchyFolders){var o=this._hierarchyFolders[r];if(delete this._hierarchyFolders[r],o&&o.parent)try{o.parent.removeFolder(o)}catch(n){}}for(var r in this._inspectorFolders)delete this._inspectorFolders[r];this._bufferedGameObjects.length=0,this._selectFolder=null},o}(e.BaseSystem);t.GUISystem=r,__reflect(r.prototype,"paper.debug.GUISystem")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=(new egret3d.Vector2,new egret3d.Vector2,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lookAtPoint=egret3d.Vector3.create(0,0,0),t.lookAtOffset=egret3d.Vector3.create(),t.distance=30,t.minPanAngle=-(1/0),t.maxPanAngle=1/0,t.minTileAngle=-90,t.maxTileAngle=90,t.moveSpped=.001,t.scaleSpeed=.2,t._enableMove=!0,t._mouseDown=!1,t._fingerTwo=!1,t._panAngle=0,t._panRad=0,t._tiltAngle=0,t._tiltRad=0,t._mouseDownHandler=function(e){2===e.button&&(t._mouseDown=!0,t._lastMouseX=e.x,t._lastMouseY=e.y,e.preventDefault())},t._mouseUpHandler=function(e){2===e.button&&(t._mouseDown=!1,e.preventDefault())},t._mouseMoveHandler=function(e){if(t._mouseDown&&t._enableMove){var r=egret3d.Vector3.create(e.x-t._lastMouseX,e.y-t._lastMouseY,0);if(e.ctrlKey){r.x=-r.x;var o=t.lookAtTarget?t.lookAtTarget.getPosition():t.lookAtPoint,n=t.gameObject.transform.getPosition().getDistance(o),a=egret3d.Matrix3.create();
r.multiplyScalar(n*t.moveSpped).applyMatrix3(a.getNormalMatrix(t.gameObject.transform.getLocalMatrix())),a.release(),t.lookAtOffset.add(r)}else t.panAngle+=r.x,t.tiltAngle+=r.y;t._lastMouseX=e.x,t._lastMouseY=e.y,r.release(),e.preventDefault()}},t._mouseWheelHandler=function(e){t.distance=Math.max(t.distance-(e.wheelDelta>0?2:-2),1),e.preventDefault()},t}return __extends(t,e),Object.defineProperty(t.prototype,"panAngle",{get:function(){return this._panAngle},set:function(e){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,e)),this._panRad=this._panAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(e){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,e)),this._tiltRad=this._tiltAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableMove",{get:function(){return this._enableMove},set:function(e){this._enableMove!==e&&(this._enableMove=e)},enumerable:!0,configurable:!0}),t.prototype.onStart=function(){this.bindTouch=egret3d.InputManager.touch,this.bindMouse=egret3d.InputManager.mouse,this.bindMouse.disableContextMenu()},t.prototype.onEnable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.addEventListener("mousedown",this._mouseDownHandler),e.addEventListener("mouseup",this._mouseUpHandler),e.addEventListener("mouseout",this._mouseUpHandler),e.addEventListener("dblclick",this._mouseUpHandler),e.addEventListener("mousemove",this._mouseMoveHandler),e.addEventListener("wheel",this._mouseWheelHandler))},t.prototype.onDisable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseout",this._mouseUpHandler),e.removeEventListener("dblclick",this._mouseUpHandler),e.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("wheel",this._mouseWheelHandler))},t.prototype.onUpdate=function(e){this._enableMove&&this.move()},t.prototype.move=function(){var e=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),t=this.distance*(0===this._tiltRad?0:Math.sin(this._tiltRad)),r=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),o=egret3d.Vector3.create();this.lookAtTarget?o.copy(this.lookAtTarget.getPosition()):o.copy(this.lookAtPoint),o.add(this.lookAtOffset),this.gameObject.transform.setPosition(o.x+e,o.y+t,o.z+r),this.gameObject.transform.lookAt(o),o.release()},t}(e.Behaviour));t.OrbitControls=r,__reflect(r.prototype,"paper.debug.OrbitControls")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(){function r(){}return r.createGameObject=function(t,r,o,n,a){void 0===r&&(r=null),void 0===o&&(o=null),void 0===n&&(n="Editor Only"),void 0===a&&(a=e.Scene.editorScene);var s=e.GameObject.create(t,n,a);return s.hideFlags=3,r&&(s.addComponent(egret3d.MeshFilter).mesh=r),o&&(s.addComponent(egret3d.MeshRenderer).material=o),s},r.createGrid=function(e,t,r,o,n){void 0===t&&(t=50),void 0===r&&(r=50),void 0===o&&(o=egret3d.Color.create(.26,.26,.26)),void 0===n&&(n=egret3d.Color.create(.53,.53,.53));for(var a=r/2,s=t/r,i=t/2,c=[],l=[],d=0,u=-i;r>=d;d++,u+=s){c.push(-i,0,u),c.push(i,0,u),c.push(u,0,-i),c.push(u,0,i);var m=d===a?o:n;l.push(m.r,m.g,m.b,m.a),l.push(m.r,m.g,m.b,m.a),l.push(m.r,m.g,m.b,m.a),l.push(m.r,m.g,m.b,m.a)}for(var p=0;p<l.length;p+=80)for(var h=0;16>h;h++)l[p+h]=.26;var f=new egret3d.Mesh(c.length,0,["POSITION","COLOR_0"]);f.setAttributes("POSITION",c),f.setAttributes("COLOR_0",l),f.glTFMesh.primitives[0].mode=1;var _=this.createGameObject(e,f,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return _},r.createTouchPlane=function(e,t,r){void 0===t&&(t=5e5),void 0===r&&(r=5e5);var o=this.createGameObject(e,egret3d.DefaultMeshes.createPlane(t,r),egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return o},r.createAxises=function(e){var t=this.createGameObject(e),r=this.createGameObject("translate");r.transform.setParent(t.transform);var o=this.createGameObject("axisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),n=this.createGameObject("axisY",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this.createGameObject("axisZ",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=this.createGameObject("arrowX",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=this.createGameObject("arrowY",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this.createGameObject("arrowZ",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this.createGameObject("pickX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this.createGameObject("pickY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),u=this.createGameObject("pickZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone());o.transform.setParent(r.transform),n.transform.setParent(r.transform).setLocalEuler(0,0,.5*Math.PI),a.transform.setParent(r.transform).setLocalEuler(0,.5*-Math.PI,0),s.transform.setParent(o.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),i.transform.setParent(n.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),c.transform.setParent(a.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),l.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.RIGHT.clone().multiplyScalar(.5)).setLocalScale(1.2,.1,.1),d.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.UP.clone().multiplyScalar(.5)).setLocalScale(.1,1.2,.1),u.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.FORWARD.clone().multiplyScalar(.5)).setLocalScale(.1,.1,1.2),l.activeSelf=d.activeSelf=u.activeSelf=!1,o.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),n.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),s.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),i.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),u.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3);var m=this.createGameObject("rotate");m.transform.setParent(t.transform);var o=this.createGameObject("axisX",egret3d.DefaultMeshes.createCircle(1,.5,1),egret3d.DefaultMaterials.MESH_BASIC.clone()),n=this.createGameObject("axisY",egret3d.DefaultMeshes.createCircle(1,.5,2),egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this.createGameObject("axisZ",egret3d.DefaultMeshes.createCircle(1,.5,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),p=this.createGameObject("axisE",egret3d.DefaultMeshes.createCircle(1.25,1,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this.createGameObject("pickX",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this.createGameObject("pickY",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),u=this.createGameObject("pickZ",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),h=this.createGameObject("pickE",egret3d.DefaultMeshes.createTorus(1.25,.1,2,24),egret3d.DefaultMaterials.MESH_BASIC.clone());o.transform.setParent(m.transform),n.transform.setParent(m.transform),a.transform.setParent(m.transform),p.transform.setParent(m.transform),l.transform.setParent(m.transform).setLocalEuler(0,.5*-Math.PI,.5*-Math.PI),d.transform.setParent(m.transform).setLocalEuler(.5*Math.PI,0,0),u.transform.setParent(m.transform).setLocalEuler(0,0,.5*-Math.PI),h.transform.setParent(m.transform).setLocalEuler(0,0,0),l.activeSelf=d.activeSelf=u.activeSelf=h.activeSelf=!1,o.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),n.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),p.renderer.material.setColor("diffuse",egret3d.Color.YELLOW).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),u.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),h.renderer.material.setColor("diffuse",egret3d.Color.YELLOW).setDepth(!1,!1).setRenderQueue(4e3);var f=this.createGameObject("scale");f.transform.setParent(t.transform);var o=this.createGameObject("axisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),n=this.createGameObject("axisY",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this.createGameObject("axisZ",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=this.createGameObject("arrowX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=this.createGameObject("arrowY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this.createGameObject("arrowZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this.createGameObject("pickX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this.createGameObject("pickY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),u=this.createGameObject("pickZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone());return o.transform.setParent(f.transform),n.transform.setParent(f.transform).setLocalEuler(0,0,.5*Math.PI),a.transform.setParent(f.transform).setLocalEuler(0,.5*-Math.PI,0),s.transform.setParent(o.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),i.transform.setParent(n.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),c.transform.setParent(a.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),l.transform.setParent(f.transform).setLocalPosition(egret3d.Vector3.RIGHT.clone().multiplyScalar(.5)).setLocalScale(1.2,.2,.2),d.transform.setParent(f.transform).setLocalPosition(egret3d.Vector3.UP.clone().multiplyScalar(.5)).setLocalScale(.2,1.2,.2),u.transform.setParent(f.transform).setLocalPosition(egret3d.Vector3.FORWARD.clone().multiplyScalar(.5)).setLocalScale(.2,.2,1.2),l.activeSelf=d.activeSelf=u.activeSelf=!1,o.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),n.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),s.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),i.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),u.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),t},r.createBox=function(e,t,r){var o=this.createGameObject(e,egret3d.DefaultMeshes.CUBE_LINE,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone(),"Editor Only",r);return o.getComponent(egret3d.MeshRenderer).material.setColor("diffuse",t),o},r.createCameraIcon=function(e,r){var o=new egret3d.Material(egret3d.DefaultShaders.TRANSPARENT);o.renderQueue=4e3,o.setTexture("map",egret3d.DefaultTextures.CAMERA_ICON);var n=this.createGameObject(e,null,null,r.tag,r.scene),a=this.createGameObject("pick",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone(),r.tag,r.scene);a.transform.setParent(n.transform);var s=this.createGameObject("icon",egret3d.DefaultMeshes.QUAD,o,r.tag,r.scene);return s.transform.setParent(n.transform),a.activeSelf=!1,a.addComponent(t.GizmoPickComponent).pickTarget=r,n.transform.setParent(r.transform),n},r.createLightIcon=function(e,r){var o=new egret3d.Material(egret3d.DefaultShaders.TRANSPARENT);o.renderQueue=4e3,o.setTexture("map",egret3d.DefaultTextures.LIGHT_ICON),o.setColor("diffuse",egret3d.Color.RED);var n=this.createGameObject(e,null,null,r.tag,r.scene),a=this.createGameObject("pick",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone(),r.tag,r.scene);a.transform.setParent(n.transform);var s=this.createGameObject("icon",egret3d.DefaultMeshes.QUAD,o,r.tag,r.scene);return s.transform.setParent(n.transform),a.activeSelf=!1,a.addComponent(t.GizmoPickComponent).pickTarget=r,n.transform.setParent(r.transform),n},r.createCameraWireframed=function(e,t,r,o,n,a){void 0===t&&(t=egret3d.Color.create(1,.7,0)),void 0===r&&(r=egret3d.Color.RED),void 0===o&&(o=egret3d.Color.create(0,.7,1)),void 0===n&&(n=egret3d.Color.WHITE),void 0===a&&(a=egret3d.Color.create(.2,.2,.2));for(var s=[],i=[],c=50,l=0;c>l;l++)s.push(0,0,0),24>l?i.push(t.r,t.g,t.b,t.a):32>l?i.push(r.r,r.g,r.b,r.a):38>l?i.push(o.r,o.g,o.b,o.a):40>l?i.push(n.r,n.g,n.b,n.a):i.push(a.r,a.g,a.b,a.a);var d=new egret3d.Mesh(c,0,["POSITION","COLOR_0"]);d.setAttributes("POSITION",s),d.setAttributes("COLOR_0",i),d.glTFMesh.primitives[0].mode=1;var u=this.createGameObject(e,d,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return u},r}();t.EditorMeshHelper=r,__reflect(r.prototype,"paper.debug.EditorMeshHelper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(e){var t=function(){function e(){}return e._raycast=function(e,t,r){if(3===t.hideFlags&&"Editor Only"===t.tag?!t.activeInHierarchy:t.activeInHierarchy){var o=egret3d.RaycastInfo.create();if(t.renderer&&t.renderer.raycast(e,o,!0))o.transform=t.transform,r.push(o);else{o.release();for(var n=0,a=t.transform.children;n<a.length;n++){var s=a[n];this._raycast(e,s.gameObject,r)}}}},e.raycast=function(e,t,r){for(var o=egret3d.Camera.editor,n=o.createRayByScreen(t,r),a=[],s=0,i=e;s<i.length;s++){var c=i[s];this._raycast(n,c,a)}return n.release(),a.sort(function(e,t){return e.distance-t.distance}),a},e}();e.Helper=t,__reflect(t.prototype,"paper.debug.Helper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var helper;!function(e){function t(e){for(var t=e.substr(e.lastIndexOf("/")+1),r=t.indexOf(".",0),o="";r>=0;){if(o=t.substr(r),".vs.glsl"==o)return"GLVertexShader";if(".assetbundle.json"==o)return"Bundle";if(".fs.glsl"==o)return"GLFragmentShader";if(".png"==o||".jpg"==o)return"Texture";if(".pvr.bin"==o||".pvr"==o)return"PVR";if(".prefab.json"==o)return"Prefab";if(".scene.json"==o)return"Scene";if(".atlas.json"==o)return"Atlas";if(".font.json"==o)return"Font";if(".json"==o||".txt"==o||".effect.json"==o)return"TextAsset";if(".packs.bin"==o)return"PackBin";if(".packs.txt"==o)return"PackTxt";if(".path.json"==o)return"pathAsset";if(".mp3"==o||".ogg"==o)return"Sound";if(".shader.json"==o)return"Shader";if(".image.json"==o)return"TextureDesc";if(".mat.json"==o)return"Material";if(".mesh.bin"==o)return"Mesh";if(".ani.bin"==o)return"Animation";r=t.indexOf(".",r+1)}return"Unknown"}function r(e,r){return void 0===r&&(r="resource/"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return o?[3,2]:[4,RES.loadConfig("resource/default.res.json",r)];case 1:n.sent(),o=!0,n.label=2;case 2:return[2,new Promise(function(o){RES.getResByUrl(r+e,function(e){paper.Asset.register(e),o()},RES,t(e))})]}})})}var o=!1;e.getResAsync=r}(helper||(helper={}));