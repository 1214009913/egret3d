"use strict";var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))(function(a,o){function n(e){try{c(s.next(e))}catch(t){o(t)}}function i(e){try{c(s["throw"](e))}catch(t){o(t)}}function c(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(n,i)}c((s=s.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return s([e,t])}}function s(r){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,o&&(n=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[0,n.value]),r[0]){case 0:case 1:n=r;break;case 4:return c.label++,{value:r[1],done:!1};case 5:c.label++,o=r[1],r=[0];continue;case 7:r=c.ops.pop(),c.trys.pop();continue;default:if(n=c.trys,!(n=n.length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){c=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){c.label=r[1];break}if(6===r[0]&&c.label<n[1]){c.label=n[1],n=r;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(r);break}n[2]&&c.ops.pop(),c.trys.pop();continue}r=t.call(e,c)}catch(s){r=[6,s],o=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,o,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},paper;!function(e){var t;!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pickTarget=null,t}return __extends(t,e),t.prototype.onDestroy=function(){this.pickTarget=null},t}(e.Behaviour);t.GizmoPickComponent=r,__reflect(r.prototype,"paper.debug.GizmoPickComponent")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r;!function(e){e.SceneSelected="SceneSelected",e.SceneUnselected="SceneUnselected",e.GameObjectSelected="GameObjectSelected",e.GameObjectUnselected="GameObjectUnselected"}(r=t.GUIComponentEvent||(t.GUIComponentEvent={}));var s=function(r){function s(){var e=null!==r&&r.apply(this,arguments)||this;return e.inspector=new dat.GUI({closeOnTop:!0,width:330}),e.hierarchy=new dat.GUI({closeOnTop:!0,width:330}),e.selectedGameObjects=[],e.selectedScene=null,e.selectedGameObject=null,e}return __extends(s,r),s.prototype.initialize=function(){r.prototype.initialize.call(this);var s={debug:!1};this.hierarchy.add(s,"debug").onChange(function(r){var s=e.Application.systemManager.getOrRegisterSystem(t.GUISceneSystem),a=e.Application.systemManager.getOrRegisterSystem(t.GUISystem);r?(e.Application.playerMode=1,s.enabled=!0,a.enabled=!0):(e.Application.playerMode=0,s.enabled=!1,a.enabled=!1)})},s.prototype.select=function(t,r){if(t)if(t instanceof e.Scene){if(this.selectedScene===t)return}else if(this.selectedGameObject===t||this.selectedGameObjects.indexOf(t)>=0)return;if((!t||t instanceof e.Scene||this.selectedScene)&&(r=!0),r)if(this.selectedScene)e.EventPool.dispatchEvent("SceneUnselected",this,this.selectedScene),this.selectedScene=null;else if(this.selectedGameObjects.length>0){var s=this.selectedGameObjects.concat();this.selectedGameObjects.length=0,this.selectedGameObject=null;for(var a=0,o=s;a<o.length;a++){var n=o[a];e.EventPool.dispatchEvent("GameObjectUnselected",this,n)}}t&&(t instanceof e.Scene?(this.selectedScene=t,e.EventPool.dispatchEvent("SceneSelected",this,t)):(this.selectedGameObjects.push(t),this.selectedGameObject=t,e.EventPool.dispatchEvent("GameObjectSelected",this,t))),(global||window).psgo=t},s}(e.SingletonComponent);t.GUIComponent=s,__reflect(s.prototype,"paper.debug.GUIComponent"),dat&&e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent)}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r;!function(e){e[e.TRANSLATE=0]="TRANSLATE",e[e.ROTATE=1]="ROTATE",e[e.SCALE=2]="SCALE"}(r||(r={}));var s;!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z",e[e.E=3]="E"}(s||(s={}));var a;!function(e){e.F="f",e.Q="q",e.W="w",e.E="e",e.R="r"}(a||(a={}));var o=function(r){function s(){var s=null!==r&&r.apply(this,arguments)||this;return s._interests=[[{componentClass:egret3d.Transform}]],s._camerasAndLights=e.GameObject.globalGameObject.getOrAddComponent(egret3d.CamerasAndLights),s._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),s._orbitControls=null,s._touchPlane=null,s._grids=null,s._axises=null,s._box=null,s._cameraViewFrustum=null,s._skeletonDrawer=null,s._transformMode=0,s._transformAxis=null,s._gizomsMap={},s._pickableTool={},s._pickableSelected=[],s._isDragging=!1,s._startPoint=egret3d.Vector3.create(),s._endPoint=egret3d.Vector3.create(),s._positionStart=egret3d.Vector3.create(),s._startWorldPosition=egret3d.Vector3.create(),s._startWorldQuaternion=egret3d.Quaternion.create(),s._startWorldScale=egret3d.Vector3.create(1,1,1),s._selectedWorldPostion=egret3d.Vector3.create(),s._selectedWorldQuaternion=egret3d.Quaternion.create(),s._cameraPosition=egret3d.Vector3.create(),s._eye=egret3d.Vector3.create(),s._onMouseDown=function(r){var a=egret3d.Vector3.create(r.clientX,r.clientY,0);egret3d.InputManager.mouse.convertPosition(a,a),r.preventDefault();var o=e.Application.sceneManager.activeScene.getRootGameObjects(),n=o.concat(s._pickableSelected);s._axises.activeSelf&&(n=n.concat(s._pickableTool[s._transformMode]));var i=t.Helper.getPickObjects(n,a.x,a.y),c=i[0],l=c?c.transform.gameObject:null;if(l&&l.getComponent(t.GizmoPickComponent)){var d=l.getComponent(t.GizmoPickComponent).pickTarget;d&&(l=d)}if(l)if(s._pickableTool[s._transformMode].indexOf(l)<0)s._guiComponent.select(l,!0);else{i=t.Helper.getPickObjects([s._touchPlane],a.x,a.y);var m=s._guiComponent.selectedGameObject;m.transform.getWorldMatrix().decompose(s._startWorldPosition,s._startWorldQuaternion,s._startWorldScale);var u=i[0].position;s._startPoint.copy(u).subtract(s._startWorldPosition,s._startPoint),s._positionStart.copy(m.transform.getPosition())}s._isDragging=!0,a.release()},s._onMouseUp=function(e){s._orbitControls.enableMove=!0,s._isDragging=!1,e.preventDefault()},s._onMouseHover=function(e){if(0===e.buttons||!s._isDragging){var r=egret3d.Vector3.create(e.clientX,e.clientY);egret3d.InputManager.mouse.convertPosition(r,r);var a=t.Helper.getPickObjects(s._pickableTool[s._transformMode],r.x,r.y);if(a.length>0){var o=a[0].transform;switch(o.gameObject.name){case"pickX":s._transformAxis=0;break;case"pickY":s._transformAxis=1;break;case"pickZ":s._transformAxis=2;break;case"pickE":s._transformAxis=3}}else s._transformAxis=null}},s._onMouseMove=function(r){r.preventDefault();var a=s._guiComponent.selectedGameObject;if(0!==r.buttons&&s._isDragging&&null!==s._transformAxis&&a&&a instanceof e.GameObject){var o=egret3d.Vector3.create(r.clientX,r.clientY);egret3d.InputManager.mouse.convertPosition(o,o);var n=t.Helper.getPickObjects([s._touchPlane],o.x,o.y);if(0==n.length)return;s._orbitControls.enableMove=!1;var i=n[0],c=i.position;if(s._endPoint.copy(c).subtract(s._startWorldPosition,s._endPoint),0===s._transformMode){switch(s._transformAxis){case 0:s._endPoint.y=s._startPoint.y,s._endPoint.z=s._startPoint.z;break;case 1:s._endPoint.x=s._startPoint.x,s._endPoint.z=s._startPoint.z;break;case 2:s._endPoint.x=s._startPoint.x,s._endPoint.y=s._startPoint.y}s._endPoint.subtract(s._startPoint,s._endPoint).add(s._positionStart),a.transform.setPosition(s._endPoint)}else if(1===s._transformMode){var l=egret3d.Camera.editor,d=egret3d.Vector3.create(),m=egret3d.Vector3.create(),u=egret3d.Quaternion.create(),p=egret3d.Vector3.create(),h=20/s._selectedWorldPostion.getDistance(d.applyMatrix(l.gameObject.transform.getWorldMatrix())),f=0;if(3===s._transformAxis)d.copy(s._endPoint).cross(s._startPoint),m.copy(s._eye),f=s._endPoint.getAngle(s._startPoint)*(d.dot(s._eye)<0?1:-1);else{switch(s._transformAxis){case 0:p.set(1,0,0);break;case 1:p.set(0,1,0);break;case 2:p.set(0,0,1)}m.copy(p),s._endPoint.subtract(s._startPoint,s._endPoint),f=s._endPoint.dot(p.cross(s._eye).normalize())*h}u.fromAxis(m,f).multiply(s._startWorldQuaternion),a.transform.setRotation(u),d.release(),m.release(),u.release(),p.release()}else if(2===s._transformMode){var _=s._endPoint.clone().divide(s._startPoint);switch(s._transformAxis){case 0:_.y=1,_.z=1;break;case 1:_.x=1,_.z=1;break;case 2:_.x=1,_.y=1}s._endPoint.copy(s._startWorldScale).multiply(_),a.transform.setScale(s._endPoint)}o.release()}},s._onKeyDown=function(e){var t=s._guiComponent.selectedGameObject;switch(e.key){case"f":t&&(s._orbitControls.lookAtPoint.copy(t.transform.getPosition()),s._orbitControls.distance=10,s._orbitControls.lookAtOffset.set(0,0,0));break;case"w":s._transformModeHandler(0);break;case"e":s._transformModeHandler(1);break;case"r":s._transformModeHandler(2)}},s._onGameObjectSelected=function(e,t){s._selectGameObject(t)},s._onGameObjectUnselected=function(e,t){s._selectGameObject(null)},s}return __extends(s,r),s.prototype._selectGameObject=function(r){r&&(this._axises&&this._axises.activeSelf&&(this._axises.activeSelf=!1),this._box&&this._box.activeSelf&&(this._box.dontDestroy=!0,this._box.activeSelf=!1),this._skeletonDrawer&&this._skeletonDrawer.activeSelf&&(this._skeletonDrawer.dontDestroy=!0,this._skeletonDrawer.activeSelf=!1),this._axises.activeSelf=!0,this._box.scene!==r.scene&&(this._box.dontDestroy=!this._box.dontDestroy,this._box.dontDestroy=r.scene===e.Scene.globalScene),r.renderer?this._box.activeSelf=!0:this._box.activeSelf=!1,r.renderer&&r.renderer.constructor===egret3d.SkinnedMeshRenderer&&(this._skeletonDrawer?(this._skeletonDrawer.scene!==r.scene&&(this._skeletonDrawer.dontDestroy=!this._skeletonDrawer.dontDestroy,this._skeletonDrawer.dontDestroy=r.scene===e.Scene.globalScene),this._skeletonDrawer.activeSelf=!0):(this._skeletonDrawer=e.GameObject.create("SkeletonDrawer","Editor Only"),this._skeletonDrawer.addComponent(n),this._skeletonDrawer.addComponent(t.GizmoPickComponent).pickTarget=r.parent),this._skeletonDrawer.parent=r))},s.prototype._transformModeHandler=function(e){this._transformMode=e,this._axises.transform.find("translate").gameObject.activeSelf=0===e,this._axises.transform.find("rotate").gameObject.activeSelf=1===e,this._axises.transform.find("scale").gameObject.activeSelf=2===e},s.prototype._setPoint=function(e,t,r,s,a,o){var n=egret3d.Vector3.create(),i=egret3d.Matrix4.create();if(n.set(r,s,a).applyMatrix(i.inverse(e)).applyMatrix(egret3d.Matrix4.IDENTITY),void 0!==o)for(var c=0,l=o.length;l>c;c++){var d=3*o[c];t[d+0]=n.x,t[d+1]=n.y,t[d+2]=n.z}n.release(),i.release()},s.prototype._updateAxises=function(){if(this._axises&&this._axises.activeSelf){this._axises.transform.position=this._selectedWorldPostion;var e=this._selectedWorldPostion.getDistance(this._cameraPosition),t=this._axises.transform.find("translate"),r=this._axises.transform.find("rotate"),s=this._axises.transform.find("scale");if(this._axises.transform.setScale(egret3d.Vector3.ONE.clone().multiplyScalar(e/10).release()),0===this._transformMode||2===this._transformMode)t.rotation=this._selectedWorldQuaternion,s.rotation=this._selectedWorldQuaternion;else if(1===this._transformMode){var a=egret3d.Quaternion.IDENTITY,o=a.clone(),n=egret3d.Quaternion.create(),i=this._eye.clone();i.applyQuaternion(o.inverse());var c=r.find("axisE"),l=r.find("pickE");n.fromMatrix(egret3d.Matrix4.create().lookAt(this._eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release()),c.setRotation(n),l.setRotation(n);var d=r.find("axisX");n.copy(o).fromAxis(egret3d.Vector3.RIGHT,Math.atan2(-i.y,i.z)),n.multiply(a),d.setRotation(n);var m=r.find("axisY");n.copy(o).fromAxis(egret3d.Vector3.UP,Math.atan2(i.x,i.z)),n.multiply(a),m.setRotation(n);var u=r.find("axisZ");n.copy(o).fromAxis(egret3d.Vector3.FORWARD,Math.atan2(i.y,i.x)),n.multiply(a),u.setRotation(n),o.release(),n.release(),i.release()}}this._guiComponent.selectedGameObject&&this._guiComponent.selectedGameObject.transform.getLocalEulerAngles()},s.prototype._updateBox=function(){if(this._guiComponent.selectedGameObject&&this._box&&this._box.activeSelf){var e=this._guiComponent.selectedGameObject;e.renderer?(this._box.transform.position=e.transform.position,this._box.transform.rotation=e.transform.rotation,this._box.transform.scale=e.transform.scale):this._box.activeSelf=!1}},s.prototype._updateCameras=function(){for(var e=0,r=this._camerasAndLights.cameras;e<r.length;e++){var s=r[e];if("Editor Only"!==s.gameObject.tag){var a=s.transform.find("__editor");if(a){var o=this._selectedWorldPostion.getDistance(this._cameraPosition),n=egret3d.Quaternion.create();n.fromMatrix(egret3d.Matrix4.create().lookAt(this._eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release()),a.transform.setLocalScale(egret3d.Vector3.ONE.clone().multiplyScalar(o/40).release()),a.transform.setRotation(n)}else a=t.EditorMeshHelper.createCameraIcon("__editor",s.gameObject).transform,a.parent=s.gameObject.transform;var i=a.transform.find("pick").gameObject;this._pickableSelected.indexOf(i)<0&&this._pickableSelected.push(i)}}var c=this._guiComponent.selectedGameObject?this._guiComponent.selectedGameObject.getComponent(egret3d.Camera):null;if(c){this._cameraViewFrustum.transform.position=c.gameObject.transform.position,this._cameraViewFrustum.transform.rotation=c.gameObject.transform.rotation,this._cameraViewFrustum.activeSelf=!0;var l=this._cameraViewFrustum.getComponent(egret3d.MeshFilter).mesh,d=egret3d.Matrix4.create(),m={x:0,y:0,w:0,h:0};c.calcViewPortPixel(m),c.calcProjectMatrix(m.w/m.h,d);var u=l.getVertices();this._setPoint(d,u,0,0,-1,[38,41]),this._setPoint(d,u,0,0,1,[39]),this._setPoint(d,u,-1,-1,-1,[0,7,16,25]),this._setPoint(d,u,1,-1,-1,[1,2,18,27]),this._setPoint(d,u,-1,1,-1,[5,6,20,29]),this._setPoint(d,u,1,1,-1,[3,4,22,31]),this._setPoint(d,u,-1,-1,1,[8,15,17]),this._setPoint(d,u,1,-1,1,[9,10,19]),this._setPoint(d,u,-1,1,1,[13,14,21]),this._setPoint(d,u,1,1,1,[11,12,23]),this._setPoint(d,u,.7,1.1,-1,[32,37]),this._setPoint(d,u,-.7,1.1,-1,[33,34]),this._setPoint(d,u,0,2,-1,[35,36]),this._setPoint(d,u,-1,0,1,[42]),this._setPoint(d,u,1,0,1,[43]),this._setPoint(d,u,0,-1,1,[44]),this._setPoint(d,u,0,1,1,[45]),this._setPoint(d,u,-1,0,-1,[46]),this._setPoint(d,u,1,0,-1,[47]),this._setPoint(d,u,0,-1,-1,[48]),this._setPoint(d,u,0,1,-1,[49]),l.uploadVertexBuffer("POSITION"),d.release()}else this._cameraViewFrustum.activeSelf=!1},s.prototype._updateLights=function(){for(var e=0,r=this._camerasAndLights.lights;e<r.length;e++){var s=r[e];if("Editor Only"!==s.gameObject.tag){var a=s.transform.find("__editor");if(a){var o=this._selectedWorldPostion.getDistance(this._cameraPosition),n=egret3d.Quaternion.create();n.fromMatrix(egret3d.Matrix4.create().lookAt(this._eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release()),a.transform.setLocalScale(egret3d.Vector3.ONE.clone().multiplyScalar(o/40).release()),a.transform.setRotation(n)}else a=t.EditorMeshHelper.createLightIcon("__editor",s.gameObject).transform,a.parent=s.gameObject.transform;var i=a.transform.find("pick").gameObject;this._pickableSelected.indexOf(i)<0&&this._pickableSelected.push(i)}}},s.prototype._updateTouchPlane=function(){if(this._guiComponent.selectedGameObject&&this._touchPlane&&!this._touchPlane.isDestroyed){var e=egret3d.Camera.editor,t=this._guiComponent.selectedGameObject.transform.getPosition(),r=t.clone(),s=egret3d.Quaternion.create(),a=egret3d.Vector3.create(1,0,0),o=egret3d.Vector3.create(0,1,0),n=egret3d.Vector3.create(0,0,1);a.set(1,0,0).applyQuaternion(egret3d.Quaternion.IDENTITY),o.set(0,1,0).applyQuaternion(egret3d.Quaternion.IDENTITY),n.set(0,0,1).applyQuaternion(egret3d.Quaternion.IDENTITY);var i=o.clone(),c=egret3d.Vector3.create(),l=e.transform.getPosition().clone();switch(e.opvalue>0&&l.subtract(t,l),l.normalize(),this._transformMode){case 0:case 2:switch(this._transformAxis){case 0:i.copy(l).cross(a),c.copy(a).cross(i);break;case 1:i.copy(l).cross(o),c.copy(o).cross(i);break;case 2:i.copy(l).cross(n),c.copy(n).cross(i)}break;case 1:default:c.set(0,0,0)}if(0===c.length){var d=e.transform.getRotation();s.copy(d)}else{var m=egret3d.Matrix4.create(),u=egret3d.Vector3.create();m.lookAt(u.set(0,0,0),c,i),s.fromMatrix(m),u.release(),m.release()}this._touchPlane.transform.setPosition(r),this._touchPlane.transform.setRotation(s),r.release(),a.release(),o.release(),n.release(),i.release(),c.release(),s.release(),l.release()}},s.prototype.onAwake=function(){},s.prototype.onEnable=function(){e.Application.playerMode=1,this._orbitControls=egret3d.Camera.editor.gameObject.getOrAddComponent(t.OrbitControls),this._grids||(this._grids=t.EditorMeshHelper.createGrid("Grid")),this._touchPlane||(this._touchPlane=t.EditorMeshHelper.createTouchPlane("TouchPlane"),this._touchPlane.activeSelf=!1),this._axises||(this._axises=t.EditorMeshHelper.createAxises("Axis"),this._axises.activeSelf=!1),this._box||(this._box=t.EditorMeshHelper.createBox("Box",egret3d.Color.create(0,1,1).release()),this._box.activeSelf=!1),this._cameraViewFrustum||(this._cameraViewFrustum=t.EditorMeshHelper.createCameraWireframed("Camera"),this._cameraViewFrustum.activeSelf=!1),this._isDragging=!1,this._transformAxis=null,this._gizomsMap[0]=[],this._pickableTool[0]=[],this._pickableTool[0].push(this._axises.transform.find("translate").find("pickX").gameObject),this._pickableTool[0].push(this._axises.transform.find("translate").find("pickY").gameObject),this._pickableTool[0].push(this._axises.transform.find("translate").find("pickZ").gameObject),this._pickableTool[1]=[],this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickX").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickY").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickZ").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickE").gameObject),this._pickableTool[2]=[],this._pickableTool[2].push(this._axises.transform.find("scale").find("pickX").gameObject),this._pickableTool[2].push(this._axises.transform.find("scale").find("pickY").gameObject),this._pickableTool[2].push(this._axises.transform.find("scale").find("pickZ").gameObject),this._pickableSelected.length=0,e.EventPool.addEventListener("GameObjectSelected",t.GUIComponent,this._onGameObjectSelected),e.EventPool.addEventListener("GameObjectUnselected",t.GUIComponent,this._onGameObjectUnselected),egret3d.WebGLCapabilities.canvas.addEventListener("contextmenu",function(e){e.preventDefault()}),egret3d.WebGLCapabilities.canvas.addEventListener("mousedown",this._onMouseDown),egret3d.WebGLCapabilities.canvas.addEventListener("mouseup",this._onMouseUp),egret3d.WebGLCapabilities.canvas.addEventListener("mousemove",this._onMouseHover),egret3d.WebGLCapabilities.canvas.addEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown),this._transformModeHandler(this._transformMode)},s.prototype.onDisable=function(){this._selectGameObject(null),egret3d.Camera.editor.gameObject.removeComponent(t.OrbitControls),this._orbitControls=null;for(var r=0,s=this._camerasAndLights.cameras;r<s.length;r++){var a=s[r];if("Editor Only"!==a.gameObject.tag){var o=a.transform.find("__editor");o&&o.gameObject.destroy()}}e.EventPool.removeEventListener("GameObjectSelected",t.GUIComponent,this._onGameObjectSelected),e.EventPool.removeEventListener("GameObjectUnselected",t.GUIComponent,this._onGameObjectUnselected),egret3d.WebGLCapabilities.canvas.removeEventListener("mousedown",this._onMouseDown),egret3d.WebGLCapabilities.canvas.removeEventListener("mouseup",this._onMouseUp),egret3d.WebGLCapabilities.canvas.removeEventListener("mousemove",this._onMouseHover),egret3d.WebGLCapabilities.canvas.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this._touchPlane&&!this._touchPlane.isDestroyed&&(this._touchPlane.destroy(),this._touchPlane=null),this._grids&&!this._grids.isDestroyed&&(this._grids.destroy(),this._grids=null),this._axises&&!this._axises.isDestroyed&&(this._axises.destroy(),this._axises=null),this._box&&!this._box.isDestroyed&&(this._box.destroy(),this._box=null),this._skeletonDrawer&&!this._skeletonDrawer.isDestroyed&&(this._skeletonDrawer.destroy(),this._grids=null),this._cameraViewFrustum&&!this._cameraViewFrustum.isDestroyed&&(this._cameraViewFrustum.destroy(),this._cameraViewFrustum=null),this._pickableSelected.length=0,e.Application.playerMode=0},s.prototype.onUpdate=function(e){var t=this._guiComponent.selectedGameObject;t&&(t.isDestroyed?this._guiComponent.select(null):(this._selectedWorldPostion.copy(t.transform.getPosition()),this._selectedWorldQuaternion.copy(t.transform.getRotation()))),this._pickableSelected.length=0,this._touchPlane&&this._touchPlane.isDestroyed&&(this._touchPlane=null),this._grids&&this._grids.isDestroyed&&(this._grids=null),this._axises&&(this._axises.isDestroyed?this._axises=null:this._axises.activeSelf=t?!0:!1),this._box&&(this._box.isDestroyed?this._box=null:this._box.activeSelf=t?!0:!1),this._cameraViewFrustum&&(this._cameraViewFrustum.isDestroyed?this._cameraViewFrustum=null:this._cameraViewFrustum.activeSelf=t?!0:!1),this._skeletonDrawer&&this._skeletonDrawer.isDestroyed&&(this._skeletonDrawer.isDestroyed?this._skeletonDrawer=null:this._skeletonDrawer.activeSelf=t?!0:!1);var r=egret3d.Camera.editor;this._cameraPosition.copy(r.transform.getPosition()),0==r.opvalue?this._eye.copy(this._cameraPosition).normalize():this._eye.copy(this._cameraPosition).subtract(this._selectedWorldPostion).normalize(),this._updateAxises(),this._updateBox(),this._updateCameras(),this._updateLights(),this._updateTouchPlane()},s}(e.BaseSystem);t.GUISceneSystem=o,__reflect(o.prototype,"paper.debug.GUISceneSystem");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){var e=t._skeletonMesh,r=egret3d.DefaultMaterials.LINEDASHED_COLOR.clone();e.glTFMesh.primitives[0].mode=1,r.setColor("diffuse",egret3d.Color.create(0,1,1).release()).setDepth(!1,!1).renderQueue=4e3,this.gameObject.getOrAddComponent(egret3d.MeshFilter).mesh=e,this.gameObject.getOrAddComponent(egret3d.MeshRenderer).material=r},t.prototype.onLateUpdate=function(){var e=this.gameObject.getComponentInParent(egret3d.SkinnedMeshRenderer),r=t._skeletonMesh;if(e){var s=0,a=egret3d.Vector3.create(),o=egret3d.Vector3.create(),n=egret3d.Matrix4.create(),i=r.getVertices(),c=e.bones;n.inverse(this.gameObject.transform.worldMatrix);for(var l=0,d=c;l<d.length;l++){var m=d[l];m?m.parent&&c.indexOf(m.parent)>=0?(a.applyMatrix(n,m.parent.position).toArray(i,s),a.applyMatrix(n,m.position).toArray(i,s+3)):(m.getRight(o).applyDirection(n).multiplyScalar(.25),a.applyMatrix(n,m.position).toArray(i,s),a.applyMatrix(n,m.position).add(o).toArray(i,s+3)):(egret3d.Vector3.ZERO.toArray(i,s),egret3d.Vector3.ZERO.toArray(i,s+3)),s+=6}r.uploadVertexBuffer(),a.release(),o.release(),n.release()}},t._skeletonMesh=egret3d.Mesh.create(128,0,["POSITION","COLOR_0"],null,35048),t}(e.Behaviour);__reflect(n.prototype,"SkeletonDrawer")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(r){function s(){var s=null!==r&&r.apply(this,arguments)||this;return s._interests=[[{componentClass:egret3d.Transform}]],s._disposeCollecter=e.GameObject.globalGameObject.getOrAddComponent(e.DisposeCollecter),s._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),s._hierarchyFolders={},s._inspectorFolders={},s._selectGameObject=null,s._selectFolder=null,s._sceneSelectedHandler=function(e,t){s._selectSceneOrGameObject(t)},s._sceneUnselectedHandler=function(e,t){s._selectSceneOrGameObject(null)},s._gameObjectSelectedHandler=function(e,t){s._selectSceneOrGameObject(t)},s._gameObjectUnselectedHandler=function(e,t){s._selectSceneOrGameObject(null)},s._createGameObject=function(){s._guiComponent.selectedScene?s._selectGameObject=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",s._guiComponent.selectedScene):(s._selectGameObject=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",s._guiComponent.selectedGameObject.scene),s._selectGameObject.transform.parent=s._guiComponent.selectedGameObject.transform)},s._destroySceneOrGameObject=function(){var e=s._guiComponent.inspector.instance;e&&(s._guiComponent.select(null),e.destroy())},s._nodeClickHandler=function(e){s._guiComponent.select(e.instance,!0)},s}return __extends(s,r),s.prototype._openFolder=function(e){e.open(),e.parent&&e.parent!==this._guiComponent.hierarchy&&this._openFolder(e.parent)},s.prototype._selectSceneOrGameObject=function(t){if(this._selectFolder&&(this._selectFolder.selected=!1,this._selectFolder=null),this._guiComponent.inspector.instance=t,t)if(t.uuid in this._hierarchyFolders&&(this._selectFolder=this._hierarchyFolders[t.uuid],this._selectFolder.selected=!0,this._openFolder(this._selectFolder.parent)),t instanceof e.Scene)this._guiComponent.inspector.add(this,"_createGameObject","createObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);else{this._guiComponent.inspector.add(this,"_createGameObject","createChildObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);for(var r=0,s=t.components;r<s.length;r++){var a=s[r],o=this._guiComponent.inspector.addFolder(a.uuid,egret.getQualifiedClassName(a));o.instance=a,this._inspectorFolders[a.uuid]=o,this._addToInspector(o)}}else{for(var n in this._inspectorFolders)delete this._inspectorFolders[n];if(this._guiComponent.inspector.__controllers)for(var i=0,c=this._guiComponent.inspector.__controllers.concat();i<c.length;i++){var l=c[i];this._guiComponent.inspector.remove(l)}if(this._guiComponent.inspector.__folders)for(var n in this._guiComponent.inspector.__folders)this._guiComponent.inspector.removeFolder(this._guiComponent.inspector.__folders[n])}},s.prototype._addToHierarchy=function(e){if(!(e.uuid in this._hierarchyFolders||"Editor Only"===e.tag||2===e.hideFlags||3===e.hideFlags)){var t=this._hierarchyFolders[e.transform.parent?e.transform.parent.gameObject.uuid:e.scene.uuid];if(!t){if(e.transform.parent)throw new Error;t=this._guiComponent.hierarchy.addFolder(e.scene.uuid,e.scene.name+" <Scene>"),t.instance=e.scene,t.onClick=this._nodeClickHandler,this._hierarchyFolders[e.scene.uuid]=t}var r=t.addFolder(e.uuid,e.name);r.instance=e,r.onClick=this._nodeClickHandler,this._hierarchyFolders[e.uuid]=r}},s.prototype._addToInspector=function(t){for(var r,s,a,o=e.editor.getEditInfo(t.instance),n=function(e){switch(e.editType){case 0:r=i._guiComponent.inspector.add(t.instance,e.name).min(0).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 1:r=i._guiComponent.inspector.add(t.instance,e.name).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 2:r=i._guiComponent.inspector.add(t.instance,e.name).step(.1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 4:case 3:i._guiComponent.inspector.add(t.instance,e.name).listen();break;case 10:i._guiComponent.inspector.add(t.instance,e.name,e.option.listItems).listen();break;case 5:var o=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(o)if(o.get&&o.set){var n=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),s=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),r.onChange(n),s.onChange(n)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),s=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen();break;case 6:var o=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(o){if(o.get&&o.set){var n=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),s=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),a=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen(),r.onChange(n),s.onChange(n),a.onChange(n)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),s=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),a=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen();e.option&&(void 0!==e.option.minimum&&(r.min(e.option.minimum),s.min(e.option.minimum),a.min(e.option.minimum)),void 0!==e.option.maximum&&(r.max(e.option.maximum),s.max(e.option.maximum),a.max(e.option.maximum)),void 0!==e.option.step&&(r.step(e.option.step),s.step(e.option.step),a.step(e.option.step)))}break;case 7:case 8:break;case 9:break;case 11:break;case 14:}},i=this,c=0,l=o;c<l.length;c++){var d=l[c];n(d)}},s.prototype.onAwake=function(){},s.prototype.onEnable=function(){e.EventPool.addEventListener("SceneSelected",t.GUIComponent,this._sceneSelectedHandler),e.EventPool.addEventListener("SceneUnselected",t.GUIComponent,this._sceneUnselectedHandler),e.EventPool.addEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.addEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler),this.onAddGameObject(e.GameObject.globalGameObject,this._groups[0]);for(var r=0,s=this._groups[0].gameObjects;r<s.length;r++){var a=s[r];this._addToHierarchy(a)}},s.prototype.onAddGameObject=function(e,t){this._addToHierarchy(e)},s.prototype.onUpdate=function(e){if(this._selectGameObject&&(this._guiComponent.select(this._selectGameObject,!0),this._selectGameObject=null),this._guiComponent.inspector.updateDisplay(),this._guiComponent.inspector.__folders)for(var t in this._guiComponent.inspector.__folders)this._guiComponent.inspector.__folders[t].updateDisplay();for(var r=0,s=this._disposeCollecter.scenes;r<s.length;r++){var a=s[r],o=this._hierarchyFolders[a.uuid];if(delete this._hierarchyFolders[a.uuid],o&&o.parent)try{o.parent.removeFolder(o)}catch(n){}}for(var i=0,c=this._disposeCollecter.gameObjects;i<c.length;i++){var l=c[i],o=this._hierarchyFolders[l.uuid];if(delete this._hierarchyFolders[l.uuid],o&&o.parent)try{o.parent.removeFolder(o)}catch(n){}}for(var d=0,m=this._disposeCollecter.components;d<m.length;d++){var u=m[d],o=this._inspectorFolders[u.uuid];if(delete this._inspectorFolders[u.uuid],o&&o.parent)try{o.parent.removeFolder(o)}catch(n){}}},s.prototype.onDisable=function(){e.EventPool.removeEventListener("SceneSelected",t.GUIComponent,this._sceneSelectedHandler),e.EventPool.removeEventListener("SceneUnselected",t.GUIComponent,this._sceneUnselectedHandler),e.EventPool.removeEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.removeEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler);for(var r in this._hierarchyFolders){var s=this._hierarchyFolders[r];if(delete this._hierarchyFolders[r],s&&s.parent)try{s.parent.removeFolder(s)}catch(a){}}},s}(e.BaseSystem);t.GUISystem=r,__reflect(r.prototype,"paper.debug.GUISystem")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=(new egret3d.Vector2,new egret3d.Vector2,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;
return t.lookAtPoint=egret3d.Vector3.create(0,0,0),t.lookAtOffset=egret3d.Vector3.create(),t.distance=30,t.minPanAngle=-(1/0),t.maxPanAngle=1/0,t.minTileAngle=-90,t.maxTileAngle=90,t.moveSpped=.001,t.scaleSpeed=.2,t._enableMove=!0,t._mouseDown=!1,t._fingerTwo=!1,t._panAngle=0,t._panRad=0,t._tiltAngle=0,t._tiltRad=.25,t._mouseDownHandler=function(e){e.preventDefault(),t._mouseDown=!0,t._lastMouseX=e.x,t._lastMouseY=e.y},t._mouseUpHandler=function(e){e.preventDefault(),t._mouseDown=!1},t._mouseMoveHandler=function(e){if(t._mouseDown&&t._enableMove){var r=egret3d.Vector3.create(e.x-t._lastMouseX,e.y-t._lastMouseY,0);if(e.ctrlKey){r.x=-r.x;var s=t.lookAtTarget?t.lookAtTarget.getPosition():t.lookAtPoint,a=t.gameObject.transform.getPosition().getDistance(s),o=egret3d.Matrix3.create();r.multiplyScalar(a*t.moveSpped).applyMatrix3(o.getNormalMatrix(t.gameObject.transform.getLocalMatrix())),o.release(),t.lookAtOffset.add(r)}else t.panAngle+=r.x,t.tiltAngle+=r.y;t._lastMouseX=e.x,t._lastMouseY=e.y,r.release(),e.preventDefault()}},t._mouseWheelHandler=function(e){t.distance=Math.max(t.distance-(e.wheelDelta>0?2:-2),1),e.preventDefault()},t}return __extends(t,e),Object.defineProperty(t.prototype,"panAngle",{get:function(){return this._panAngle},set:function(e){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,e)),this._panRad=this._panAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(e){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,e)),this._tiltRad=this._tiltAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableMove",{get:function(){return this._enableMove},set:function(e){this._enableMove!==e&&(this._enableMove=e)},enumerable:!0,configurable:!0}),t.prototype.onStart=function(){this.bindTouch=egret3d.InputManager.touch,this.bindMouse=egret3d.InputManager.mouse,this.bindMouse.disableContextMenu()},t.prototype.onEnable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.addEventListener("mousedown",this._mouseDownHandler),e.addEventListener("mouseup",this._mouseUpHandler),e.addEventListener("mouseout",this._mouseUpHandler),e.addEventListener("dblclick",this._mouseUpHandler),e.addEventListener("mousemove",this._mouseMoveHandler),e.addEventListener("wheel",this._mouseWheelHandler))},t.prototype.onDisable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseout",this._mouseUpHandler),e.removeEventListener("dblclick",this._mouseUpHandler),e.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("wheel",this._mouseWheelHandler))},t.prototype.onUpdate=function(e){this._enableMove&&this.move()},t.prototype.move=function(){var e=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),t=this.distance*(0===this._tiltRad?0:Math.sin(this._tiltRad)),r=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),s=egret3d.Vector3.create();this.lookAtTarget?s.copy(this.lookAtTarget.getPosition()):s.copy(this.lookAtPoint),s.add(this.lookAtOffset),this.gameObject.transform.setPosition(s.x+e,s.y+t,s.z+r),this.gameObject.transform.lookAt(s),s.release()},t}(e.Behaviour));t.OrbitControls=r,__reflect(r.prototype,"paper.debug.OrbitControls")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(){function r(){}return r.createGameObject=function(t,r,s,a,o){void 0===r&&(r=null),void 0===s&&(s=null),void 0===a&&(a="Editor Only"),void 0===o&&(o=e.Scene.editorScene);var n=e.GameObject.create(t,a,o);return n.hideFlags=3,r&&(n.addComponent(egret3d.MeshFilter).mesh=r),s&&(n.addComponent(egret3d.MeshRenderer).material=s),n},r.createGrid=function(e,t,r,s,a){void 0===t&&(t=50),void 0===r&&(r=50),void 0===s&&(s=egret3d.Color.create(.26,.26,.26)),void 0===a&&(a=egret3d.Color.create(.53,.53,.53));for(var o=r/2,n=t/r,i=t/2,c=[],l=[],d=0,m=-i;r>=d;d++,m+=n){c.push(-i,0,m),c.push(i,0,m),c.push(m,0,-i),c.push(m,0,i);var u=d===o?s:a;l.push(u.r,u.g,u.b,u.a),l.push(u.r,u.g,u.b,u.a),l.push(u.r,u.g,u.b,u.a),l.push(u.r,u.g,u.b,u.a)}for(var p=0;p<l.length;p+=80)for(var h=0;16>h;h++)l[p+h]=.26;var f=new egret3d.Mesh(c.length,0,["POSITION","COLOR_0"]);f.setAttributes("POSITION",c),f.setAttributes("COLOR_0",l),f.glTFMesh.primitives[0].mode=1;var _=this.createGameObject(e,f,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return _},r.createTouchPlane=function(e,t,r){void 0===t&&(t=5e5),void 0===r&&(r=5e5);var s=this.createGameObject(e,egret3d.DefaultMeshes.createPlane(t,r),egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return s},r.createAxises=function(e){var t=this.createGameObject(e),r=this.createGameObject("translate");r.transform.setParent(t.transform);var s=this.createGameObject("axisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this.createGameObject("axisY",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),o=this.createGameObject("axisZ",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),n=this.createGameObject("arrowX",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=this.createGameObject("arrowY",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this.createGameObject("arrowZ",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this.createGameObject("pickX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this.createGameObject("pickY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),m=this.createGameObject("pickZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone());s.transform.setParent(r.transform),a.transform.setParent(r.transform).setLocalEuler(0,0,.5*Math.PI),o.transform.setParent(r.transform).setLocalEuler(0,.5*-Math.PI,0),n.transform.setParent(s.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),i.transform.setParent(a.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),c.transform.setParent(o.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),l.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.RIGHT.clone().multiplyScalar(.5)).setLocalScale(1.2,.1,.1),d.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.UP.clone().multiplyScalar(.5)).setLocalScale(.1,1.2,.1),m.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.FORWARD.clone().multiplyScalar(.5)).setLocalScale(.1,.1,1.2),l.activeSelf=d.activeSelf=m.activeSelf=!1,s.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),o.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),n.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),i.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),m.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3);var u=this.createGameObject("rotate");u.transform.setParent(t.transform);var s=this.createGameObject("axisX",egret3d.DefaultMeshes.createCircle(1,.5,1),egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this.createGameObject("axisY",egret3d.DefaultMeshes.createCircle(1,.5,2),egret3d.DefaultMaterials.MESH_BASIC.clone()),o=this.createGameObject("axisZ",egret3d.DefaultMeshes.createCircle(1,.5,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),p=this.createGameObject("axisE",egret3d.DefaultMeshes.createCircle(1.25,1,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this.createGameObject("pickX",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this.createGameObject("pickY",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),m=this.createGameObject("pickZ",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),h=this.createGameObject("pickE",egret3d.DefaultMeshes.createTorus(1.25,.1,2,24),egret3d.DefaultMaterials.MESH_BASIC.clone());s.transform.setParent(u.transform),a.transform.setParent(u.transform),o.transform.setParent(u.transform),p.transform.setParent(u.transform),l.transform.setParent(u.transform).setLocalEuler(0,.5*-Math.PI,.5*-Math.PI),d.transform.setParent(u.transform).setLocalEuler(.5*Math.PI,0,0),m.transform.setParent(u.transform).setLocalEuler(0,0,.5*-Math.PI),h.transform.setParent(u.transform).setLocalEuler(0,0,0),l.activeSelf=d.activeSelf=m.activeSelf=h.activeSelf=!1,s.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),o.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),p.renderer.material.setColor("diffuse",egret3d.Color.YELLOW).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),m.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),h.renderer.material.setColor("diffuse",egret3d.Color.YELLOW).setDepth(!1,!1).setRenderQueue(4e3);var f=this.createGameObject("scale");f.transform.setParent(t.transform);var s=this.createGameObject("axisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this.createGameObject("axisY",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),o=this.createGameObject("axisZ",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),n=this.createGameObject("arrowX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=this.createGameObject("arrowY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this.createGameObject("arrowZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this.createGameObject("pickX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this.createGameObject("pickY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),m=this.createGameObject("pickZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone());return s.transform.setParent(f.transform),a.transform.setParent(f.transform).setLocalEuler(0,0,.5*Math.PI),o.transform.setParent(f.transform).setLocalEuler(0,.5*-Math.PI,0),n.transform.setParent(s.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),i.transform.setParent(a.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),c.transform.setParent(o.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),l.transform.setParent(f.transform).setLocalPosition(egret3d.Vector3.RIGHT.clone().multiplyScalar(.5)).setLocalScale(1.2,.2,.2),d.transform.setParent(f.transform).setLocalPosition(egret3d.Vector3.UP.clone().multiplyScalar(.5)).setLocalScale(.2,1.2,.2),m.transform.setParent(f.transform).setLocalPosition(egret3d.Vector3.FORWARD.clone().multiplyScalar(.5)).setLocalScale(.2,.2,1.2),l.activeSelf=d.activeSelf=m.activeSelf=!1,s.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),o.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),n.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),i.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),m.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),t},r.createBox=function(e,t){var r=this.createGameObject(e,egret3d.DefaultMeshes.CUBE_LINE,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return r.getComponent(egret3d.MeshRenderer).material.setColor("diffuse",egret3d.Color.create(0,1,1).release()),r},r.createCameraIcon=function(e,r){var s=new egret3d.Material(egret3d.DefaultShaders.TRANSPARENT);s.renderQueue=4e3,s.setTexture("map",egret3d.DefaultTextures.CAMERA_ICON);var a=this.createGameObject(e,null,null,r.tag,r.scene),o=this.createGameObject("pick",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone(),r.tag,r.scene);o.transform.setParent(a.transform);var n=this.createGameObject("icon",egret3d.DefaultMeshes.QUAD,s,r.tag,r.scene);return n.transform.setParent(a.transform),o.activeSelf=!1,o.addComponent(t.GizmoPickComponent).pickTarget=r,a.transform.setParent(r.transform),a},r.createLightIcon=function(e,r){var s=new egret3d.Material(egret3d.DefaultShaders.TRANSPARENT);s.renderQueue=4e3,s.setTexture("map",egret3d.DefaultTextures.LIGHT_ICON),s.setColor("diffuse",egret3d.Color.RED);var a=this.createGameObject(e,null,null,r.tag,r.scene),o=this.createGameObject("pick",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone(),r.tag,r.scene);o.transform.setParent(a.transform);var n=this.createGameObject("icon",egret3d.DefaultMeshes.QUAD,s,r.tag,r.scene);return n.transform.setParent(a.transform),o.activeSelf=!1,o.addComponent(t.GizmoPickComponent).pickTarget=r,a.transform.setParent(r.transform),a},r.createCameraWireframed=function(e,t,r,s,a,o){void 0===t&&(t=egret3d.Color.create(1,.7,0)),void 0===r&&(r=egret3d.Color.RED),void 0===s&&(s=egret3d.Color.create(0,.7,1)),void 0===a&&(a=egret3d.Color.WHITE),void 0===o&&(o=egret3d.Color.create(.2,.2,.2));for(var n=[],i=[],c=50,l=0;c>l;l++)n.push(0,0,0),24>l?i.push(t.r,t.g,t.b,t.a):32>l?i.push(r.r,r.g,r.b,r.a):38>l?i.push(s.r,s.g,s.b,s.a):40>l?i.push(a.r,a.g,a.b,a.a):i.push(o.r,o.g,o.b,o.a);var d=new egret3d.Mesh(c,0,["POSITION","COLOR_0"]);d.setAttributes("POSITION",n),d.setAttributes("COLOR_0",i),d.glTFMesh.primitives[0].mode=1;var m=this.createGameObject(e,d,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return m},r}();t.EditorMeshHelper=r,__reflect(r.prototype,"paper.debug.EditorMeshHelper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(e){var t=function(){function e(){}return e._rayCastGameObject=function(e,t,r){if("__editor"!==t.name&&(t.activeInHierarchy||"Editor Only"===t.tag||3===t.hideFlags)){var s=null,a=t.getComponent(egret3d.MeshFilter);if(a&&a.mesh)s=a.mesh.raycast(e,t.transform.getWorldMatrix()),s&&(s.transform=t.transform,r.push(s));else{var o=t.getComponent(egret3d.SkinnedMeshRenderer);o&&o.mesh&&(s=o.mesh.raycast(e,t.transform.getWorldMatrix(),o.boneMatrices),s&&(s.transform=t.transform,r.push(s)))}if(!s)for(var n=0,i=t.transform.children;n<i.length;n++){var c=i[n];this._rayCastGameObject(e,c.gameObject,r)}}},e.getPickObjects=function(e,t,r){for(var s=egret3d.Camera.editor,a=s.createRayByScreen(t,r),o=[],n=0,i=e;n<i.length;n++){var c=i[n];this._rayCastGameObject(a,c,o)}return o.sort(function(e,t){return t.distance-e.distance}),o},e}();e.Helper=t,__reflect(t.prototype,"paper.debug.Helper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var helper;!function(e){function t(e){for(var t=e.substr(e.lastIndexOf("/")+1),r=t.indexOf(".",0),s="";r>=0;){if(s=t.substr(r),".vs.glsl"==s)return"GLVertexShader";if(".assetbundle.json"==s)return"Bundle";if(".fs.glsl"==s)return"GLFragmentShader";if(".png"==s||".jpg"==s)return"Texture";if(".pvr.bin"==s||".pvr"==s)return"PVR";if(".prefab.json"==s)return"Prefab";if(".scene.json"==s)return"Scene";if(".atlas.json"==s)return"Atlas";if(".font.json"==s)return"Font";if(".json"==s||".txt"==s||".effect.json"==s)return"TextAsset";if(".packs.bin"==s)return"PackBin";if(".packs.txt"==s)return"PackTxt";if(".path.json"==s)return"pathAsset";if(".mp3"==s||".ogg"==s)return"Sound";if(".shader.json"==s)return"Shader";if(".image.json"==s)return"TextureDesc";if(".mat.json"==s)return"Material";if(".mesh.bin"==s)return"Mesh";if(".ani.bin"==s)return"Animation";r=t.indexOf(".",r+1)}return"Unknown"}function r(e,r){return void 0===r&&(r="resource/"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return s?[3,2]:[4,RES.loadConfig("resource/default.res.json",r)];case 1:a.sent(),s=!0,a.label=2;case 2:return[2,new Promise(function(s){RES.getResByUrl(r+e,function(e){paper.Asset.register(e),s()},RES,t(e))})]}})})}var s=!1;e.getResAsync=r}(helper||(helper={}));