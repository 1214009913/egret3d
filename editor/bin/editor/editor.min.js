"use strict";var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,s){function a(e){try{l(n.next(e))}catch(t){s(t)}}function i(e){try{l(n["throw"](e))}catch(t){s(t)}}function l(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,i)}l((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return n([e,t])}}function n(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,s&&(a=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(s,r[1])).done)return a;switch(s=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,s=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){l.label=r[1];break}if(6===r[0]&&l.label<a[1]){l.label=a[1],a=r;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(r);break}a[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(n){r=[6,n],s=0}finally{o=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var o,s,a,i,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},paper;!function(e){var t;!function(t){var r;!function(e){e.SceneSelected="SceneSelected",e.SceneUnselected="SceneUnselected",e.GameObjectSelected="GameObjectSelected",e.GameObjectUnselected="GameObjectUnselected"}(r=t.GUIComponentEvent||(t.GUIComponentEvent={}));var n=function(r){function n(){var e=null!==r&&r.apply(this,arguments)||this;return e.inspector=new dat.GUI({closeOnTop:!0,width:330}),e.hierarchy=new dat.GUI({closeOnTop:!0,width:330}),e.selectedGameObjects=[],e.selectedScene=null,e.selectedGameObject=null,e}return __extends(n,r),n.prototype.initialize=function(){r.prototype.initialize.call(this);var n={debug:!1};this.hierarchy.add(n,"debug").onChange(function(r){var n=e.Application.systemManager.getOrRegisterSystem(t.GUISceneSystem),o=e.Application.systemManager.getOrRegisterSystem(t.GUISystem);r?(e.Application.playerMode=1,n.enabled=!0,o.enabled=!0):(e.Application.playerMode=0,n.enabled=!1,o.enabled=!1)})},n.prototype.select=function(t,r){if(t)if(t instanceof e.Scene){if(this.selectedScene===t)return}else if(this.selectedGameObject===t||this.selectedGameObjects.indexOf(t)>=0)return;if((!t||t instanceof e.Scene||this.selectedScene)&&(r=!0),r)if(this.selectedScene)e.EventPool.dispatchEvent("SceneUnselected",this,this.selectedScene),this.selectedScene=null;else if(this.selectedGameObjects.length>0){var n=this.selectedGameObjects.concat();this.selectedGameObjects.length=0,this.selectedGameObject=null;for(var o=0,s=n;o<s.length;o++){var a=s[o];e.EventPool.dispatchEvent("GameObjectUnselected",this,a)}}t&&(t instanceof e.Scene?(this.selectedScene=t,e.EventPool.dispatchEvent("SceneSelected",this,t)):(this.selectedGameObjects.push(t),this.selectedGameObject=t,e.EventPool.dispatchEvent("GameObjectSelected",this,t))),(global||window).psgo=t},n}(e.SingletonComponent);t.GUIComponent=n,__reflect(n.prototype,"paper.debug.GUIComponent"),dat&&e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent)}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r;!function(e){e[e.TRANSLATE=0]="TRANSLATE",e[e.ROTATE=1]="ROTATE",e[e.SCALE=2]="SCALE"}(r||(r={}));var n;!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(n||(n={}));var o;!function(e){e.F="f",e.Q="q",e.W="w",e.E="e",e.R="r"}(o||(o={}));var s=function(r){function n(){var n=null!==r&&r.apply(this,arguments)||this;return n._interests=[[{componentClass:egret3d.Transform}]],n._camerasAndLights=e.GameObject.globalGameObject.getOrAddComponent(egret3d.CamerasAndLights),n._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),n._orbitControls=null,n._touchPlane=null,n._grids=null,n._axises=null,n._box=null,n._skeletonDrawer=null,n._transformMode=0,n._transformAxis=null,n._pickableTool={},n._pickableSelected=[],n._isDragging=!1,n._startPoint=egret3d.Vector3.create(),n._endPoint=egret3d.Vector3.create(),n._positionStart=egret3d.Vector3.create(),n._startWorldPosition=egret3d.Vector3.create(),n._startWorldQuaternion=egret3d.Quaternion.create(),n._startWorldScale=egret3d.Vector3.create(1,1,1),n._selectedWorldPostion=egret3d.Vector3.create(),n._selectedWorldQuaternion=egret3d.Quaternion.create(),n._cameraPosition=egret3d.Vector3.create(),n._eye=egret3d.Vector3.create(),n._onMouseDown=function(r){var o=egret3d.Vector3.create(r.clientX,r.clientY,0);egret3d.InputManager.mouse.convertPosition(o,o),r.preventDefault();var s=e.Application.sceneManager.activeScene.getRootGameObjects(),a=s.concat(n._pickableSelected);n._axises.activeSelf&&(a=a.concat(n._pickableTool[n._transformMode]));var i=t.Helper.getPickObjects(a,o.x,o.y),l=i[0],c=l?l.transform.gameObject:null;if(c&&c.transform.gameObject.renderer instanceof egret3d.SkinnedMeshRenderer&&(c=c.transform.parent.gameObject),c)if(n._pickableTool[n._transformMode].indexOf(c)<0)n._guiComponent.select(c,!0);else{i=t.Helper.getPickObjects([n._touchPlane],o.x,o.y);var d=n._guiComponent.selectedGameObject;d.transform.getWorldMatrix().decompose(n._startWorldPosition,n._startWorldQuaternion,n._startWorldScale);var u=i[0].position;n._startPoint.copy(u).subtract(n._startWorldPosition,n._startPoint),n._positionStart.copy(d.transform.getPosition())}n._isDragging=!0,o.release()},n._onMouseUp=function(e){n._orbitControls.enableMove=!0,n._isDragging=!1,e.preventDefault()},n._onMouseHover=function(e){if(0===e.buttons||!n._isDragging){var r=egret3d.Vector3.create(e.clientX,e.clientY);egret3d.InputManager.mouse.convertPosition(r,r);var o=t.Helper.getPickObjects(n._pickableTool[n._transformMode],r.x,r.y);if(o.length>0){var s=o[0].transform;switch(s.gameObject.name){case"pickX":n._transformAxis=0;break;case"pickY":n._transformAxis=1;break;case"pickZ":n._transformAxis=2}}else n._transformAxis=null}},n._onMouseMove=function(r){r.preventDefault();var o=n._guiComponent.selectedGameObject;if(0!==r.buttons&&n._isDragging&&null!==n._transformAxis&&o&&o instanceof e.GameObject){var s=egret3d.Vector3.create(r.clientX,r.clientY);egret3d.InputManager.mouse.convertPosition(s,s);var a=t.Helper.getPickObjects([n._touchPlane],s.x,s.y);if(0==a.length)return;n._orbitControls.enableMove=!1;var i=a[0],l=i.position;if(n._endPoint.copy(l).subtract(n._startWorldPosition,n._endPoint),0===n._transformMode){switch(n._transformAxis){case 0:n._endPoint.y=n._startPoint.y,n._endPoint.z=n._startPoint.z;break;case 1:n._endPoint.x=n._startPoint.x,n._endPoint.z=n._startPoint.z;break;case 2:n._endPoint.x=n._startPoint.x,n._endPoint.y=n._startPoint.y}n._endPoint.subtract(n._startPoint,n._endPoint).add(n._positionStart),o.transform.setPosition(n._endPoint)}else if(1===n._transformMode){var c=egret3d.Camera.editor,d=egret3d.Vector3.create(),u=egret3d.Vector3.create(),p=egret3d.Vector3.create(),m=egret3d.Vector3.create(),h=egret3d.Quaternion.create(),_=20/n._selectedWorldPostion.getDistance(d.applyMatrix(c.gameObject.transform.getWorldMatrix())),f=egret3d.Vector3.create();switch(n._transformAxis){case 0:f.set(1,0,0);break;case 1:f.set(0,1,0);break;case 2:f.set(0,0,1)}p.copy(f).applyQuaternion(egret3d.Quaternion.IDENTITY),m.copy(f),n._endPoint.subtract(n._startPoint,n._endPoint);var g=n._endPoint.dot(f.cross(n._eye).normalize())*_;h.fromAxis(m,g).multiply(n._startWorldQuaternion),o.transform.setRotation(h),d.release(),u.release(),p.release(),m.release(),h.release(),f.release()}else if(2===n._transformMode){var b=n._endPoint.clone().divide(n._startPoint);switch(n._transformAxis){case 0:b.y=1,b.z=1;break;case 1:b.x=1,b.z=1;break;case 2:b.x=1,b.y=1}n._endPoint.copy(n._startWorldScale).multiply(b),o.transform.setScale(n._endPoint)}s.release()}},n._onKeyUp=function(e){},n._onKeyDown=function(e){var t=n._guiComponent.selectedGameObject;switch(e.key){case"f":t&&(n._orbitControls.lookAtPoint.copy(t.transform.getPosition()),n._orbitControls.distance=10,n._orbitControls.lookAtOffset.set(0,0,0));break;case"w":n._transformModeHandler(0);break;case"e":n._transformModeHandler(1);break;case"r":n._transformModeHandler(2)}},n._gameObjectSelectedHandler=function(e,t){n._selectGameObject(t)},n._gameObjectUnselectedHandler=function(e,t){n._selectGameObject(null)},n}return __extends(n,r),n.prototype._selectGameObject=function(t){t&&(this._axises&&this._axises.activeSelf&&(this._axises.activeSelf=!1),this._box&&this._box.activeSelf&&(this._box.dontDestroy=!0,this._box.activeSelf=!1),this._skeletonDrawer&&this._skeletonDrawer.activeSelf&&(this._skeletonDrawer.dontDestroy=!0,this._skeletonDrawer.activeSelf=!1),this._axises.activeSelf=!0,this._box.scene!==t.scene&&(this._box.dontDestroy=!this._box.dontDestroy,this._box.dontDestroy=t.scene===e.Scene.globalScene),this._box.parent=t,t.renderer?this._box.activeSelf=!0:this._box.activeSelf=!1,t.renderer&&t.renderer.constructor===egret3d.SkinnedMeshRenderer&&(this._skeletonDrawer?(this._skeletonDrawer.scene!==t.scene&&(this._skeletonDrawer.dontDestroy=!this._skeletonDrawer.dontDestroy,this._skeletonDrawer.dontDestroy=t.scene===e.Scene.globalScene),this._skeletonDrawer.activeSelf=!0):(this._skeletonDrawer=e.GameObject.create("SkeletonDrawer","Editor Only"),this._skeletonDrawer.addComponent(a)),this._skeletonDrawer.parent=t))},n.prototype._transformModeHandler=function(e){this._transformMode=e,this._axises.transform.find("translate").gameObject.activeSelf=0===e,this._axises.transform.find("rotate").gameObject.activeSelf=1===e,this._axises.transform.find("scale").gameObject.activeSelf=2===e},n.prototype._setPoint=function(e,t,r,n,o,s){var a=egret3d.Vector3.create(),i=egret3d.Matrix4.create();if(a.set(r,n,o).applyMatrix(i.inverse(e)).applyMatrix(egret3d.Matrix4.IDENTITY),void 0!==s)for(var l=0,c=s.length;c>l;l++){var d=3*s[l];t[d+0]=a.x,t[d+1]=a.y,t[d+2]=a.z}a.release(),i.release()},n.prototype._updateAxises=function(){if(this._axises&&this._axises.activeSelf){this._axises.transform.position=this._selectedWorldPostion;var e=this._selectedWorldPostion.getDistance(this._cameraPosition),t=this._axises.transform.find("translate"),r=this._axises.transform.find("rotate"),n=this._axises.transform.find("scale"),o=egret3d.Vector3.ONE.clone();if(o.multiplyScalar(e/10),this._axises.transform.setScale(o),0===this._transformMode||2===this._transformMode){t.rotation=this._selectedWorldQuaternion,n.rotation=this._selectedWorldQuaternion}else if(1===this._transformMode){var s=egret3d.Quaternion.IDENTITY,a=s.clone(),i=s.clone(),l=this._eye.clone();l.applyQuaternion(a.inverse());var c=r.find("axisX"),d=r.find("pickX");a.fromAxis(egret3d.Vector3.RIGHT,Math.atan2(-l.y,l.z)),a.multiply(i,a),c.setRotation(a),d.setRotation(a),a.release(),i.release(),l.release();var s=egret3d.Quaternion.IDENTITY,a=s.clone(),i=s.clone(),l=this._eye.clone();l.applyQuaternion(a.inverse());var u=r.find("axisY"),p=r.find("pickY");a.fromAxis(egret3d.Vector3.UP,Math.atan2(l.x,l.z)),a.multiply(i,a);var m=egret3d.Vector3.create();a.toEuler(m),u.setEuler(m.x,m.y,.5*-Math.PI),p.setRotation(a),a.release(),i.release(),l.release();var h=r.find("axisZ"),s=(r.find("pickZ"),egret3d.Quaternion.IDENTITY),a=s.clone(),i=s.clone(),l=this._eye.clone();l.applyQuaternion(a.inverse()),a.fromAxis(egret3d.Vector3.RIGHT,Math.atan2(-l.y,l.z)),a.multiply(i,a),h.setRotation(a);var m=egret3d.Vector3.create();a.toEuler(m),h.setEuler(m.x,.5*Math.PI,m.z),a.release(),i.release(),l.release()}o.release()}this._guiComponent.selectedGameObject&&this._guiComponent.selectedGameObject.transform.getLocalEulerAngles()},n.prototype._updateBox=function(){if(this._box&&this._box.activeSelf){var e=this._guiComponent.selectedGameObject;e.renderer?(this._box.transform.setLocalPosition(e.renderer.aabb.center),this._box.transform.setLocalScale(e.renderer.aabb.size)):this._box.activeSelf=!1}},n.prototype._updateCamera=function(){for(var e=0,r=this._camerasAndLights.cameras;e<r.length;e++){var n=r[e];if("Editor Only"!==n.gameObject.tag){var o=n.transform.find("__editor");if(o){var s=o.gameObject.getComponent(egret3d.MeshFilter).mesh,a=egret3d.Matrix4.create(),i={x:0,y:0,w:0,h:0};n.calcViewPortPixel(i),n.calcProjectMatrix(i.w/i.h,a);var l=s.getVertices();this._setPoint(a,l,0,0,-1,[38,41]),this._setPoint(a,l,0,0,1,[39]),this._setPoint(a,l,-1,-1,-1,[0,7,16,25]),this._setPoint(a,l,1,-1,-1,[1,2,18,27]),this._setPoint(a,l,-1,1,-1,[5,6,20,29]),this._setPoint(a,l,1,1,-1,[3,4,22,31]),this._setPoint(a,l,-1,-1,1,[8,15,17]),this._setPoint(a,l,1,-1,1,[9,10,19]),this._setPoint(a,l,-1,1,1,[13,14,21]),this._setPoint(a,l,1,1,1,[11,12,23]),this._setPoint(a,l,.7,1.1,-1,[32,37]),this._setPoint(a,l,-.7,1.1,-1,[33,34]),this._setPoint(a,l,0,2,-1,[35,36]),this._setPoint(a,l,-1,0,1,[42]),this._setPoint(a,l,1,0,1,[43]),this._setPoint(a,l,0,-1,1,[44]),this._setPoint(a,l,0,1,1,[45]),this._setPoint(a,l,-1,0,-1,[46]),this._setPoint(a,l,1,0,-1,[47]),this._setPoint(a,l,0,-1,-1,[48]),this._setPoint(a,l,0,1,-1,[49]),s.uploadVertexBuffer("POSITION"),a.release()}else{var c=t.EditorMeshHelper.createCameraWireframed("__editor",n.gameObject.tag,n.gameObject.scene);c.parent=n.gameObject;var d=c.transform.find("pick").gameObject;this._pickableSelected.indexOf(d)<0&&this._pickableSelected.push(d)}}}},n.prototype._updateTouchPlane=function(){if(this._guiComponent.selectedGameObject&&this._touchPlane&&!this._touchPlane.isDestroyed){var e=egret3d.Camera.editor,t=this._guiComponent.selectedGameObject.transform.getPosition(),r=t.clone(),n=egret3d.Quaternion.create(),o=egret3d.Vector3.create(1,0,0),s=egret3d.Vector3.create(0,1,0),a=egret3d.Vector3.create(0,0,1);o.set(1,0,0).applyQuaternion(egret3d.Quaternion.IDENTITY),s.set(0,1,0).applyQuaternion(egret3d.Quaternion.IDENTITY),a.set(0,0,1).applyQuaternion(egret3d.Quaternion.IDENTITY);var i=s.clone(),l=egret3d.Vector3.create(),c=e.transform.getPosition().clone();switch(e.opvalue>0&&c.subtract(t,c),c.normalize(),this._transformMode){case 0:case 2:switch(this._transformAxis){case 0:i.copy(c).cross(o),l.copy(o).cross(i);break;case 1:i.copy(c).cross(s),l.copy(s).cross(i);break;case 2:i.copy(c).cross(a),l.copy(a).cross(i)}break;case 1:default:l.set(0,0,0)}if(0===l.length){var d=e.transform.getRotation();n.copy(d)}else{var u=egret3d.Matrix4.create(),p=egret3d.Vector3.create();u.lookAt(p.set(0,0,0),l,i),n.fromMatrix(u),p.release(),u.release()}this._touchPlane.transform.setPosition(r),this._touchPlane.transform.setRotation(n),r.release(),o.release(),s.release(),a.release(),i.release(),l.release(),n.release(),c.release()}},n.prototype.onAwake=function(){},n.prototype.onEnable=function(){e.Application.playerMode=1,this._orbitControls=egret3d.Camera.editor.gameObject.getOrAddComponent(t.OrbitControls),this._grids||(this._grids=t.EditorMeshHelper.createGrid("Grid")),this._touchPlane||(this._touchPlane=t.EditorMeshHelper.createTouchPlane("TouchPlane"),this._touchPlane.activeSelf=!1),this._axises||(this._axises=t.EditorMeshHelper.createAxises("Axis"),this._axises.activeSelf=!1),this._box||(this._box=t.EditorMeshHelper.createBox("Box",egret3d.Color.create(0,1,1).release()),this._box.activeSelf=!1),this._isDragging=!1,this._transformAxis=null,this._pickableTool[0]=[],this._pickableTool[0].push(this._axises.transform.find("translate").find("pickX").gameObject),this._pickableTool[0].push(this._axises.transform.find("translate").find("pickY").gameObject),this._pickableTool[0].push(this._axises.transform.find("translate").find("pickZ").gameObject),this._pickableTool[1]=[],this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickX").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickY").gameObject),this._pickableTool[1].push(this._axises.transform.find("rotate").find("pickZ").gameObject),this._pickableTool[2]=[],this._pickableTool[2].push(this._axises.transform.find("scale").find("pickX").gameObject),this._pickableTool[2].push(this._axises.transform.find("scale").find("pickY").gameObject),this._pickableTool[2].push(this._axises.transform.find("scale").find("pickZ").gameObject),this._pickableSelected.length=0,e.EventPool.addEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.addEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler),egret3d.WebGLCapabilities.canvas.addEventListener("mousedown",this._onMouseDown),egret3d.WebGLCapabilities.canvas.addEventListener("mouseup",this._onMouseUp),egret3d.WebGLCapabilities.canvas.addEventListener("mousemove",this._onMouseHover),egret3d.WebGLCapabilities.canvas.addEventListener("mousemove",this._onMouseMove),window.addEventListener("keyup",this._onKeyUp),window.addEventListener("keydown",this._onKeyDown),this._transformModeHandler(this._transformMode)},n.prototype.onDisable=function(){this._selectGameObject(null),egret3d.Camera.editor.gameObject.removeComponent(t.OrbitControls),this._orbitControls=null;for(var r=0,n=this._camerasAndLights.cameras;r<n.length;r++){var o=n[r];if("Editor Only"!==o.gameObject.tag){var s=o.transform.find("__editor");s&&s.gameObject.destroy()}}e.EventPool.removeEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.removeEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler),egret3d.WebGLCapabilities.canvas.removeEventListener("mousedown",this._onMouseDown),egret3d.WebGLCapabilities.canvas.removeEventListener("mouseup",this._onMouseUp),egret3d.WebGLCapabilities.canvas.removeEventListener("mousemove",this._onMouseHover),egret3d.WebGLCapabilities.canvas.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keydown",this._onKeyDown),this._touchPlane&&!this._touchPlane.isDestroyed&&(this._touchPlane.destroy(),this._touchPlane=null),this._grids&&!this._grids.isDestroyed&&(this._grids.destroy(),this._grids=null),this._axises&&!this._axises.isDestroyed&&(this._axises.destroy(),this._axises=null),this._box&&!this._box.isDestroyed&&(this._box.destroy(),this._box=null),this._skeletonDrawer&&!this._skeletonDrawer.isDestroyed&&(this._skeletonDrawer.destroy(),this._grids=null),this._pickableSelected.length=0,e.Application.playerMode=0},n.prototype.onUpdate=function(e){this._touchPlane&&this._touchPlane.isDestroyed&&(this._touchPlane=null),this._grids&&this._grids.isDestroyed&&(this._grids=null),this._axises&&this._axises.isDestroyed&&(this._axises=null),this._box&&this._box.isDestroyed&&(this._box=null),this._skeletonDrawer&&this._skeletonDrawer.isDestroyed&&(this._skeletonDrawer=null);var t=this._guiComponent.selectedGameObject;if(t&&t.isDestroyed&&this._guiComponent.select(null),t){this._selectedWorldPostion.copy(t.transform.getPosition()),this._selectedWorldQuaternion.copy(t.transform.getRotation());var r=egret3d.Camera.editor;this._cameraPosition.copy(r.transform.getPosition()),0==r.opvalue?this._eye.copy(this._cameraPosition).normalize():this._eye.copy(this._cameraPosition).subtract(this._selectedWorldPostion).normalize()}this._updateAxises(),this._updateBox(),this._updateCamera(),this._updateTouchPlane()},n}(e.BaseSystem);t.GUISceneSystem=s,__reflect(s.prototype,"paper.debug.GUISceneSystem");var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onAwake=function(){var e=t._skeletonMesh,r=egret3d.DefaultMaterials.LINEDASHED_COLOR.clone();e.glTFMesh.primitives[0].mode=1,r.setColor("diffuse",egret3d.Color.create(0,1,1).release()).setDepth(!1,!1).renderQueue=4e3,this.gameObject.getOrAddComponent(egret3d.MeshFilter).mesh=e,this.gameObject.getOrAddComponent(egret3d.MeshRenderer).material=r},t.prototype.onLateUpdate=function(){var e=this.gameObject.getComponentInParent(egret3d.SkinnedMeshRenderer),r=t._skeletonMesh;if(e){var n=0,o=egret3d.Vector3.create(),s=egret3d.Vector3.create(),a=egret3d.Matrix4.create(),i=r.getVertices(),l=e.bones;a.inverse(this.gameObject.transform.worldMatrix);for(var c=0,d=l;c<d.length;c++){var u=d[c];u?u.parent&&l.indexOf(u.parent)>=0?(o.applyMatrix(a,u.parent.position).toArray(i,n),o.applyMatrix(a,u.position).toArray(i,n+3)):(u.getRight(s).applyDirection(a).multiplyScalar(.25),o.applyMatrix(a,u.position).toArray(i,n),o.applyMatrix(a,u.position).add(s).toArray(i,n+3)):(egret3d.Vector3.ZERO.toArray(i,n),egret3d.Vector3.ZERO.toArray(i,n+3)),n+=6}r.uploadVertexBuffer(),o.release(),s.release(),a.release()}},t._skeletonMesh=egret3d.Mesh.create(128,0,["POSITION","COLOR_0"],null,35048),t}(e.Behaviour);__reflect(a.prototype,"SkeletonDrawer")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(r){function n(){var n=null!==r&&r.apply(this,arguments)||this;return n._interests=[[{componentClass:egret3d.Transform}]],n._disposeCollecter=e.GameObject.globalGameObject.getOrAddComponent(e.DisposeCollecter),n._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),n._hierarchyFolders={},n._inspectorFolders={},n._selectGameObject=null,n._selectFolder=null,n._sceneSelectedHandler=function(e,t){n._selectSceneOrGameObject(t)},n._sceneUnselectedHandler=function(e,t){n._selectSceneOrGameObject(null)},n._gameObjectSelectedHandler=function(e,t){n._selectSceneOrGameObject(t)},n._gameObjectUnselectedHandler=function(e,t){n._selectSceneOrGameObject(null)},n._createGameObject=function(){n._guiComponent.selectedScene?n._selectGameObject=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",n._guiComponent.selectedScene):(n._selectGameObject=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",n._guiComponent.selectedGameObject.scene),n._selectGameObject.transform.parent=n._guiComponent.selectedGameObject.transform)},n._destroySceneOrGameObject=function(){var e=n._guiComponent.inspector.instance;e&&(n._guiComponent.select(null),e.destroy())},n._nodeClickHandler=function(e){n._guiComponent.select(e.instance,!0)},n}return __extends(n,r),n.prototype._openFolder=function(e){e.open(),e.parent&&e.parent!==this._guiComponent.hierarchy&&this._openFolder(e.parent)},n.prototype._selectSceneOrGameObject=function(t){if(this._selectFolder&&(this._selectFolder.selected=!1,this._selectFolder=null),this._guiComponent.inspector.instance=t,t)if(t.uuid in this._hierarchyFolders&&(this._selectFolder=this._hierarchyFolders[t.uuid],this._selectFolder.selected=!0,this._openFolder(this._selectFolder.parent)),t instanceof e.Scene)this._guiComponent.inspector.add(this,"_createGameObject","createObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);else{this._guiComponent.inspector.add(this,"_createGameObject","createChildObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);for(var r=0,n=t.components;r<n.length;r++){var o=n[r],s=this._guiComponent.inspector.addFolder(o.uuid,egret.getQualifiedClassName(o));s.instance=o,this._inspectorFolders[o.uuid]=s,this._addToInspector(s)}}else{for(var a in this._inspectorFolders)delete this._inspectorFolders[a];if(this._guiComponent.inspector.__controllers)for(var i=0,l=this._guiComponent.inspector.__controllers.concat();i<l.length;i++){var c=l[i];this._guiComponent.inspector.remove(c)}if(this._guiComponent.inspector.__folders)for(var a in this._guiComponent.inspector.__folders)this._guiComponent.inspector.removeFolder(this._guiComponent.inspector.__folders[a])}},n.prototype._addToHierarchy=function(e){if(!(e.uuid in this._hierarchyFolders||"Editor Only"===e.tag||2===e.hideFlags||3===e.hideFlags)){var t=this._hierarchyFolders[e.transform.parent?e.transform.parent.gameObject.uuid:e.scene.uuid];if(!t){if(e.transform.parent)throw new Error;t=this._guiComponent.hierarchy.addFolder(e.scene.uuid,e.scene.name+" <Scene>"),t.instance=e.scene,t.onClick=this._nodeClickHandler,this._hierarchyFolders[e.scene.uuid]=t}var r=t.addFolder(e.uuid,e.name);r.instance=e,r.onClick=this._nodeClickHandler,this._hierarchyFolders[e.uuid]=r}},n.prototype._addToInspector=function(t){for(var r,n,o,s=e.editor.getEditInfo(t.instance),a=function(e){switch(e.editType){case 0:r=i._guiComponent.inspector.add(t.instance,e.name).min(0).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 1:r=i._guiComponent.inspector.add(t.instance,e.name).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 2:r=i._guiComponent.inspector.add(t.instance,e.name).step(.1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 4:case 3:i._guiComponent.inspector.add(t.instance,e.name).listen();break;case 10:i._guiComponent.inspector.add(t.instance,e.name,e.option.listItems).listen();break;case 5:var s=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(s)if(s.get&&s.set){var a=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),r.onChange(a),n.onChange(a)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen();break;case 6:var s=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(s){if(s.get&&s.set){var a=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen(),r.onChange(a),n.onChange(a),o.onChange(a)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen();e.option&&(void 0!==e.option.minimum&&(r.min(e.option.minimum),n.min(e.option.minimum),o.min(e.option.minimum)),void 0!==e.option.maximum&&(r.max(e.option.maximum),n.max(e.option.maximum),o.max(e.option.maximum)),void 0!==e.option.step&&(r.step(e.option.step),n.step(e.option.step),o.step(e.option.step)))}break;case 7:case 8:break;case 9:break;case 11:break;case 14:}},i=this,l=0,c=s;l<c.length;l++){var d=c[l];a(d)}},n.prototype.onAwake=function(){},n.prototype.onEnable=function(){e.EventPool.addEventListener("SceneSelected",t.GUIComponent,this._sceneSelectedHandler),e.EventPool.addEventListener("SceneUnselected",t.GUIComponent,this._sceneUnselectedHandler),e.EventPool.addEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.addEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler),this.onAddGameObject(e.GameObject.globalGameObject,this._groups[0]);for(var r=0,n=this._groups[0].gameObjects;r<n.length;r++){var o=n[r];this._addToHierarchy(o)}},n.prototype.onAddGameObject=function(e,t){this._addToHierarchy(e)},n.prototype.onUpdate=function(e){if(this._selectGameObject&&(this._guiComponent.select(this._selectGameObject,!0),this._selectGameObject=null),this._guiComponent.inspector.updateDisplay(),this._guiComponent.inspector.__folders)for(var t in this._guiComponent.inspector.__folders)this._guiComponent.inspector.__folders[t].updateDisplay();for(var r=0,n=this._disposeCollecter.scenes;r<n.length;r++){var o=n[r],s=this._hierarchyFolders[o.uuid];if(delete this._hierarchyFolders[o.uuid],s&&s.parent)try{s.parent.removeFolder(s)}catch(a){}}for(var i=0,l=this._disposeCollecter.gameObjects;i<l.length;i++){var c=l[i],s=this._hierarchyFolders[c.uuid];if(delete this._hierarchyFolders[c.uuid],s&&s.parent)try{s.parent.removeFolder(s)}catch(a){}}for(var d=0,u=this._disposeCollecter.components;d<u.length;d++){var p=u[d],s=this._inspectorFolders[p.uuid];if(delete this._inspectorFolders[p.uuid],s&&s.parent)try{s.parent.removeFolder(s)}catch(a){}}},n.prototype.onDisable=function(){e.EventPool.removeEventListener("SceneSelected",t.GUIComponent,this._sceneSelectedHandler),e.EventPool.removeEventListener("SceneUnselected",t.GUIComponent,this._sceneUnselectedHandler),e.EventPool.removeEventListener("GameObjectSelected",t.GUIComponent,this._gameObjectSelectedHandler),e.EventPool.removeEventListener("GameObjectUnselected",t.GUIComponent,this._gameObjectUnselectedHandler);for(var r in this._hierarchyFolders){var n=this._hierarchyFolders[r];if(delete this._hierarchyFolders[r],n&&n.parent)try{n.parent.removeFolder(n)}catch(o){}}},n}(e.BaseSystem);t.GUISystem=r,__reflect(r.prototype,"paper.debug.GUISystem")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=(new egret3d.Vector2,new egret3d.Vector2,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lookAtPoint=egret3d.Vector3.create(0,0,0),t.lookAtOffset=egret3d.Vector3.create(),t.distance=30,t.minPanAngle=-(1/0),t.maxPanAngle=1/0,t.minTileAngle=-90,t.maxTileAngle=90,t.moveSpped=.001,t.scaleSpeed=.2,t._enableMove=!0,t._mouseDown=!1,t._fingerTwo=!1,t._panAngle=0,t._panRad=0,t._tiltAngle=0,t._tiltRad=0,t._mouseDownHandler=function(e){e.preventDefault(),t._mouseDown=!0,t._lastMouseX=e.x,t._lastMouseY=e.y},t._mouseUpHandler=function(e){e.preventDefault(),t._mouseDown=!1},t._mouseMoveHandler=function(e){if(t._mouseDown&&t._enableMove){var r=egret3d.Vector3.create(e.x-t._lastMouseX,e.y-t._lastMouseY,0);if(e.ctrlKey){r.x=-r.x;var n=t.lookAtTarget?t.lookAtTarget.getPosition():t.lookAtPoint,o=t.gameObject.transform.getPosition().getDistance(n),s=egret3d.Matrix3.create();r.multiplyScalar(o*t.moveSpped).applyMatrix3(s.getNormalMatrix(t.gameObject.transform.getLocalMatrix())),s.release(),t.lookAtOffset.add(r)}else t.panAngle+=r.x,t.tiltAngle+=r.y;t._lastMouseX=e.x,t._lastMouseY=e.y,r.release(),e.preventDefault()}},t._mouseWheelHandler=function(e){t.distance=Math.max(t.distance-(e.wheelDelta>0?2:-2),1),e.preventDefault()},t}return __extends(t,e),Object.defineProperty(t.prototype,"panAngle",{get:function(){return this._panAngle},set:function(e){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,e)),this._panRad=this._panAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(e){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,e)),this._tiltRad=this._tiltAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableMove",{get:function(){return this._enableMove},set:function(e){this._enableMove!==e&&(this._enableMove=e)},enumerable:!0,configurable:!0}),t.prototype.onStart=function(){this.bindTouch=egret3d.InputManager.touch,this.bindMouse=egret3d.InputManager.mouse,this.bindMouse.disableContextMenu()},t.prototype.onEnable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.addEventListener("mousedown",this._mouseDownHandler),e.addEventListener("mouseup",this._mouseUpHandler),e.addEventListener("mouseout",this._mouseUpHandler),e.addEventListener("dblclick",this._mouseUpHandler),e.addEventListener("mousemove",this._mouseMoveHandler),e.addEventListener("wheel",this._mouseWheelHandler))
},t.prototype.onDisable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseout",this._mouseUpHandler),e.removeEventListener("dblclick",this._mouseUpHandler),e.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("wheel",this._mouseWheelHandler))},t.prototype.onUpdate=function(e){this._enableMove&&this.move()},t.prototype.move=function(){var e=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),t=this.distance*(0===this._tiltRad?0:Math.sin(this._tiltRad)),r=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),n=egret3d.Vector3.create();this.lookAtTarget?n.copy(this.lookAtTarget.getPosition()):n.copy(this.lookAtPoint),n.add(this.lookAtOffset),this.gameObject.transform.setPosition(n.x+e,n.y+t,n.z+r),this.gameObject.transform.lookAt(n),n.release()},t}(e.Behaviour));t.OrbitControls=r,__reflect(r.prototype,"paper.debug.OrbitControls")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(){function t(){}return t._createGameObject=function(t,r,n,o,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o="Editor Only"),void 0===s&&(s=e.Scene.editorScene);var a=e.GameObject.create(t,o,s);return a.hideFlags=3,r&&(a.addComponent(egret3d.MeshFilter).mesh=r),n&&(a.addComponent(egret3d.MeshRenderer).material=n),a},t.createGrid=function(e,t,r,n,o){void 0===t&&(t=50),void 0===r&&(r=50),void 0===n&&(n=egret3d.Color.create(.26,.26,.26)),void 0===o&&(o=egret3d.Color.create(.53,.53,.53));for(var s=r/2,a=t/r,i=t/2,l=[],c=[],d=0,u=-i;r>=d;d++,u+=a){l.push(-i,0,u),l.push(i,0,u),l.push(u,0,-i),l.push(u,0,i);var p=d===s?n:o;c.push(p.r,p.g,p.b,p.a),c.push(p.r,p.g,p.b,p.a),c.push(p.r,p.g,p.b,p.a),c.push(p.r,p.g,p.b,p.a)}for(var m=0;m<c.length;m+=80)for(var h=0;16>h;h++)c[m+h]=.26;var _=new egret3d.Mesh(l.length,0,["POSITION","COLOR_0"]);_.setAttributes("POSITION",l),_.setAttributes("COLOR_0",c),_.glTFMesh.primitives[0].mode=1;var f=this._createGameObject(e,_,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return f},t.createTouchPlane=function(e,t,r){void 0===t&&(t=5e5),void 0===r&&(r=5e5);var n=this._createGameObject(e,egret3d.DefaultMeshes.createPlane(t,r),egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return n},t.createAxises=function(e){var t=this._createGameObject(e),r=this._createGameObject("translate");r.transform.setParent(t.transform);var n=this._createGameObject("axisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),o=this._createGameObject("axisY",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=this._createGameObject("axisZ",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this._createGameObject("arrowX",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=this._createGameObject("arrowY",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this._createGameObject("arrowZ",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this._createGameObject("pickX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this._createGameObject("pickY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),u=this._createGameObject("pickZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone());n.transform.setParent(r.transform),o.transform.setParent(r.transform).setLocalEuler(0,0,.5*Math.PI),s.transform.setParent(r.transform).setLocalEuler(0,.5*-Math.PI,0),a.transform.setParent(n.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),i.transform.setParent(o.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),l.transform.setParent(s.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.05,.1,.05),c.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.RIGHT.clone().multiplyScalar(.5)).setLocalScale(1.2,.1,.1),d.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.UP.clone().multiplyScalar(.5)).setLocalScale(.1,1.2,.1),u.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.FORWARD.clone().multiplyScalar(.5)).setLocalScale(.1,.1,1.2),c.activeSelf=d.activeSelf=u.activeSelf=!1,n.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),o.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),s.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),i.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.addDefine("USE_COLOR").setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),u.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3);var p=this._createGameObject("rotate");p.transform.setParent(t.transform);var n=this._createGameObject("axisX",egret3d.DefaultMeshes.CIRCLE_LINE,egret3d.DefaultMaterials.MESH_BASIC.clone()),o=this._createGameObject("axisY",egret3d.DefaultMeshes.CIRCLE_LINE,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=this._createGameObject("axisZ",egret3d.DefaultMeshes.CIRCLE_LINE,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this._createGameObject("pickX",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this._createGameObject("pickY",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone()),u=this._createGameObject("pickZ",egret3d.DefaultMeshes.TORUS,egret3d.DefaultMaterials.MESH_BASIC.clone());n.transform.setParent(p.transform).setLocalEuler(0,0,0),o.transform.setParent(p.transform).setLocalEuler(0,0,.5*-Math.PI),s.transform.setParent(p.transform).setLocalEuler(0,.5*Math.PI,0),c.transform.setParent(p.transform).setLocalEuler(0,.5*-Math.PI,.5*-Math.PI),d.transform.setParent(p.transform).setLocalEuler(.5*Math.PI,0,0),u.transform.setParent(p.transform).setLocalEuler(0,0,.5*-Math.PI),c.activeSelf=d.activeSelf=u.activeSelf=!1,n.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),o.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),s.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),u.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3);var m=this._createGameObject("scale");m.transform.setParent(t.transform);var n=this._createGameObject("axisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),o=this._createGameObject("axisY",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=this._createGameObject("axisZ",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=this._createGameObject("arrowX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=this._createGameObject("arrowY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=this._createGameObject("arrowZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=this._createGameObject("pickX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=this._createGameObject("pickY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),u=this._createGameObject("pickZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone());return n.transform.setParent(m.transform),o.transform.setParent(m.transform).setLocalEuler(0,0,.5*Math.PI),s.transform.setParent(m.transform).setLocalEuler(0,.5*-Math.PI,0),a.transform.setParent(n.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),i.transform.setParent(o.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),l.transform.setParent(s.transform).setLocalEuler(0,0,.5*-Math.PI).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.2,.2,.2),c.transform.setParent(m.transform).setLocalPosition(egret3d.Vector3.RIGHT.clone().multiplyScalar(.5)).setLocalScale(1.2,.2,.2),d.transform.setParent(m.transform).setLocalPosition(egret3d.Vector3.UP.clone().multiplyScalar(.5)).setLocalScale(.2,1.2,.2),u.transform.setParent(m.transform).setLocalPosition(egret3d.Vector3.FORWARD.clone().multiplyScalar(.5)).setLocalScale(.2,.2,1.2),c.activeSelf=d.activeSelf=u.activeSelf=!1,n.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),o.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),s.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),a.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),i.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),l.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),c.renderer.material.setColor("diffuse",egret3d.Color.RED).setDepth(!1,!1).setRenderQueue(4e3),d.renderer.material.setColor("diffuse",egret3d.Color.GREEN).setDepth(!1,!1).setRenderQueue(4e3),u.renderer.material.setColor("diffuse",egret3d.Color.BLUE).setDepth(!1,!1).setRenderQueue(4e3),t},t.createBox=function(e,t){var r=this._createGameObject(e,egret3d.DefaultMeshes.CUBE_LINE,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return r.getComponent(egret3d.MeshRenderer).material.setColor("diffuse",egret3d.Color.create(0,1,1).release()),r},t.createCameraWireframed=function(e,t,r,n,o,s,a,i){void 0===n&&(n=egret3d.Color.create(1,.7,0)),void 0===o&&(o=egret3d.Color.RED),void 0===s&&(s=egret3d.Color.create(0,.7,1)),void 0===a&&(a=egret3d.Color.WHITE),void 0===i&&(i=egret3d.Color.create(.2,.2,.2));for(var l=[],c=[],d=50,u=0;d>u;u++)l.push(0,0,0),24>u?c.push(n.r,n.g,n.b,n.a):32>u?c.push(o.r,o.g,o.b,o.a):38>u?c.push(s.r,s.g,s.b,s.a):40>u?c.push(a.r,a.g,a.b,a.a):c.push(i.r,i.g,i.b,i.a);var p=new egret3d.Mesh(d,0,["POSITION","COLOR_0"]);p.setAttributes("POSITION",l),p.setAttributes("COLOR_0",c),p.glTFMesh.primitives[0].mode=1;var m=this._createGameObject(e,p,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone(),t,r),h=this._createGameObject("pick",egret3d.DefaultMeshes.CUBE,null,t,r);return h.transform.parent=m.transform,h.activeSelf=!1,m},t}();t.EditorMeshHelper=r,__reflect(r.prototype,"paper.debug.EditorMeshHelper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(e){var t=function(){function e(){}return e._rayCastGameObject=function(e,t,r){if(t.activeInHierarchy||"Editor Only"===t.tag){var n=null,o=t.getComponent(egret3d.MeshFilter);if(o&&o.mesh)n=o.mesh.raycast(e,t.transform.getWorldMatrix()),n&&(n.transform=t.transform,r.push(n));else{var s=t.getComponent(egret3d.SkinnedMeshRenderer);s&&s.mesh&&(n=s.mesh.raycast(e,t.transform.getWorldMatrix(),s.boneMatrices),n&&(n.transform=t.transform,r.push(n)))}if(!n)for(var a=0,i=t.transform.children;a<i.length;a++){var l=i[a];this._rayCastGameObject(e,l.gameObject,r)}}},e.getPickObjects=function(e,t,r){for(var n=egret3d.Camera.editor,o=n.createRayByScreen(t,r),s=[],a=0,i=e;a<i.length;a++){var l=i[a];this._rayCastGameObject(o,l,s)}return s.sort(function(e,t){return t.distance-e.distance}),s},e}();e.Helper=t,__reflect(t.prototype,"paper.debug.Helper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var helper;!function(e){function t(e){for(var t=e.substr(e.lastIndexOf("/")+1),r=t.indexOf(".",0),n="";r>=0;){if(n=t.substr(r),".vs.glsl"==n)return"GLVertexShader";if(".assetbundle.json"==n)return"Bundle";if(".fs.glsl"==n)return"GLFragmentShader";if(".png"==n||".jpg"==n)return"Texture";if(".pvr.bin"==n||".pvr"==n)return"PVR";if(".prefab.json"==n)return"Prefab";if(".scene.json"==n)return"Scene";if(".atlas.json"==n)return"Atlas";if(".font.json"==n)return"Font";if(".json"==n||".txt"==n||".effect.json"==n)return"TextAsset";if(".packs.bin"==n)return"PackBin";if(".packs.txt"==n)return"PackTxt";if(".path.json"==n)return"pathAsset";if(".mp3"==n||".ogg"==n)return"Sound";if(".shader.json"==n)return"Shader";if(".image.json"==n)return"TextureDesc";if(".mat.json"==n)return"Material";if(".mesh.bin"==n)return"Mesh";if(".ani.bin"==n)return"Animation";r=t.indexOf(".",r+1)}return"Unknown"}function r(e,r){return void 0===r&&(r="resource/"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return n?[3,2]:[4,RES.loadConfig("resource/default.res.json",r)];case 1:o.sent(),n=!0,o.label=2;case 2:return[2,new Promise(function(n){RES.getResByUrl(r+e,function(e){paper.Asset.register(e),n()},RES,t(e))})]}})})}var n=!1;e.getResAsync=r}(helper||(helper={}));