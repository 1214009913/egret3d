"use strict";var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);r.prototype=t.prototype,e.prototype=new r},__decorate=this&&this.__decorate||function(e,t,r,o){var n,a=arguments.length,s=3>a?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(s=(3>a?n(s):a>3?n(t,r,s):n(t,r))||s);return a>3&&s&&Object.defineProperty(t,r,s),s},__awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,a){function s(e){try{l(o.next(e))}catch(t){a(t)}}function i(e){try{l(o["throw"](e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(s,i)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return o([e,t])}}function o(r){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(s=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,a=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(s=l.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){l.label=r[1];break}if(6===r[0]&&l.label<s[1]){l.label=s[1],s=r;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(r);break}s[2]&&l.ops.pop(),l.trys.pop();continue}r=t.call(e,l)}catch(o){r=[6,o],a=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,s,i,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i},paper;!function(e){var t;!function(t){var r=function(r){function o(){return null!==r&&r.apply(this,arguments)||this}return __extends(o,r),o.prototype.onAwake=function(){2===e.Application.playerMode?e.Application.systemManager.getOrRegisterSystem(t.SceneSystem):e.Application.systemManager.getOrRegisterSystem(t.GUISystem)},o}(e.BaseSystem);t.EditorSystem=r,__reflect(r.prototype,"paper.debug.EditorSystem"),e.Application.systemManager.preRegister(r,e.LateUpdateSystem)}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pickTarget=null,t}return __extends(t,e),t.prototype.onDestroy=function(){this.pickTarget=null},t}(e.Behaviour);t.GizmoPickComponent=r,__reflect(r.prototype,"paper.debug.GizmoPickComponent")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.inspector=new dat.GUI({closeOnTop:!0,width:330}),t.hierarchy=new dat.GUI({closeOnTop:!0,width:330}),t}return __extends(t,e),t}(e.SingletonComponent);t.GUIComponent=r,__reflect(r.prototype,"paper.debug.GUIComponent")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r;!function(e){e.SceneSelected="SceneSelected",e.SceneUnselected="SceneUnselected",e.GameObjectHovered="GameObjectHovered",e.GameObjectSelected="GameObjectSelected",e.GameObjectUnselected="GameObjectUnselected"}(r=t.ModelComponentEvent||(t.ModelComponentEvent={}));var o=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectedGameObjects=[],e.selectedScene=null,e.hoveredGameObject=null,e.selectedGameObject=null,e.editorModel=null,e}return __extends(r,t),r.prototype._onEditorSelectGameObjects=function(e){for(var t=0,r=e;t<r.length;t++){var o=r[t];this.select(o)}for(var n=0,a=this.selectedGameObjects;n<a.length;n++){var o=a[n];e.indexOf(o)<0&&this.unselect(o)}},r.prototype._onChangeEditMode=function(e){},r.prototype._onChangeEditType=function(e){},r.prototype._onChangeProperty=function(e){},r.prototype.initialize=function(){var t=this;setTimeout(function(){2===e.Application.playerMode&&(t.editorModel=e.editor.Editor.activeEditorModel,t.editorModel.addEventListener(e.editor.EditorModelEvent.SELECT_GAMEOBJECTS,function(e){return t._onEditorSelectGameObjects(e.data)},t),t.editorModel.addEventListener(e.editor.EditorModelEvent.CHANGE_EDIT_MODE,function(e){return t._onChangeEditMode(e.data)},t),t.editorModel.addEventListener(e.editor.EditorModelEvent.CHANGE_EDIT_TYPE,function(e){return t._onChangeEditType(e.data)},t),t.editorModel.addEventListener(e.editor.EditorModelEvent.CHANGE_PROPERTY,function(e){return t._onChangeProperty(e.data)},t))},3e3)},r.prototype.select=function(t,r){if(t)if(t instanceof e.Scene){if(this.selectedScene===t)return}else if(this.selectedGameObject===t||this.selectedGameObjects.indexOf(t)>=0)return;if((!t||t instanceof e.Scene||this.selectedScene)&&(r=!0),r)if(this.selectedScene){var o=this.selectedScene;this.selectedScene=null,e.EventPool.dispatchEvent("SceneUnselected",this,o)}else if(this.selectedGameObjects.length>0){var n=this.selectedGameObjects.concat();this.selectedGameObjects.length=0,this.selectedGameObject=null;for(var a=0,s=n;a<s.length;a++){var i=s[a];e.EventPool.dispatchEvent("GameObjectUnselected",this,i)}}t&&(t instanceof e.Scene?(this.selectedScene=t,e.EventPool.dispatchEvent("SceneSelected",this,t)):(this.selectedGameObjects.push(t),this.selectedGameObject=t,e.EventPool.dispatchEvent("GameObjectSelected",this,t))),(global||window).psgo=t},r.prototype.unselect=function(t){if(t instanceof e.Scene)this.selectedScene===t&&(this.selectedScene=null,e.EventPool.dispatchEvent("SceneUnselected",this,t));else{var r=this.selectedGameObjects.indexOf(t);r>=0&&(this.selectedGameObject===t&&(this.selectedGameObject=null),this.selectedGameObjects.splice(r,1),e.EventPool.dispatchEvent("GameObjectUnselected",this,t))}},r.prototype.hover=function(t){this.hoveredGameObject!==t&&(this.hoveredGameObject=t,e.EventPool.dispatchEvent("GameObjectHovered",this,this.hoveredGameObject))},r}(e.SingletonComponent);t.ModelComponent=o,__reflect(o.prototype,"paper.debug.ModelComponent")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.lookAtPoint=egret3d.Vector3.create(0,0,0),e.lookAtOffset=egret3d.Vector3.create(),e.distance=30,e.minPanAngle=-(1/0),e.maxPanAngle=1/0,e.minTileAngle=-90,e.maxTileAngle=90,e.moveSpped=.001,e.scaleSpeed=.2,e._enableMove=!0,e._mouseDown=!1,e._fingerTwo=!1,e._panAngle=0,e._panRad=0,e._tiltAngle=0,e._tiltRad=0,e._mouseDownHandler=function(t){2===t.button&&(e._mouseDown=!0,e._lastMouseX=t.x,e._lastMouseY=t.y,t.preventDefault())},e._mouseUpHandler=function(t){2===t.button&&(e._mouseDown=!1,t.preventDefault())},e._mouseMoveHandler=function(t){if(e._mouseDown&&e._enableMove){var r=egret3d.Vector3.create(t.x-e._lastMouseX,t.y-e._lastMouseY,0);if(t.ctrlKey){r.x=-r.x;var o=e.lookAtPoint,n=e.gameObject.transform.getPosition().getDistance(o),a=egret3d.Matrix3.create();r.multiplyScalar(n*e.moveSpped).applyMatrix3(a.getNormalMatrix(e.gameObject.transform.getLocalMatrix())),a.release(),e.lookAtOffset.add(r)}else e.panAngle+=r.x,e.tiltAngle+=r.y;e._lastMouseX=t.x,e._lastMouseY=t.y,r.release(),t.preventDefault()}},e._mouseWheelHandler=function(t){e.distance=Math.max(e.distance-(t.wheelDelta>0?2:-2),1),t.preventDefault()},e}return __extends(r,t),Object.defineProperty(r.prototype,"panAngle",{get:function(){return this._panAngle},set:function(e){this._panAngle=Math.max(this.minPanAngle,Math.min(this.maxPanAngle,e)),this._panRad=this._panAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tiltAngle",{get:function(){return this._tiltAngle},set:function(e){this._tiltAngle=Math.max(this.minTileAngle,Math.min(this.maxTileAngle,e)),this._tiltRad=this._tiltAngle*Math.PI/180},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"enableMove",{get:function(){return this._enableMove},set:function(e){this._enableMove!==e&&(this._enableMove=e)},enumerable:!0,configurable:!0}),r.prototype.onStart=function(){this.bindTouch=egret3d.InputManager.touch,this.bindMouse=egret3d.InputManager.mouse,this.bindMouse.disableContextMenu()},r.prototype.onEnable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.addEventListener("mousedown",this._mouseDownHandler),e.addEventListener("mouseup",this._mouseUpHandler),e.addEventListener("mouseout",this._mouseUpHandler),e.addEventListener("dblclick",this._mouseUpHandler),e.addEventListener("mousemove",this._mouseMoveHandler),e.addEventListener("wheel",this._mouseWheelHandler))},r.prototype.onDisable=function(){var e=egret3d.WebGLCapabilities.canvas;e&&(e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseout",this._mouseUpHandler),e.removeEventListener("dblclick",this._mouseUpHandler),e.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("wheel",this._mouseWheelHandler))},r.prototype.onUpdate=function(e){this._enableMove&&this.move()},r.prototype.move=function(){var e=this.distance*Math.sin(this._panRad)*Math.cos(this._tiltRad),t=this.distance*(0===this._tiltRad?0:Math.sin(this._tiltRad)),r=this.distance*Math.cos(this._panRad)*Math.cos(this._tiltRad),o=egret3d.Vector3.create();o.copy(this.lookAtPoint),o.add(this.lookAtOffset),this.gameObject.transform.setPosition(o.x+e,o.y+t,o.z+r),this.gameObject.transform.lookAt(o),o.release()},r=__decorate([e.executeInEditMode],r)}(e.Behaviour);t.OrbitControls=r,__reflect(r.prototype,"paper.debug.OrbitControls")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.isWorldSpace=!0,r.eye=egret3d.Vector3.create(),r.translate=t.EditorMeshHelper.createGameObject("Translate"),r.rotate=t.EditorMeshHelper.createGameObject("Rotate"),r.scale=t.EditorMeshHelper.createGameObject("Scale"),r._controlling=!1,r._prsStarts={},r._offsetStart=egret3d.Vector3.create(),r._offsetEnd=egret3d.Vector3.create(),r._plane=egret3d.Plane.create(),r._quad=t.EditorMeshHelper.createGameObject("Plane",egret3d.DefaultMeshes.QUAD,egret3d.DefaultMaterials.MESH_BASIC_DOUBLESIDE.clone().setBlend(1).setOpacity(.5)),r._highlights={},r._mode=null,r._hovered=null,r._dir={X:egret3d.Vector3.RIGHT,Y:egret3d.Vector3.UP,Z:egret3d.Vector3.FORWARD},r}return __extends(r,e),r.prototype.initialize=function(){e.prototype.initialize.call(this);var r=this.translate,o=t.EditorMeshHelper.createGameObject("AxisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),n=t.EditorMeshHelper.createGameObject("AxisY",egret3d.DefaultMeshes.LINE_Y,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=t.EditorMeshHelper.createGameObject("AxisZ",egret3d.DefaultMeshes.LINE_Z,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=t.EditorMeshHelper.createGameObject("ArrowX",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=t.EditorMeshHelper.createGameObject("ArrowY",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=t.EditorMeshHelper.createGameObject("ArrowZ",egret3d.DefaultMeshes.PYRAMID,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=t.EditorMeshHelper.createGameObject("X",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=t.EditorMeshHelper.createGameObject("Y",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),m=t.EditorMeshHelper.createGameObject("Z",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),p=t.EditorMeshHelper.createGameObject("XY",egret3d.DefaultMeshes.QUAD,egret3d.Material.create(egret3d.DefaultShaders.MESH_BASIC_DOUBLESIDE),""),u=t.EditorMeshHelper.createGameObject("YZ",egret3d.DefaultMeshes.QUAD,egret3d.Material.create(egret3d.DefaultShaders.MESH_BASIC_DOUBLESIDE),""),h=t.EditorMeshHelper.createGameObject("ZX",egret3d.DefaultMeshes.QUAD,egret3d.Material.create(egret3d.DefaultShaders.MESH_BASIC_DOUBLESIDE),"");this._highlights[c.uuid]=[c,o,s],this._highlights[d.uuid]=[d,n,i],this._highlights[m.uuid]=[m,a,l],r.transform.setParent(this.gameObject.transform),o.transform.setParent(r.transform).setLocalPosition(.001,0,0),n.transform.setParent(r.transform).setLocalPosition(0,.001,0),a.transform.setParent(r.transform).setLocalPosition(0,0,.001),s.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.RIGHT).setLocalEuler(0,0,.5*-Math.PI).setLocalScale(.1,.2,.1),i.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.UP).setLocalScale(.1,.2,.1),l.transform.setParent(r.transform).setLocalPosition(egret3d.Vector3.FORWARD).setLocalEuler(.5*Math.PI,0,0).setLocalScale(.1,.2,.1),c.transform.setParent(r.transform).setLocalPosition(.7,0,0).setLocalScale(.9,.15,.15).gameObject.activeSelf=!1,d.transform.setParent(r.transform).setLocalPosition(0,.7,0).setLocalScale(.15,.9,.15).gameObject.activeSelf=!1,m.transform.setParent(r.transform).setLocalPosition(0,0,.7).setLocalScale(.15,.15,.9).gameObject.activeSelf=!1,p.transform.setParent(r.transform).setLocalPosition(.15,.15,0).setLocalScale(.3),u.transform.setParent(r.transform).setLocalPosition(0,.15,.15).setLocalEuler(0,.5*Math.PI,0).setLocalScale(.3),h.transform.setParent(r.transform).setLocalPosition(.15,0,.15).setLocalEuler(.5*Math.PI,0,0).setLocalScale(.3),o.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),n.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),a.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),s.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),i.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),l.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),c.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),d.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),m.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),p.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.YELLOW),u.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.INDIGO),h.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.PURPLE);var f=this.rotate,o=t.EditorMeshHelper.createGameObject("AxisX",egret3d.DefaultMeshes.createCircle(1,.5,1),egret3d.DefaultMaterials.MESH_BASIC.clone()),n=t.EditorMeshHelper.createGameObject("AxisY",egret3d.DefaultMeshes.createCircle(1,.5,2),egret3d.DefaultMaterials.MESH_BASIC.clone()),a=t.EditorMeshHelper.createGameObject("AxisZ",egret3d.DefaultMeshes.createCircle(1,.5,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),_=t.EditorMeshHelper.createGameObject("AxisE",egret3d.DefaultMeshes.createCircle(1.25,1,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),g=t.EditorMeshHelper.createGameObject("AxisXYZE",egret3d.DefaultMeshes.createCircle(1,1,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),c=t.EditorMeshHelper.createGameObject("X",egret3d.DefaultMeshes.createTorus(1,.1,4,12,.5,1),egret3d.DefaultMaterials.MESH_BASIC.clone()),d=t.EditorMeshHelper.createGameObject("Y",egret3d.DefaultMeshes.createTorus(1,.1,4,12,.5,2),egret3d.DefaultMaterials.MESH_BASIC.clone()),m=t.EditorMeshHelper.createGameObject("Z",egret3d.DefaultMeshes.createTorus(1,.1,4,12,.5,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),v=t.EditorMeshHelper.createGameObject("E",egret3d.DefaultMeshes.createTorus(1.25,.1,4,24,1,3),egret3d.DefaultMaterials.MESH_BASIC.clone()),b=t.EditorMeshHelper.createGameObject("XYZE",egret3d.DefaultMeshes.createSphere(.7,10,8),egret3d.DefaultMaterials.MESH_BASIC.clone());this._highlights[c.uuid]=[o],this._highlights[d.uuid]=[n],this._highlights[m.uuid]=[a],this._highlights[v.uuid]=[_],this._highlights[b.uuid]=[g],f.transform.setParent(this.gameObject.transform),o.transform.setParent(f.transform),n.transform.setParent(f.transform),a.transform.setParent(f.transform),_.transform.setParent(f.transform),g.transform.setParent(f.transform),c.transform.setParent(f.transform).gameObject.activeSelf=!1,d.transform.setParent(f.transform).gameObject.activeSelf=!1,m.transform.setParent(f.transform).gameObject.activeSelf=!1,v.transform.setParent(f.transform).gameObject.activeSelf=!1,b.transform.setParent(f.transform).gameObject.activeSelf=!1,o.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),n.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),a.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),_.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.YELLOW),g.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(3999).setColor(egret3d.Color.GRAY),c.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),d.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),m.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),v.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.YELLOW),b.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(3999).setColor(egret3d.Color.GRAY);var O=this.scale,o=t.EditorMeshHelper.createGameObject("AxisX",egret3d.DefaultMeshes.LINE_X,egret3d.DefaultMaterials.MESH_BASIC.clone()),n=t.EditorMeshHelper.createGameObject("AxisY",egret3d.DefaultMeshes.LINE_Y,egret3d.DefaultMaterials.MESH_BASIC.clone()),a=t.EditorMeshHelper.createGameObject("AxisZ",egret3d.DefaultMeshes.LINE_Z,egret3d.DefaultMaterials.MESH_BASIC.clone()),s=t.EditorMeshHelper.createGameObject("ArrowX",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),i=t.EditorMeshHelper.createGameObject("ArrowY",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),l=t.EditorMeshHelper.createGameObject("ArrowZ",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),c=t.EditorMeshHelper.createGameObject("X",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),d=t.EditorMeshHelper.createGameObject("Y",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),m=t.EditorMeshHelper.createGameObject("Z",egret3d.DefaultMeshes.CUBE,egret3d.DefaultMaterials.MESH_BASIC.clone()),p=t.EditorMeshHelper.createGameObject("XY",egret3d.DefaultMeshes.QUAD,egret3d.Material.create(egret3d.DefaultShaders.MESH_BASIC_DOUBLESIDE),""),u=t.EditorMeshHelper.createGameObject("YZ",egret3d.DefaultMeshes.QUAD,egret3d.Material.create(egret3d.DefaultShaders.MESH_BASIC_DOUBLESIDE),""),h=t.EditorMeshHelper.createGameObject("ZX",egret3d.DefaultMeshes.QUAD,egret3d.Material.create(egret3d.DefaultShaders.MESH_BASIC_DOUBLESIDE),"");this._highlights[c.uuid]=[c,o,s],this._highlights[d.uuid]=[c,n,i],this._highlights[m.uuid]=[c,a,l],O.transform.setParent(this.gameObject.transform),o.transform.setParent(O.transform).setLocalPosition(.001,0,0),n.transform.setParent(O.transform).setLocalPosition(0,.001,0),a.transform.setParent(O.transform).setLocalPosition(0,0,.001),s.transform.setParent(O.transform).setLocalPosition(egret3d.Vector3.RIGHT).setLocalScale(.15,.15,.15),i.transform.setParent(O.transform).setLocalPosition(egret3d.Vector3.UP).setLocalScale(.15,.15,.15),l.transform.setParent(O.transform).setLocalPosition(egret3d.Vector3.FORWARD).setLocalScale(.15,.15,.15),c.transform.setParent(O.transform).setLocalPosition(.7,0,0).setLocalScale(.9,.15,.15).gameObject.activeSelf=!1,d.transform.setParent(O.transform).setLocalPosition(0,.7,0).setLocalScale(.15,.9,.15).gameObject.activeSelf=!1,m.transform.setParent(O.transform).setLocalPosition(0,0,.7).setLocalScale(.15,.15,.9).gameObject.activeSelf=!1,p.transform.setParent(O.transform).setLocalPosition(.15,.15,0).setLocalScale(.3),u.transform.setParent(O.transform).setLocalPosition(0,.15,.15).setLocalEuler(0,.5*Math.PI,0).setLocalScale(.3),h.transform.setParent(O.transform).setLocalPosition(.15,0,.15).setLocalEuler(.5*Math.PI,0,0).setLocalScale(.3),o.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),n.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),a.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),s.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),i.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),l.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),c.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.RED),d.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.GREEN),m.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.BLUE),p.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.YELLOW),u.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.INDIGO),h.renderer.material.setOpacity(.8).setDepth(!1,!1).setBlend(1).setRenderQueue(4e3).setColor(egret3d.Color.PURPLE),this.mode=this.translate,this._quad.parent=this.gameObject,this._quad.activeSelf=!1},r.prototype._updateTransform=function(e){var r=this.isWorldSpace,o=this._hovered.name,n=t.Helper.raycastB(this._plane,e.x,e.y),a=this.gameObject.getComponent(t.ModelComponent),s=a.selectedGameObject,i=this._prsStarts[s.uuid];if(this._offsetEnd.subtract(i[3],n.position),this._mode===this.scale)r=!1;else switch(o){case"E":case"XYZ":case"XYZE":r=!0}if(r||this._offsetEnd.applyQuaternion(i[4].clone().inverse().release()),this._mode===this.translate){o.indexOf("X")<0&&(this._offsetEnd.x=this._offsetStart.x),o.indexOf("Y")<0&&(this._offsetEnd.y=this._offsetStart.y),o.indexOf("Z")<0&&(this._offsetEnd.z=this._offsetStart.z);for(var l=egret3d.Vector3.create(),c=0,d=a.selectedGameObjects;c<d.length;c++){var m=d[c];if(!(a.selectedGameObjects.indexOf(m.parent)>=0)){var p=this._prsStarts[m.uuid];l.subtract(this._offsetStart,this._offsetEnd),r?(l.add(p[3]),m.transform.position=l):(l.applyQuaternion(p[1]),l.add(p[0]),m.transform.localPosition=l)}}l.release()}else if(this._mode===this.rotate){var u=egret3d.Camera.editor,h=egret3d.Vector3.create(),f=egret3d.Vector3.create(),_=r?egret3d.Quaternion.IDENTITY.clone():s.transform.getRotation(),g=egret3d.Quaternion.create(),v=20/s.transform.getPosition().getDistance(h.applyMatrix(u.transform.getWorldMatrix())),b=0;if(o.indexOf("XYZE")>=0)h.copy(this._offsetEnd).subtract(this._offsetStart,h).cross(this.eye).normalize(),f.copy(h),b=this._offsetEnd.subtract(this._offsetStart,this._offsetEnd).dot(h.cross(this.eye))*v;else if(o.indexOf("E")>=0)h.copy(this._offsetEnd).cross(this._offsetStart),f.copy(this.eye),b=this._offsetEnd.getAngle(this._offsetStart)*(h.dot(this.eye)<0?1:-1);else{var O=this._dir[o],C=egret3d.Vector3.create();f.copy(O),h.copy(O),C.subtract(this._offsetStart,this._offsetEnd),r||(h.applyQuaternion(_),C.applyQuaternion(i[4])),b=C.dot(h.cross(this.eye).normalize())*v,C.release()}r?(g.fromAxis(f,b).multiply(i[4]).normalize(),s.transform.rotation=g):(g.fromAxis(f,b).premultiply(i[1]).normalize(),s.transform.localRotation=g),h.release(),f.release(),g.release(),s.transform.localEulerAngles}else if(this._mode===this.scale){if(o.indexOf("XYZ")>=0){var y=this._offsetEnd.length/this._offsetStart.length;this._offsetEnd.dot(this._offsetStart)<0&&(y*=-1),this._offsetEnd.set(y,y,y)}else this._offsetEnd.divide(this._offsetStart),o.indexOf("X")<0&&(this._offsetEnd.x=1),o.indexOf("Y")<0&&(this._offsetEnd.y=1),o.indexOf("Z")<0&&(this._offsetEnd.z=1);for(var E=egret3d.Vector3.create(),S=0,M=a.selectedGameObjects;S<M.length;S++){var m=M[S];if(!(a.selectedGameObjects.indexOf(m.parent)>=0)){var p=this._prsStarts[m.uuid];m.transform.localScale=E.multiply(this._offsetEnd,p[2])}}E.release()}},r.prototype._updateSelf=function(){var e=this._mode===this.scale?!1:this.isWorldSpace,r=egret3d.Camera.editor,o=this.gameObject.getComponent(t.ModelComponent),n=o.selectedGameObject,a=this.eye.copy(r.transform.position),s=a.getDistance(n.transform.position);r.opvalue>0&&a.subtract(n.transform.position),a.normalize();var i=e?egret3d.Quaternion.IDENTITY:n.transform.getRotation();if(this.transform.position=n.transform.position,this.transform.rotation=i,this.transform.scale=egret3d.Vector3.ONE.clone().multiplyScalar(s/10).release(),this._mode===this.rotate){var l=i.clone(),c=i.clone(),d=egret3d.Vector3.create();d.copy(this.eye).applyQuaternion(l.inverse()),l.fromAxis(egret3d.Vector3.RIGHT,Math.atan2(-d.y,d.z)),l.multiply(c,l);var m=this.rotate.transform.find("AxisX"),p=this.rotate.transform.find("X");m.setRotation(l),p.setRotation(l),l.fromAxis(egret3d.Vector3.UP,Math.atan2(d.x,d.z)),l.multiply(c,l);var u=this.rotate.transform.find("AxisY"),h=this.rotate.transform.find("Y");u.setRotation(l),h.setRotation(l),l.fromAxis(egret3d.Vector3.FORWARD,Math.atan2(-d.x,d.y)),l.multiply(c,l);var f=this.rotate.transform.find("AxisZ"),_=this.rotate.transform.find("Z");f.setRotation(l),_.setRotation(l),c.fromMatrix(egret3d.Matrix4.create().lookAt(this.eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release());var g=this.rotate.transform.find("AxisE"),v=this.rotate.transform.find("E");g.setRotation(c),v.setRotation(c),c.fromMatrix(egret3d.Matrix4.create().lookAt(this.eye,egret3d.Vector3.ZERO,egret3d.Vector3.UP).release());var b=this.rotate.transform.find("AxisXYZE");b.setRotation(c),l.release(),c.release(),d.release()}},r.prototype._updatePlane=function(){var e=this._mode===this.scale?!1:this.isWorldSpace,t=e?egret3d.Quaternion.IDENTITY:this.transform.rotation,r=egret3d.Vector3.RIGHT.clone().applyQuaternion(t),o=egret3d.Vector3.UP.clone().applyQuaternion(t),n=egret3d.Vector3.FORWARD.clone().applyQuaternion(t),a=o.clone(),s=egret3d.Vector3.create();if(this._hovered&&this._mode!==this.rotate)switch(this._hovered.name){case"X":a.cross(this.eye,r),s.cross(r,a);break;case"Y":a.cross(this.eye,o),s.cross(o,a);break;case"Z":a.cross(this.eye,n),s.cross(n,a);break;case"XY":s.copy(n);break;case"YZ":s.copy(r);break;case"ZX":a.copy(n),s.copy(o)}0===s.length?this._quad.transform.rotation=egret3d.Camera.editor.transform.rotation:this._quad.transform.rotation=egret3d.Quaternion.create().fromMatrix(egret3d.Matrix4.create().lookAt(egret3d.Vector3.ZERO,s,a).release()).release(),this._controlling||this._plane.fromPoint(this._quad.transform.position,this._quad.transform.getForward().release()),r.release(),o.release(),n.release(),a.release(),s.release()},r.prototype.start=function(e){for(var r=this.isWorldSpace,o=this._hovered.name,n=t.Helper.raycastB(this._plane,e.x,e.y),a=this.gameObject.getComponent(t.ModelComponent),s=0,i=a.selectedGameObjects;s<i.length;s++){var l=i[s],c=l.transform;this._prsStarts[l.uuid]=[egret3d.Vector3.create().copy(c.localPosition),egret3d.Quaternion.create().copy(c.localRotation),egret3d.Vector3.create().copy(c.localScale),egret3d.Vector3.create().copy(c.position),egret3d.Quaternion.create().copy(c.rotation),egret3d.Vector3.create().copy(c.scale)]}var d=this._prsStarts[a.selectedGameObject.uuid];if(this._offsetStart.subtract(d[3],n.position),this._controlling=!0,this._mode===this.scale)r=!1;else switch(o){case"E":case"XYZ":case"XYZE":r=!0}r||this._offsetStart.applyQuaternion(d[4].clone().inverse().release())},r.prototype.end=function(){for(var e in this._prsStarts){for(var t=0,r=this._prsStarts[e];t<r.length;t++){var o=r[t];o.release()}delete this._prsStarts[e]}this._controlling=!1},r.prototype.update=function(e){this._hovered&&this._controlling&&this._updateTransform(e),this._updateSelf(),this._updatePlane()},Object.defineProperty(r.prototype,"mode",{get:function(){return this._mode||this.translate},set:function(e){this._mode!==e&&(this.translate!==e&&(this.translate.activeSelf=!1),this.rotate!==e&&(this.rotate.activeSelf=!1),this.scale!==e&&(this.scale.activeSelf=!1),this._mode=e,this._mode.activeSelf=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hovered",{get:function(){return this._hovered},set:function(e){if(this._hovered!==e)if(this._hovered=e,this._hovered)for(var t=this._highlights[this._hovered.uuid]||[this._hovered],r=0,o=this._mode.transform.children;r<o.length;r++){var n=o[r];if(n.gameObject.renderer){var a=n.gameObject.renderer.material;t.indexOf(n.gameObject)>=0?a.opacity=1:a.opacity=.2}}else for(var s=0,i=this._mode.transform.children;s<i.length;s++){var n=i[s];n.gameObject.renderer&&(n.gameObject.renderer.material.opacity=.8)}},enumerable:!0,configurable:!0}),r}(e.BaseComponent);t.TransfromController=r,__reflect(r.prototype,"paper.debug.TransfromController")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=5,o=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t._gridA=t._createGrid("GridA"),t._gridB=t._createGrid("GridB",100*r,100*r),t}return __extends(o,e),o.prototype._createGrid=function(e,r,o){void 0===r&&(r=100),void 0===o&&(o=100);for(var n=r/o,a=r/2,s=[],i=0,l=-a;o>=i;i++,l+=n)s.push(-a,0,l),s.push(a,0,l),s.push(l,0,-a),s.push(l,0,a);var c=new egret3d.Mesh(s.length,0,["POSITION"]);c.setAttributes("POSITION",s),c.glTFMesh.primitives[0].mode=1;var d=t.EditorMeshHelper.createGameObject(e,c,egret3d.DefaultMaterials.MESH_BASIC.clone());return d},o.prototype.initialize=function(){e.prototype.initialize.call(this),this._gridA.parent=this.gameObject,this._gridB.parent=this.gameObject;var t=this._gridA.renderer.material,r=this._gridB.renderer.material;t.setBlend(1),r.setBlend(1)},o.prototype.update=function(){var e=egret3d.Camera.editor,o=e.gameObject.getComponent(t.OrbitControls),n=o.lookAtPoint.clone().add(o.lookAtOffset),a=.01*n.getDistance(e.transform.position),s=a%1,i=s*(r-1)+1;this._gridA.transform.setScale(i*r,0,i*r),this._gridB.transform.setScale(i,0,i);var l=this._gridA.renderer.material,c=this._gridB.renderer.material;l.setOpacity(.3),c.setOpacity(.3*s)},o}(e.BaseComponent);t.GridController=o,__reflect(o.prototype,"paper.debug.GridController")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(r){function o(){var o=null!==r&&r.apply(this,arguments)||this;return o._interests=[[{componentClass:egret3d.Transform}]],o._disposeCollecter=e.GameObject.globalGameObject.getOrAddComponent(e.DisposeCollecter),o._modelComponent=e.GameObject.globalGameObject.getOrAddComponent(t.ModelComponent),o._guiComponent=e.GameObject.globalGameObject.getOrAddComponent(t.GUIComponent),o._bufferedGameObjects=[],o._hierarchyFolders={},o._inspectorFolders={},o._selectFolder=null,o._sceneSelectedHandler=function(e,t){o._selectSceneOrGameObject(t)},o._sceneUnselectedHandler=function(e,t){o._selectSceneOrGameObject(null)},o._gameObjectSelectedHandler=function(e,t){o._selectSceneOrGameObject(null),o._selectSceneOrGameObject(t)
},o._gameObjectUnselectedHandler=function(e,t){o._selectSceneOrGameObject(null)},o._createGameObject=function(){if(o._modelComponent.selectedScene){var e=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",o._modelComponent.selectedScene);o._modelComponent.select(e,!0)}else{var e=egret3d.DefaultMeshes.createObject(egret3d.DefaultMeshes.CUBE,"NoName","",o._modelComponent.selectedGameObject.scene);e.transform.parent=o._modelComponent.selectedGameObject.transform,o._modelComponent.select(e,!0)}},o._destroySceneOrGameObject=function(){var e=o._guiComponent.inspector.instance;e&&(o._modelComponent.select(null),e.destroy())},o._nodeClickHandler=function(e){o._modelComponent.select(e.instance,!0)},o}return __extends(o,r),o.prototype._openFolder=function(e){e.open(),e.parent&&e.parent!==this._guiComponent.hierarchy&&this._openFolder(e.parent)},o.prototype._selectSceneOrGameObject=function(t){if(this._selectFolder&&(this._selectFolder.selected=!1,this._selectFolder=null),this._guiComponent.inspector.instance=t,t)if(t instanceof e.Scene)this._guiComponent.inspector.add(this,"_createGameObject","createObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);else{this._guiComponent.inspector.add(this,"_createGameObject","createChildObject"),this._guiComponent.inspector.add(this,"_destroySceneOrGameObject","destroy"),this._addToInspector(this._guiComponent.inspector);for(var r=0,o=t.components;r<o.length;r++){var n=o[r],a=this._guiComponent.inspector.addFolder(n.uuid,egret.getQualifiedClassName(n));a.instance=n,this._inspectorFolders[n.uuid]=a,this._addToInspector(a)}}else{for(var s in this._inspectorFolders)delete this._inspectorFolders[s];if(this._guiComponent.inspector.__controllers)for(var i=0,l=this._guiComponent.inspector.__controllers.concat();i<l.length;i++){var c=l[i];this._guiComponent.inspector.remove(c)}if(this._guiComponent.inspector.__folders)for(var s in this._guiComponent.inspector.__folders)this._guiComponent.inspector.removeFolder(this._guiComponent.inspector.__folders[s])}},o.prototype._addToHierarchy=function(e){if(!(e.uuid in this._hierarchyFolders||"Editor Only"===e.tag||2===e.hideFlags||3===e.hideFlags)){var t=this._hierarchyFolders[e.transform.parent?e.transform.parent.gameObject.uuid:e.scene.uuid];if(!t){if(e.transform.parent)throw new Error;t=this._guiComponent.hierarchy.addFolder(e.scene.uuid,e.scene.name+" <Scene>"),t.instance=e.scene,t.onClick=this._nodeClickHandler,this._hierarchyFolders[e.scene.uuid]=t}var r=t.addFolder(e.uuid,e.name);r.instance=e,r.onClick=this._nodeClickHandler,this._hierarchyFolders[e.uuid]=r}},o.prototype._addToInspector=function(t){for(var r,o,n,a=e.editor.getEditInfo(t.instance),s=function(e){switch(e.editType){case 0:r=i._guiComponent.inspector.add(t.instance,e.name).min(0).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 1:r=i._guiComponent.inspector.add(t.instance,e.name).step(1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 2:r=i._guiComponent.inspector.add(t.instance,e.name).step(.1).listen(),e.option&&(void 0!==e.option.minimum&&r.min(e.option.minimum),void 0!==e.option.maximum&&r.max(e.option.maximum),void 0!==e.option.step&&r.step(e.option.step));break;case 4:case 3:i._guiComponent.inspector.add(t.instance,e.name).listen();break;case 10:i._guiComponent.inspector.add(t.instance,e.name,e.option.listItems).listen();break;case 5:var a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(a)if(a.get&&a.set){var s=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),r.onChange(s),o.onChange(s)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen();break;case 6:var a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t.instance),e.name);if(a){if(a.get&&a.set){var s=function(){t.instance[e.name]=t.instance[e.name]};r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen(),r.onChange(s),o.onChange(s),n.onChange(s)}else r=i._guiComponent.inspector.add(t.instance[e.name],"x",e.name+": x").step(.1).listen(),o=i._guiComponent.inspector.add(t.instance[e.name],"y",e.name+": y").step(.1).listen(),n=i._guiComponent.inspector.add(t.instance[e.name],"z",e.name+": z").step(.1).listen();e.option&&(void 0!==e.option.minimum&&(r.min(e.option.minimum),o.min(e.option.minimum),n.min(e.option.minimum)),void 0!==e.option.maximum&&(r.max(e.option.maximum),o.max(e.option.maximum),n.max(e.option.maximum)),void 0!==e.option.step&&(r.step(e.option.step),o.step(e.option.step),n.step(e.option.step)))}break;case 7:case 8:break;case 9:break;case 11:break;case 14:}},i=this,l=0,c=a;l<c.length;l++){var d=c[l];s(d)}},o.prototype._debug=function(r){if(r){e.EventPool.addEventListener("SceneSelected",t.ModelComponent,this._sceneSelectedHandler),e.EventPool.addEventListener("SceneUnselected",t.ModelComponent,this._sceneUnselectedHandler),e.EventPool.addEventListener("GameObjectSelected",t.ModelComponent,this._gameObjectSelectedHandler),e.EventPool.addEventListener("GameObjectUnselected",t.ModelComponent,this._gameObjectUnselectedHandler),this._bufferedGameObjects.push(e.GameObject.globalGameObject);for(var o=0,n=this._groups[0].gameObjects;o<n.length;o++){var a=n[o];this._bufferedGameObjects.push(a)}this._modelComponent.select(e.Scene.activeScene)}else{e.EventPool.removeEventListener("SceneSelected",t.ModelComponent,this._sceneSelectedHandler),e.EventPool.removeEventListener("SceneUnselected",t.ModelComponent,this._sceneUnselectedHandler),e.EventPool.removeEventListener("GameObjectSelected",t.ModelComponent,this._gameObjectSelectedHandler),e.EventPool.removeEventListener("GameObjectUnselected",t.ModelComponent,this._gameObjectUnselectedHandler);for(var s in this._hierarchyFolders){var i=this._hierarchyFolders[s];if(delete this._hierarchyFolders[s],i&&i.parent)try{i.parent.removeFolder(i)}catch(l){}}for(var s in this._inspectorFolders)delete this._inspectorFolders[s];this._bufferedGameObjects.length=0,this._selectFolder=null}},o.prototype.onAwake=function(){var r=this,o={debug:!1,assets:function(){var t=e.Asset._assets,r=[];for(var o in t)o.indexOf("builtin")>=0||(r.push(o),t[o]instanceof egret3d.Texture&&(r.push(o.replace(".image.json",".png")),r.push(o.replace(".image.json",".jpg"))));console.info(JSON.stringify(r))}};this._guiComponent.hierarchy.add(o,"debug").onChange(function(o){var n=e.Application.systemManager.getOrRegisterSystem(t.SceneSystem);o?(e.Application.playerMode=1,n.enabled=!0):(r._modelComponent.select(null),r._modelComponent.hover(null),e.Application.playerMode=0,n.enabled=!1),r._debug(o)}),this._guiComponent.hierarchy.add(o,"assets"),this._guiComponent.hierarchy.close()},o.prototype.onEnable=function(){},o.prototype.onDisable=function(){},o.prototype.onAddGameObject=function(e,t){this._bufferedGameObjects.push(e)},o.prototype.onRemoveGameObject=function(e,t){var r=this._bufferedGameObjects.indexOf(e);r>=0&&(this._bufferedGameObjects[r]=null)},o.prototype.onUpdate=function(e){for(var t=0;this._bufferedGameObjects.length>0&&t++<5;)this._addToHierarchy(this._bufferedGameObjects.shift());if(!this._selectFolder){var r=this._modelComponent.selectedScene||this._modelComponent.selectedGameObject;r&&r.uuid in this._hierarchyFolders&&(this._selectFolder=this._hierarchyFolders[r.uuid],this._selectFolder.selected=!0,this._openFolder(this._selectFolder.parent))}if(this._guiComponent.inspector.updateDisplay(),this._guiComponent.inspector.__folders)for(var o in this._guiComponent.inspector.__folders)this._guiComponent.inspector.__folders[o].updateDisplay();for(var n=0,a=this._disposeCollecter.scenes;n<a.length;n++){var s=a[n],i=this._hierarchyFolders[s.uuid];if(delete this._hierarchyFolders[s.uuid],i&&i.parent)try{i.parent.removeFolder(i)}catch(l){}}for(var c=0,d=this._disposeCollecter.gameObjects;c<d.length;c++){var m=d[c],i=this._hierarchyFolders[m.uuid];if(delete this._hierarchyFolders[m.uuid],i&&i.parent)try{i.parent.removeFolder(i)}catch(l){}}for(var p=0,u=this._disposeCollecter.components;p<u.length;p++){var h=u[p],i=this._inspectorFolders[h.uuid];if(delete this._inspectorFolders[h.uuid],i&&i.parent)try{i.parent.removeFolder(i)}catch(l){}}},o}(e.BaseSystem);t.GUISystem=r,__reflect(r.prototype,"paper.debug.GUISystem")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(r){function o(){var o=null!==r&&r.apply(this,arguments)||this;return o._interests=[[{componentClass:egret3d.Transform}]],o._camerasAndLights=e.GameObject.globalGameObject.getOrAddComponent(egret3d.CamerasAndLights),o._modelComponent=e.GameObject.globalGameObject.getOrAddComponent(t.ModelComponent),o._orbitControls=null,o._transformController=null,o._gridController=null,o._hoverBox=null,o._grids=null,o._cameraViewFrustum=null,o._pointerStartPosition=egret3d.Vector3.create(),o._pointerPosition=egret3d.Vector3.create(),o._boxes={},o._contextmenuHandler=function(e){e.preventDefault()},o._onMouseDown=function(e){if(o._pointerStartPosition.copy(o._pointerPosition),0===e.button){if(2&e.buttons)return;var t=o._transformController;t&&t.isActiveAndEnabled&&t.hovered&&t.start(o._pointerPosition)}else 1===e.button;e.preventDefault()},o._onMouseUp=function(e){if(0===e.button){var r=o._transformController;if(r.isActiveAndEnabled&&r.hovered)r.end();else{var n=o._modelComponent.hoveredGameObject;if(n){var a=o._modelComponent.selectedGameObject;if(n===a)e.ctrlKey&&o._modelComponent.unselect(a);else if(o._pointerPosition.getDistance(o._pointerStartPosition)<5){if(n.renderer instanceof egret3d.SkinnedMeshRenderer&&!n.transform.find("__pickTarget")){var s=n.getComponentInParent(egret3d.Animation);if(s){var i=t.EditorMeshHelper.createGameObject("__pickTarget",null,null,"Editor Only",n.scene);i.transform.parent=n.transform,i.addComponent(t.GizmoPickComponent).pickTarget=s.gameObject}}var l="__pickTarget"===n.name?n.transform:n.transform.find("__pickTarget");l?o._modelComponent.select(l.gameObject.getComponent(t.GizmoPickComponent).pickTarget,!e.ctrlKey):o._modelComponent.select(n,!e.ctrlKey)}else e.ctrlKey}else e.ctrlKey||e.shiftKey||o._modelComponent.select(null)}}else 1===e.button;e.preventDefault()},o._onMouseMove=function(r){if(o._pointerPosition.set(r.clientX,r.clientY,0),egret3d.InputManager.mouse.convertPosition(o._pointerPosition,o._pointerPosition),2&r.buttons);else if(1&r.buttons);else{var n=o._transformController;if(n&&n.isActiveAndEnabled)if(r.shiftKey||r.ctrlKey)n.hovered=null;else{var a=t.Helper.raycast(n.mode.transform.children,o._pointerPosition.x,o._pointerPosition.y);a.length>0?n.hovered=a[0].transform.gameObject:n.hovered=null}else n.hovered=null;if(n&&n.isActiveAndEnabled&&n.hovered)o._modelComponent.hover(null);else{var a=t.Helper.raycast(e.Scene.activeScene.getRootGameObjects(),o._pointerPosition.x,o._pointerPosition.y);a.length>0?o._modelComponent.hover(a[0].transform.gameObject):o._modelComponent.hover(null)}}r.preventDefault()},o._onKeyUp=function(e){var t=o._transformController;if(!e.altKey&&!e.ctrlKey&&!e.shiftKey)switch(e.key.toLowerCase()){case"escape":o._modelComponent.select(null);break;case"f":o._orbitControls.distance=10,o._orbitControls.lookAtOffset.set(0,0,0),o._modelComponent.selectedGameObject?o._orbitControls.lookAtPoint.copy(o._modelComponent.selectedGameObject.transform.position):o._orbitControls.lookAtPoint.copy(egret3d.Vector3.ZERO);break;case"w":t&&(t.mode=t.translate);break;case"e":t&&(t.mode=t.rotate);break;case"r":t&&(t.mode=t.scale);break;case"x":t&&(t.isWorldSpace=!t.isWorldSpace)}},o._onKeyDown=function(e){},o._onGameObjectSelected=function(e,t){o._selectGameObject(t,!0)},o._onGameObjectHovered=function(e,t){t?(o._hoverBox.activeSelf=!0,o._hoverBox.scene!==t.scene&&(o._hoverBox.dontDestroy=!0,o._hoverBox.dontDestroy=!1),o._hoverBox.parent=t):(o._hoverBox.activeSelf=!1,o._hoverBox.parent=null)},o._onGameObjectUnselected=function(e,t){o._selectGameObject(t,!1)},o}return __extends(o,r),o.prototype._selectGameObject=function(e,r){var o=this._transformController;if(r){o&&(o.gameObject.activeSelf=!0);var n=t.EditorMeshHelper.createBox("Box",egret3d.Color.WHITE,.8,e.scene);n.activeSelf=!1,n.parent=e,this._boxes[e.uuid]=n}else{o&&(o.gameObject.activeSelf=!1);var n=this._boxes[e.uuid];if(!n)throw new Error;delete this._boxes[e.uuid],n.destroy()}},o.prototype._updateBoxes=function(){for(var e=0,t=this._modelComponent.selectedGameObjects;e<t.length;e++){var r=t[e],o=this._boxes[r.uuid];if(!o)throw new Error;r.renderer?(o.activeSelf=!0,o.transform.localPosition=r.renderer.aabb.center,o.transform.localScale=r.renderer.aabb.size):o.activeSelf=!1}if(this._hoverBox.activeSelf){var n=this._hoverBox.parent.renderer;n?(this._hoverBox.transform.localPosition=n.aabb.center,this._hoverBox.transform.localScale=n.aabb.size):this._hoverBox.activeSelf=!1}},o.prototype._updateCameras=function(){for(var e=0,r=this._camerasAndLights.cameras;e<r.length;e++){var o=r[e];if("Editor Only"!==o.gameObject.tag){var n=o.transform.find("__pickTarget");if(n){var a=egret3d.Camera.editor.transform.getPosition(),s=a.getDistance(o.transform.position);n.transform.setLocalScale(egret3d.Vector3.ONE.clone().multiplyScalar(s/40).release()),n.transform.rotation=egret3d.Camera.editor.transform.rotation}else n=t.EditorMeshHelper.createIcon("__pickTarget",o.gameObject,egret3d.DefaultTextures.CAMERA_ICON).transform}}var i=function(e,t,r,o,n,a){var s=egret3d.Vector3.create(),i=egret3d.Matrix4.create();if(s.set(r,o,n).applyMatrix(i.inverse(e)).applyMatrix(egret3d.Matrix4.IDENTITY),void 0!==a)for(var l=0,c=a.length;c>l;l++){var d=3*a[l];t[d+0]=s.x,t[d+1]=s.y,t[d+2]=s.z}s.release(),i.release()},l=this._modelComponent.selectedGameObject?this._modelComponent.selectedGameObject.getComponent(egret3d.Camera):null;if(l){this._cameraViewFrustum.transform.position=l.gameObject.transform.position,this._cameraViewFrustum.transform.rotation=l.gameObject.transform.rotation,this._cameraViewFrustum.activeSelf=!0;var c=this._cameraViewFrustum.getComponent(egret3d.MeshFilter).mesh,d=egret3d.Matrix4.create(),m={x:0,y:0,w:0,h:0};l.calcViewPortPixel(m),l.calcProjectMatrix(m.w/m.h,d);var p=c.getVertices();i(d,p,0,0,-1,[38,41]),i(d,p,0,0,1,[39]),i(d,p,-1,-1,-1,[0,7,16,25]),i(d,p,1,-1,-1,[1,2,18,27]),i(d,p,-1,1,-1,[5,6,20,29]),i(d,p,1,1,-1,[3,4,22,31]),i(d,p,-1,-1,1,[8,15,17]),i(d,p,1,-1,1,[9,10,19]),i(d,p,-1,1,1,[13,14,21]),i(d,p,1,1,1,[11,12,23]),i(d,p,.7,1.1,-1,[32,37]),i(d,p,-.7,1.1,-1,[33,34]),i(d,p,0,2,-1,[35,36]),i(d,p,-1,0,1,[42]),i(d,p,1,0,1,[43]),i(d,p,0,-1,1,[44]),i(d,p,0,1,1,[45]),i(d,p,-1,0,-1,[46]),i(d,p,1,0,-1,[47]),i(d,p,0,-1,-1,[48]),i(d,p,0,1,-1,[49]),c.uploadVertexBuffer("POSITION"),d.release()}else this._cameraViewFrustum.activeSelf=!1},o.prototype._updateLights=function(){for(var e=0,r=this._camerasAndLights.lights;e<r.length;e++){var o=r[e];if("Editor Only"!==o.gameObject.tag){var n=o.transform.find("__pickTarget");if(n){var a=egret3d.Camera.editor.transform.getPosition(),s=a.getDistance(o.transform.position);n.transform.setLocalScale(egret3d.Vector3.ONE.clone().multiplyScalar(s/40).release()),n.transform.rotation=egret3d.Camera.editor.transform.rotation}else n=t.EditorMeshHelper.createIcon("__pickTarget",o.gameObject,egret3d.DefaultTextures.LIGHT_ICON).transform}}},o.prototype.onEnable=function(){e.EventPool.addEventListener("GameObjectHovered",t.ModelComponent,this._onGameObjectHovered),e.EventPool.addEventListener("GameObjectSelected",t.ModelComponent,this._onGameObjectSelected),e.EventPool.addEventListener("GameObjectUnselected",t.ModelComponent,this._onGameObjectUnselected);var r=egret3d.WebGLCapabilities.canvas;r.addEventListener("contextmenu",this._contextmenuHandler),r.addEventListener("mousedown",this._onMouseDown),r.addEventListener("mouseup",this._onMouseUp),r.addEventListener("mousemove",this._onMouseMove),window.addEventListener("keyup",this._onKeyUp),window.addEventListener("keydown",this._onKeyDown),this._orbitControls=egret3d.Camera.editor.gameObject.getOrAddComponent(t.OrbitControls),this._transformController=t.EditorMeshHelper.createGameObject("Axises").addComponent(t.TransfromController),this._transformController.gameObject.activeSelf=!1,this._gridController=t.EditorMeshHelper.createGameObject("Grid").addComponent(t.GridController),this._hoverBox=t.EditorMeshHelper.createBox("HoverBox",egret3d.Color.WHITE,.6,e.Scene.activeScene),this._hoverBox.activeSelf=!1,this._cameraViewFrustum=t.EditorMeshHelper.createCameraWireframed("Camera"),this._cameraViewFrustum.activeSelf=!1},o.prototype.onDisable=function(){e.EventPool.removeEventListener("GameObjectHovered",t.ModelComponent,this._onGameObjectHovered),e.EventPool.removeEventListener("GameObjectSelected",t.ModelComponent,this._onGameObjectSelected),e.EventPool.removeEventListener("GameObjectUnselected",t.ModelComponent,this._onGameObjectUnselected);var r=egret3d.WebGLCapabilities.canvas;r.removeEventListener("contextmenu",this._contextmenuHandler),r.removeEventListener("mousedown",this._onMouseDown),r.removeEventListener("mouseup",this._onMouseUp),r.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keydown",this._onKeyDown),egret3d.Camera.editor.gameObject.removeComponent(t.OrbitControls),this._orbitControls=null,this._transformController&&(this._transformController.gameObject.destroy(),this._transformController=null),this._gridController&&(this._gridController.gameObject.destroy(),this._gridController=null),this._hoverBox&&(this._hoverBox.destroy(),this._hoverBox=null),this._grids&&(this._grids.destroy(),this._grids=null);for(var o=0,n=this._camerasAndLights.cameras;o<n.length;o++){var a=n[o];if("Editor Only"!==a.gameObject.tag){var s=a.transform.find("__editor");s&&s.gameObject.destroy()}}this._cameraViewFrustum&&!this._cameraViewFrustum.isDestroyed&&(this._cameraViewFrustum.destroy(),this._cameraViewFrustum=null)},o.prototype.onUpdate=function(){for(var e=0,t=this._modelComponent.selectedGameObjects;e<t.length;e++){var r=t[e];r.isDestroyed&&this._modelComponent.select(null)}this._cameraViewFrustum&&(this._cameraViewFrustum.isDestroyed?this._cameraViewFrustum=null:this._cameraViewFrustum.activeSelf=this._modelComponent.selectedGameObject?!0:!1);var o=this._transformController;o&&o.isActiveAndEnabled&&o.update(this._pointerPosition);var n=this._gridController;n&&n.isActiveAndEnabled&&n.update(),this._updateBoxes(),this._updateCameras(),this._updateLights()},o}(e.BaseSystem);t.SceneSystem=r,__reflect(r.prototype,"paper.debug.SceneSystem")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(){function r(){}return r.createGameObject=function(t,r,o,n,a){void 0===r&&(r=null),void 0===o&&(o=null),void 0===n&&(n="Editor Only"),void 0===a&&(a=e.Scene.editorScene);var s=e.GameObject.create(t,n,a);return s.hideFlags=3,r&&(s.addComponent(egret3d.MeshFilter).mesh=r),o&&(s.addComponent(egret3d.MeshRenderer).material=o),s},r.createBox=function(e,t,r,o){var n=this.createGameObject(e,egret3d.DefaultMeshes.CUBE_LINE,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone(),"Editor Only",o);return n.getComponent(egret3d.MeshRenderer).material.setColor(t).setBlend(1).opacity=r,n},r.createIcon=function(e,r,o){var n=new egret3d.Material(egret3d.DefaultShaders.TRANSPARENT);n.renderQueue=4e3,n.setTexture("map",o),n.setColor("diffuse",egret3d.Color.RED);var a=this.createGameObject(e,egret3d.DefaultMeshes.QUAD,n,r.tag,r.scene);return a.transform.setParent(r.transform),a.addComponent(t.GizmoPickComponent).pickTarget=r,a},r.createCameraWireframed=function(e,t,r,o,n,a){void 0===t&&(t=egret3d.Color.create(1,.7,0)),void 0===r&&(r=egret3d.Color.RED),void 0===o&&(o=egret3d.Color.create(0,.7,1)),void 0===n&&(n=egret3d.Color.WHITE),void 0===a&&(a=egret3d.Color.create(.2,.2,.2));for(var s=[],i=[],l=50,c=0;l>c;c++)s.push(0,0,0),24>c?i.push(t.r,t.g,t.b,t.a):32>c?i.push(r.r,r.g,r.b,r.a):38>c?i.push(o.r,o.g,o.b,o.a):40>c?i.push(n.r,n.g,n.b,n.a):i.push(a.r,a.g,a.b,a.a);var d=new egret3d.Mesh(l,0,["POSITION","COLOR_0"]);d.setAttributes("POSITION",s),d.setAttributes("COLOR_0",i),d.glTFMesh.primitives[0].mode=1;var m=this.createGameObject(e,d,egret3d.DefaultMaterials.LINEDASHED_COLOR.clone());return m},r}();t.EditorMeshHelper=r,__reflect(r.prototype,"paper.debug.EditorMeshHelper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var paper;!function(e){var t;!function(t){var r=function(){function t(){}return t.raycast=function(t,r,o){var n=egret3d.Camera.editor,a=n.createRayByScreen(r,o),s=e.GameObject.raycast(a,t,0,16777215,!0);return a.release(),s},t.raycastB=function(e,t,r){var o=egret3d.Camera.editor,n=o.createRayByScreen(t,r),a=egret3d.RaycastInfo.create();return e.raycast(n,a)?a:null},t}();t.Helper=r,__reflect(r.prototype,"paper.debug.Helper")}(t=e.debug||(e.debug={}))}(paper||(paper={}));var helper;!function(e){function t(e){for(var t=e.substr(e.lastIndexOf("/")+1),r=t.indexOf(".",0),o="";r>=0;){if(o=t.substr(r),".vs.glsl"==o)return"GLVertexShader";if(".assetbundle.json"==o)return"Bundle";if(".fs.glsl"==o)return"GLFragmentShader";if(".png"==o||".jpg"==o)return"Texture";if(".pvr.bin"==o||".pvr"==o)return"PVR";if(".prefab.json"==o)return"Prefab";if(".scene.json"==o)return"Scene";if(".atlas.json"==o)return"Atlas";if(".font.json"==o)return"Font";if(".json"==o||".txt"==o||".effect.json"==o)return"TextAsset";if(".packs.bin"==o)return"PackBin";if(".packs.txt"==o)return"PackTxt";if(".path.json"==o)return"pathAsset";if(".mp3"==o||".ogg"==o)return"Sound";if(".shader.json"==o)return"Shader";if(".image.json"==o)return"TextureDesc";if(".mat.json"==o)return"Material";if(".mesh.bin"==o)return"Mesh";if(".ani.bin"==o)return"Animation";r=t.indexOf(".",r+1)}return"Unknown"}function r(e,r){return void 0===r&&(r="resource/"),__awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return o?[3,2]:[4,RES.loadConfig("resource/default.res.json",r)];case 1:n.sent(),o=!0,n.label=2;case 2:return[2,new Promise(function(o){RES.getResByUrl(r+e,function(e){paper.Asset.register(e),o()},RES,t(e))})]}})})}var o=!1;e.getResAsync=r}(helper||(helper={}));