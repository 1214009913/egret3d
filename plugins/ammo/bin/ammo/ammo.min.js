"use strict";var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__decorate=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,a=3>r?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(3>r?o(a):r>3?o(t,i,a):o(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},egret3d;!function(e){var t;!function(t){var i=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i._collisionEnabled=!1,i._autoCalculateConnectedAnchor=!0,i._constraintType=1,i._overrideNumSolverIterations=20,i._breakingImpulseThreshold=1/0,i._anchor=e.Vector3.ZERO.clone(),i._axisX=e.Vector3.FORWARD.clone(),i._axisY=e.Vector3.UP.clone(),i._connectedAnchor=e.Vector3.ZERO.clone(),i._connectedAxisX=e.Vector3.FORWARD.clone(),i._connectedAxisY=e.Vector3.UP.clone(),i._connectedBody=null,i._rigidbody=null,i._btTypedConstraint=null,i}return __extends(i,t),i.prototype._createFrame=function(t,n,o,r){var a=e.Vector3.cross(t,n,i._helpVector3A),s=e.Vector3.cross(a,t,i._helpVector3B).normalize();a.normalize(),s.normalize(),r.identity(),r.set3x3(t.x,s.x,a.x,t.y,s.y,a.y,t.z,s.z,a.z),r.setTranslation(o)},i.prototype._createFrames=function(t,n){if(!this._connectedBody)return void console.debug("Never.");if(this._createFrame(this._axisX,this._axisY,this._anchor,t),this._autoCalculateConnectedAnchor){var o=this.gameObject.transform,r=this._connectedBody.gameObject.transform,a=e.Quaternion.multiply(o.getLocalRotation(),e.Quaternion.inverse(r.getLocalRotation(),i._helpQuaternionA),i._helpQuaternionB),s=t.rawData,l=a.transformVector3(i._helpVector3A.set(s[0],s[1],s[2])),c=a.transformVector3(i._helpVector3B.set(s[4],s[5],s[6])),p=a.transformVector3(i._helpVector3C.set(s[8],s[9],s[10]));n.identity(),n.set3x3(l.x,c.x,p.x,l.y,c.y,p.y,l.z,c.z,p.z),n.setTranslation(i._helpMatrixC.copy(r.getWorldMatrix()).inverse().transformVector3(o.getWorldMatrix().transformVector3(i._helpVector3D.copy(this._anchor))))}else this._createFrame(this._connectedAxisX,this._connectedAxisY,this._connectedAnchor,n)},i.prototype.uninitialize=function(){t.prototype.uninitialize.call(this),this._btTypedConstraint&&Ammo.destroy(this._btTypedConstraint),this._btTypedConstraint=null},Object.defineProperty(i.prototype,"collisionEnabled",{get:function(){return this._collisionEnabled},set:function(e){this._collisionEnabled!==e&&(this._btTypedConstraint?console.warn("Cannot change the disableCollisionsBetweenConstrainedBodies after the constraint has been created."):this._collisionEnabled=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"constraintType",{get:function(){return this._constraintType},set:function(e){this._constraintType!==e&&(this._btTypedConstraint?console.warn("Cannot change the constraint type after the constraint has been created."):this._constraintType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"overrideNumSolverIterations",{get:function(){return this._overrideNumSolverIterations},set:function(e){this._overrideNumSolverIterations!==e&&(this._overrideNumSolverIterations=e,this._btTypedConstraint&&this._btTypedConstraint.setOverrideNumSolverIterations(this._overrideNumSolverIterations))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"breakingImpulseThreshold",{get:function(){return this._breakingImpulseThreshold},set:function(e){this._breakingImpulseThreshold!==e&&(this._breakingImpulseThreshold=e,this._btTypedConstraint&&this._btTypedConstraint.setBreakingImpulseThreshold(this._breakingImpulseThreshold))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"anchor",{get:function(){return this._anchor},set:function(e){this._btTypedConstraint?console.warn("Cannot change the anchor after the constraint has been created."):this._anchor.copy(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"axisX",{get:function(){return this._axisX},set:function(e){this._btTypedConstraint?console.warn("Cannot change the axis x after the constraint has been created."):this._axisX.copy(e).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"axisY",{get:function(){return this._axisY},set:function(e){this._btTypedConstraint?console.warn("Cannot change the axis y after the constraint has been created."):this._axisY.copy(e).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"autoCalculateConnectedAnchor",{get:function(){return this._autoCalculateConnectedAnchor},set:function(e){this._btTypedConstraint?console.warn("Cannot change the axis y after the constraint has been created."):this._autoCalculateConnectedAnchor=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"connectedAnchor",{get:function(){return this._connectedAnchor},set:function(e){this._btTypedConstraint?console.warn("Cannot change the anchor after the constraint has been created."):this._connectedAnchor.copy(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"connectedAxisX",{get:function(){return this._connectedAxisX},set:function(e){this._btTypedConstraint?console.warn("Cannot change the axis x after the constraint has been created."):this._connectedAxisX.copy(e).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"connectedAxisY",{get:function(){return this._connectedAxisY},set:function(e){this._btTypedConstraint?console.warn("Cannot change the axis y after the constraint has been created."):this._connectedAxisY.copy(e).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rigidbody",{get:function(){return this._rigidbody},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"connectedBody",{get:function(){return this._connectedBody},set:function(e){this._connectedBody!==e&&(this._btTypedConstraint?console.warn("Cannot change the axis y after the constraint has been created."):this._connectedBody=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"btTypedConstraint",{get:function(){return this._btTypedConstraint||(this._btTypedConstraint=this._createConstraint()),this._btTypedConstraint},enumerable:!0,configurable:!0}),i._helpVector3A=new e.Vector3,i._helpVector3B=new e.Vector3,i._helpVector3C=new e.Vector3,i._helpVector3D=new e.Vector3,i._helpQuaternionA=new e.Quaternion,i._helpQuaternionB=new e.Quaternion,i._helpMatrixA=new e.Matrix,i._helpMatrixB=new e.Matrix,i._helpMatrixC=new e.Matrix,__decorate([paper.serializedField],i.prototype,"_collisionEnabled",void 0),__decorate([paper.serializedField],i.prototype,"_autoCalculateConnectedAnchor",void 0),__decorate([paper.serializedField],i.prototype,"_constraintType",void 0),__decorate([paper.serializedField],i.prototype,"_overrideNumSolverIterations",void 0),__decorate([paper.serializedField],i.prototype,"_breakingImpulseThreshold",void 0),__decorate([paper.serializedField],i.prototype,"_anchor",void 0),__decorate([paper.serializedField],i.prototype,"_axisX",void 0),__decorate([paper.serializedField],i.prototype,"_axisY",void 0),__decorate([paper.serializedField],i.prototype,"_connectedAnchor",void 0),__decorate([paper.serializedField],i.prototype,"_connectedAxisX",void 0),__decorate([paper.serializedField],i.prototype,"_connectedAxisY",void 0),__decorate([paper.serializedField],i.prototype,"_connectedBody",void 0),i}(paper.BaseComponent);t.TypedConstraint=i,__reflect(i.prototype,"egret3d.ammo.TypedConstraint")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.collisionObjectType=1,e._collisionFlags=0,e._collisionGroups=1,e._collisionMask=-1,e._btPointer=new Ammo.btVector3,e._btCollisionObject=null,e}return __extends(i,t),i.prototype._createCollisionObject=function(){var e=new Ammo.btCollisionObject;return e.setWorldTransform(this._getBTTransform()),e.setCollisionFlags(this._collisionFlags),e.setUserPointer(this._btPointer),this._btPointer.egretComponent=this,e},i.prototype._getBTTransform=function(){var t=this.gameObject.transform,i=t.getPosition(),n=t.getRotation(),o=e.PhysicsSystem.helpVector3A,r=e.PhysicsSystem.helpQuaternionA,a=e.PhysicsSystem.helpTransformA;return o.setValue(i.x,i.y,i.z),r.setValue(n.x,n.y,n.z,n.w),a.setIdentity(),a.setOrigin(o),a.setRotation(r),a},i.prototype.uninitialize=function(){t.prototype.uninitialize.call(this),this._btCollisionObject&&(Ammo.destroy(this._btCollisionObject),Ammo.destroy(this._btPointer)),this._btCollisionObject=null},i.prototype.isStatic=function(){return 0!==(1&this._collisionFlags)},i.prototype.isKinematic=function(){return 0!==(2&this._collisionFlags)},i.prototype.isStaticOrKinematic=function(){return 0!==(3&this._collisionFlags)},i.prototype.isDynamic=function(){return 0===(3&this._collisionFlags)},Object.defineProperty(i.prototype,"collisionFlags",{get:function(){return this._collisionFlags},set:function(e){this._collisionFlags!==e&&(this._collisionFlags=e,this._btCollisionObject&&this._btCollisionObject.setCollisionFlags(this._collisionFlags))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionGroups",{get:function(){return this._collisionGroups},set:function(e){this._collisionGroups!==e&&(this._btCollisionObject?console.warn("Cannot change the collision groups after the collision object has been created."):this._collisionGroups=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collisionMask",{get:function(){return this._collisionMask},set:function(e){this.collisionMask!==e&&(this._btCollisionObject?console.warn("Cannot change the collision mask after the collision object has been created."):this._collisionMask=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"btCollisionObject",{get:function(){return this._btCollisionObject||(this._btCollisionObject=this._createCollisionObject()),this._btCollisionObject},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],i.prototype,"_collisionFlags",void 0),__decorate([paper.serializedField],i.prototype,"_collisionGroups",void 0),__decorate([paper.serializedField],i.prototype,"_collisionMask",void 0),i}(paper.BaseComponent);e.CollisionObject=t,__reflect(t.prototype,"egret3d.ammo.CollisionObject")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._margin=.05,t._btCollisionShape=null,t}return __extends(t,e),t.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this._btCollisionShape&&Ammo.destroy(this._btCollisionShape),this._btCollisionShape=null},Object.defineProperty(t.prototype,"margin",{get:function(){return this._margin},set:function(e){this._margin!==e&&(this._margin=e,this._btCollisionShape&&this._btCollisionShape.setMargin(this._margin))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"btCollisionShape",{get:function(){return this._btCollisionShape||(this._btCollisionShape=this._createCollisionShape()),this._btCollisionShape},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],t.prototype,"_margin",void 0),t}(paper.BaseComponent);e.CollisionShape=t,__reflect(t.prototype,"egret3d.ammo.CollisionShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._upAxis=1,t._radius=1,t._height=1,t._scale=e.Vector3.ONE.clone(),t}return __extends(n,i),n.prototype._createCollisionShape=function(){var e;switch(this._upAxis){case 0:e=new Ammo.btCapsuleShapeX(this._radius,this._height);break;case 1:default:e=new Ammo.btCapsuleShape(this._radius,this._height);break;case 2:e=new Ammo.btCapsuleShapeZ(this._radius,this._height)}return e.setMargin(this._margin),this._updateScale(e),e},n.prototype._updateScale=function(e){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._scale.x,this._scale.y,this._scale.z),e.setLocalScaling(i)},Object.defineProperty(n.prototype,"upAxis",{get:function(){return this._upAxis},set:function(e){this._upAxis!==e&&(this._btCollisionShape?console.warn("Cannot change the up axis after the collision shape has been created."):this._upAxis=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._btCollisionShape?console.warn("Cannot change the radius after the collision shape has been created."):this._radius=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height!==e&&(this._btCollisionShape?console.warn("Cannot change the height after the collision shape has been created."):this._height=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale.copy(e),this._btCollisionShape&&this._updateScale(this._btCollisionShape)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_upAxis",void 0),__decorate([paper.serializedField],n.prototype,"_radius",void 0),__decorate([paper.serializedField],n.prototype,"_height",void 0),__decorate([paper.serializedField],n.prototype,"_scale",void 0),n}(t.CollisionShape);t.CapsuleShape=i,__reflect(i.prototype,"egret3d.ammo.CapsuleShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t.collisionObjectType=3,t._mass=1,t._friction=.5,t._rollingFriction=0,t._linearDamping=.1,t._angularDamping=.1,t._additionalDamping=!1,t._additionalLinearDampingFactor=.005,t._additionalLinearDampingThresholdSqr=.01,t._additionalAngularDampingFactor=.01,t._additionalAngularDampingThresholdSqr=.01,t._restitution=0,t._linearSleepingThreshold=.8,t._angularSleepingThreshold=1,t._linearFactor=e.Vector3.ONE.clone(),t._angularFactor=e.Vector3.ONE.clone(),t._localInertia=e.Vector3.ZERO.clone(),t}return __extends(n,i),n.prototype._createCollisionObject=function(){var e=new Ammo.btRigidBodyConstructionInfo;e.set_m_friction(this._friction),e.set_m_rollingFriction(this._rollingFriction),e.set_m_linearDamping(this._linearDamping),e.set_m_angularDamping(this._angularDamping),e.set_m_restitution(this._restitution),e.set_m_linearSleepingThreshold(this._linearSleepingThreshold),e.set_m_angularSleepingThreshold(this._angularSleepingThreshold),e.set_m_additionalDamping(this._additionalDamping),e.set_m_additionalDampingFactor(this._additionalLinearDampingFactor),e.set_m_additionalLinearDampingThresholdSqr(this._additionalLinearDampingThresholdSqr),e.set_m_additionalAngularDampingFactor(this._additionalAngularDampingFactor),e.set_m_additionalAngularDampingThresholdSqr(this._additionalAngularDampingThresholdSqr);var t=new Ammo.btRigidBody(e),i=new Ammo.btDefaultMotionState(this._getBTTransform());return t.setCollisionFlags(this._collisionFlags),t.setMotionState(i),t.setUserPointer(this._btPointer),this._btPointer.egretComponent=this,Ammo.destroy(e),t},n.prototype._updateMass=function(){var e=t.PhysicsSystem.helpVector3A;if(this._mass>0&&this.isDynamic()){var i=this.gameObject.getComponent(t.CollisionShape,!0);e.setValue(this._localInertia.x,this._localInertia.y,this._localInertia.z),i.btCollisionShape.calculateLocalInertia(this._mass,e),this._localInertia.set(e.x(),e.y(),e.z()),this.btRigidbody.setMassProps(this._mass,e),this.btRigidbody.setActivationState(4)}else this._localInertia.set(0,0,0),e.setValue(0,0,0),this.btRigidbody.setMassProps(0,e),this.btRigidbody.setActivationState(0)},Object.defineProperty(n.prototype,"collisionFlags",{get:function(){return this._collisionFlags},set:function(e){this._collisionFlags!==e&&(this._collisionFlags=e,this._btCollisionObject&&(this._btCollisionObject.setCollisionFlags(this._collisionFlags),this._updateMass()))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mass",{get:function(){return this._mass},set:function(e){this._mass!==e&&(this._mass=e,this._btCollisionObject&&this._updateMass())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"friction",{get:function(){return this._friction},set:function(e){this._friction!==e&&(this._friction=e,this._btCollisionObject&&this.btRigidbody.setFriction(this._friction))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rollingFriction",{get:function(){return this._rollingFriction},set:function(e){this._rollingFriction!==e&&(this._rollingFriction=e,this._btCollisionObject&&this.btRigidbody.setRollingFriction(this._rollingFriction))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"linearDamping",{get:function(){return this._linearDamping},set:function(e){this._linearDamping!==e&&(this._linearDamping=e,this._btCollisionObject&&this.btRigidbody.setDamping(this._linearDamping,this._angularDamping))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"angularDamping",{get:function(){return this._angularDamping},set:function(e){this._angularDamping!==e&&(this._angularDamping=e,this._btCollisionObject&&this.btRigidbody.setDamping(this._linearDamping,this._angularDamping))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"additionalDamping",{get:function(){return this._additionalDamping},set:function(e){this._additionalDamping!==e&&(this._btCollisionObject?console.warn("Cannot change the additionalDamping after the collision object has been created."):this._additionalDamping=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"additionalLinearDampingFactor",{get:function(){return this._additionalLinearDampingFactor},set:function(e){this._additionalLinearDampingFactor!==e&&(this._btCollisionObject?console.warn("Cannot change the additionalLinearDampingFactor after the collision object has been created."):this._additionalLinearDampingFactor=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"additionalLinearDampingThresholdSqr",{get:function(){return this._additionalLinearDampingThresholdSqr},set:function(e){this._additionalLinearDampingThresholdSqr!==e&&(this._btCollisionObject?console.warn("Cannot change the additionalLinearDampingThresholdSqr after the collision object has been created."):this._additionalLinearDampingThresholdSqr=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"additionalAngularDampingFactor",{get:function(){return this._additionalAngularDampingFactor},set:function(e){this._additionalAngularDampingFactor!==e&&(this._btCollisionObject?console.warn("Cannot change the additionalAngularDampingFactor after the collision object has been created."):this._additionalAngularDampingFactor=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"additionalAngularDampingThresholdSqr",{get:function(){return this._additionalAngularDampingThresholdSqr},set:function(e){this._additionalAngularDampingThresholdSqr!==e&&(this._btCollisionObject?console.warn("Cannot change the additionalAngularDampingThresholdSqr after the collision object has been created."):this._additionalAngularDampingThresholdSqr=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"restitution",{get:function(){return this._restitution},set:function(e){this._restitution!==e&&(this._restitution=e,this._btCollisionObject&&this.btRigidbody.setRestitution(this._restitution))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"linearSleepingThreshold",{get:function(){return this._linearSleepingThreshold},set:function(e){this._linearSleepingThreshold!==e&&(this._linearSleepingThreshold=e,this._btCollisionObject&&this.btRigidbody.setSleepingThresholds(this._linearSleepingThreshold,this._angularSleepingThreshold))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"angularSleepingThreshold",{get:function(){return this._angularSleepingThreshold},set:function(e){this._angularSleepingThreshold!==e&&(this._angularSleepingThreshold=e,this._btCollisionObject&&this.btRigidbody.setSleepingThresholds(this._linearSleepingThreshold,this._angularSleepingThreshold))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"linearFactor",{get:function(){return this._linearFactor},set:function(e){if(this._linearFactor.copy(e),this._btCollisionObject){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._linearFactor.x,this._linearFactor.y,this._linearFactor.z),this.btRigidbody.setLinearFactor(i)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"angularFactor",{get:function(){return this._angularFactor},set:function(e){if(this._angularFactor.copy(e),this._btCollisionObject){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._angularFactor.x,this._angularFactor.y,this._angularFactor.z),this.btRigidbody.setAngularFactor(i)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"localInertia",{get:function(){return this._localInertia},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"btRigidbody",{get:function(){return this._btCollisionObject},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_mass",void 0),__decorate([paper.serializedField],n.prototype,"_friction",void 0),__decorate([paper.serializedField],n.prototype,"_rollingFriction",void 0),__decorate([paper.serializedField],n.prototype,"_linearDamping",void 0),__decorate([paper.serializedField],n.prototype,"_angularDamping",void 0),__decorate([paper.serializedField],n.prototype,"_additionalDamping",void 0),__decorate([paper.serializedField],n.prototype,"_additionalLinearDampingFactor",void 0),__decorate([paper.serializedField],n.prototype,"_additionalLinearDampingThresholdSqr",void 0),__decorate([paper.serializedField],n.prototype,"_additionalAngularDampingFactor",void 0),__decorate([paper.serializedField],n.prototype,"_additionalAngularDampingThresholdSqr",void 0),__decorate([paper.serializedField],n.prototype,"_restitution",void 0),__decorate([paper.serializedField],n.prototype,"_linearSleepingThreshold",void 0),__decorate([paper.serializedField],n.prototype,"_angularSleepingThreshold",void 0),__decorate([paper.serializedField],n.prototype,"_linearFactor",void 0),__decorate([paper.serializedField],n.prototype,"_angularFactor",void 0),n}(t.CollisionObject);t.Rigidbody=i,__reflect(i.prototype,"egret3d.ammo.Rigidbody")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var e=null!==i&&i.apply(this,arguments)||this;return e._swingSpan1=Math.PI,e._swingSpan2=Math.PI,e._twistSpan=Math.PI,e._softness=.5,e._biasFactor=.3,e._relaxationFactor=1,e}return __extends(n,i),n.prototype._updateLimit=function(e){e.setLimit(5,this._swingSpan1),e.setLimit(4,this._swingSpan2),e.setLimit(3,this._twistSpan)},n.prototype._createConstraint=function(){var i=this.gameObject.getComponent(t.Rigidbody);if(!i)return console.debug("Never."),null;var n,o=t.PhysicsSystem.helpVector3A,r=t.PhysicsSystem.helpQuaternionA,a=t.PhysicsSystem.helpTransformA,s=t.PhysicsSystem.helpTransformB,l=t.TypedConstraint._helpMatrixA,c=t.TypedConstraint._helpMatrixB;if(1===this._constraintType){if(!this._connectedBody)return console.error("The constraint need to config another rigid body.",this.gameObject.name,this.gameObject.uuid),null;this._createFrames(l,c);var p=e.Matrix.getQuaternion(l,t.TypedConstraint._helpQuaternionA);o.setValue(l.rawData[12],l.rawData[13],l.rawData[14]),r.setValue(p.x,p.y,p.z,p.w),a.setIdentity(),a.setOrigin(o),a.setRotation(r);var h=e.Matrix.getQuaternion(c,t.TypedConstraint._helpQuaternionA);o.setValue(c.rawData[12],c.rawData[13],c.rawData[14]),r.setValue(h.x,h.y,h.z,h.w),s.setIdentity(),s.setOrigin(o),s.setRotation(r),n=new Ammo.btConeTwistConstraint(i.btRigidbody,this._connectedBody.btRigidbody,a,s)}else{this._createFrame(this._axisX,this._axisY,this._anchor,l);var p=e.Matrix.getQuaternion(l,t.TypedConstraint._helpQuaternionA);o.setValue(l.rawData[8],l.rawData[9],l.rawData[10]),r.setValue(p.x,p.y,p.z,p.w),a.setIdentity(),a.setOrigin(o),a.setRotation(r),n=new Ammo.btConeTwistConstraint(i.btRigidbody,a)}return n.setBreakingImpulseThreshold(this._breakingImpulseThreshold),this._updateLimit(n),n},Object.defineProperty(n.prototype,"swingSpan1",{get:function(){return this._swingSpan1},set:function(e){0>=e&&(e=1e-6),this._swingSpan1!==e&&(this._swingSpan1=e,this._btTypedConstraint&&this._btTypedConstraint.setLimit(5,this._swingSpan1))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"swingSpan2",{get:function(){return this._swingSpan2},set:function(e){0>=e&&(e=1e-6),this._swingSpan2!==e&&(this._swingSpan2=e,this._btTypedConstraint&&this._btTypedConstraint.setLimit(4,this._swingSpan2))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"twistSpan",{get:function(){return this._twistSpan},set:function(e){0>=e&&(e=1e-6),this._twistSpan!==e&&(this._twistSpan=e,this._btTypedConstraint&&this._btTypedConstraint.setLimit(3,this._twistSpan))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"softness",{get:function(){return this._softness},set:function(e){this.softness!==e&&(this._softness=e,this._btTypedConstraint)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"biasFactor",{get:function(){return this._biasFactor},set:function(e){this._biasFactor!==e&&(this._biasFactor=e,this._btTypedConstraint)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relaxationFactor",{get:function(){return this._relaxationFactor},set:function(e){this._relaxationFactor!==e&&(this._relaxationFactor=e,this._btTypedConstraint)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_swingSpan1",void 0),__decorate([paper.serializedField],n.prototype,"_swingSpan2",void 0),__decorate([paper.serializedField],n.prototype,"_twistSpan",void 0),__decorate([paper.serializedField],n.prototype,"_softness",void 0),__decorate([paper.serializedField],n.prototype,"_biasFactor",void 0),__decorate([paper.serializedField],n.prototype,"_relaxationFactor",void 0),n}(t.TypedConstraint);t.ConeTwistConstraint=i,__reflect(i.prototype,"egret3d.ammo.ConeTwistConstraint")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){return null!==i&&i.apply(this,arguments)||this}return __extends(n,i),n.prototype._createConstraint=function(){if(this._rigidbody=this.gameObject.getComponent(t.Rigidbody),!this._rigidbody)return console.debug("Never."),null;if(!this._connectedBody)return console.error("The constraint need to config another rigid body.",this.gameObject.name,this.gameObject.uuid),null;var i=t.TypedConstraint._helpMatrixA,n=t.TypedConstraint._helpMatrixB;this._createFrames(i,n);var o=t.PhysicsSystem.helpVector3A,r=t.PhysicsSystem.helpQuaternionA,a=t.PhysicsSystem.helpTransformA,s=t.PhysicsSystem.helpTransformB,l=e.Matrix.getQuaternion(i,t.TypedConstraint._helpQuaternionA);o.setValue(i.rawData[12],i.rawData[13],i.rawData[14]),r.setValue(l.x,l.y,l.z,l.w),a.setIdentity(),a.setOrigin(o),a.setRotation(r);var c=e.Matrix.getQuaternion(n,t.TypedConstraint._helpQuaternionA);o.setValue(n.rawData[12],n.rawData[13],n.rawData[14]),r.setValue(c.x,c.y,c.z,c.w),s.setIdentity(),s.setOrigin(o),s.setRotation(r);var p=new Ammo.btFixedConstraint(this._rigidbody.btRigidbody,this._connectedBody.btRigidbody,a,s);return p.setBreakingImpulseThreshold(this._breakingImpulseThreshold),p},n}(t.TypedConstraint);t.FixedConstraint=i,__reflect(i.prototype,"egret3d.ammo.FixedConstraint")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._motorEnabled=!1,e._limitEnabled=!1,e._targetVelocity=0,e._maxMotorImpulse=0,e._lowAngular=0,e._highAngular=0,e._softness=.9,e._biasFactor=.3,e._relaxationFactor=0,e}return __extends(i,t),i.prototype._updateLimit=function(){this._btTypedConstraint.setLimit(this._lowAngular,this._highAngular,this._softness,this._biasFactor,this._relaxationFactor)},i.prototype._createConstraint=function(){if(this._rigidbody=this.gameObject.getComponent(e.Rigidbody),!this._rigidbody)return console.debug("Never."),null;var t;if(1===this._constraintType){if(!this._connectedBody)return console.error("The constraint need to config another rigid body.",this.gameObject.name,this.gameObject.uuid),null;var i=e.TypedConstraint._helpMatrixA,n=e.TypedConstraint._helpMatrixB;this._createFrames(i,n);var o=e.PhysicsSystem.helpVector3A,r=e.PhysicsSystem.helpVector3B,a=e.PhysicsSystem.helpVector3C,s=e.PhysicsSystem.helpVector3D;o.setValue(i.rawData[12],i.rawData[13],i.rawData[14]),r.setValue(n.rawData[12],n.rawData[13],n.rawData[14]),a.setValue(i.rawData[0],i.rawData[4],i.rawData[8]),s.setValue(n.rawData[0],n.rawData[4],n.rawData[8]),t=new Ammo.btHingeConstraint(this._rigidbody.btRigidbody,this._connectedBody.btRigidbody,o,r,a,s,!0)}else{var o=e.PhysicsSystem.helpVector3A,r=e.PhysicsSystem.helpVector3B;o.setValue(this._anchor.x,this._anchor.y,this._anchor.z),r.setValue(this._axisX.x,this._axisX.y,this._axisX.z),t=new Ammo.btHingeConstraint(this._rigidbody.btRigidbody,o,r,!0)}return this._motorEnabled&&t.enableAngularMotor(this._motorEnabled,this._targetVelocity,this._maxMotorImpulse),this._limitEnabled&&this._updateLimit(),t.setBreakingImpulseThreshold(this._breakingImpulseThreshold),t},Object.defineProperty(i.prototype,"motorEnabled",{get:function(){return this._motorEnabled},set:function(e){this._motorEnabled!==e&&(this._motorEnabled=e,this._btTypedConstraint&&this._btTypedConstraint.enableMotor(this._motorEnabled))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"targetVelocity",{get:function(){return this._targetVelocity},set:function(e){this._targetVelocity!==e&&(this._targetVelocity=e,this._btTypedConstraint&&this._motorEnabled&&this._btTypedConstraint.enableAngularMotor(this._motorEnabled,this._targetVelocity,this._maxMotorImpulse))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxMotorImpulse",{get:function(){return this._maxMotorImpulse},set:function(e){this._maxMotorImpulse!==e&&(this._maxMotorImpulse=e,this._btTypedConstraint&&this._motorEnabled&&this._btTypedConstraint.setMaxMotorImpulse(this._maxMotorImpulse))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"limitEnabled",{get:function(){return this._limitEnabled},set:function(e){this._limitEnabled!==e&&(this._limitEnabled=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lowAngularLimit",{get:function(){return this._lowAngular},set:function(e){this._lowAngular!==e&&(this._lowAngular=e,this._btTypedConstraint&&this._limitEnabled&&this._updateLimit())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"highAngularLimit",{get:function(){return this._highAngular},set:function(e){this._highAngular!==e&&(this._highAngular=e,this._btTypedConstraint&&this._limitEnabled&&this._updateLimit())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"softnessLimit",{get:function(){return this._softness},set:function(e){this._softness!==e&&(this._softness=e,this._btTypedConstraint&&this._limitEnabled&&this._updateLimit())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"biasFactorLimit",{get:function(){return this._biasFactor},set:function(e){this._biasFactor!==e&&(this._biasFactor=e,this._btTypedConstraint&&this._limitEnabled&&this._updateLimit())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"relaxationFactor",{get:function(){return this._relaxationFactor
},set:function(e){this._relaxationFactor!==e&&(this._relaxationFactor=e,this._btTypedConstraint&&this._limitEnabled&&this._updateLimit())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hingeAngle",{get:function(){return this._btTypedConstraint?this._btTypedConstraint.getHingeAngle():0},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],i.prototype,"_motorEnabled",void 0),__decorate([paper.serializedField],i.prototype,"_limitEnabled",void 0),__decorate([paper.serializedField],i.prototype,"_targetVelocity",void 0),__decorate([paper.serializedField],i.prototype,"_maxMotorImpulse",void 0),__decorate([paper.serializedField],i.prototype,"_lowAngular",void 0),__decorate([paper.serializedField],i.prototype,"_highAngular",void 0),__decorate([paper.serializedField],i.prototype,"_softness",void 0),__decorate([paper.serializedField],i.prototype,"_biasFactor",void 0),__decorate([paper.serializedField],i.prototype,"_relaxationFactor",void 0),i}(e.TypedConstraint);e.HingeConstraint=t,__reflect(t.prototype,"egret3d.ammo.HingeConstraint")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var e=null!==i&&i.apply(this,arguments)||this;return e._lowerLinearLimit=-10,e._upperLinearLimit=10,e._lowerAngularLimit=-Math.PI,e._upperAngularLimit=Math.PI,e}return __extends(n,i),n.prototype._createConstraint=function(){if(this._rigidbody=this.gameObject.getComponent(t.Rigidbody),!this._rigidbody)return console.debug("Never."),null;var i,n=t.PhysicsSystem.helpVector3A,o=t.PhysicsSystem.helpQuaternionA,r=t.PhysicsSystem.helpTransformA,a=t.PhysicsSystem.helpTransformB,s=t.TypedConstraint._helpMatrixA,l=t.TypedConstraint._helpMatrixB;if(1===this._constraintType){if(!this._connectedBody)return console.error("The constraint need to config another rigid body.",this.gameObject.name,this.gameObject.uuid),null;this._createFrames(s,l);var c=e.Matrix.getQuaternion(s,t.TypedConstraint._helpQuaternionA);n.setValue(s.rawData[8],s.rawData[9],s.rawData[10]),o.setValue(c.x,c.y,c.z,c.w),r.setIdentity(),r.setOrigin(n),r.setRotation(o);var p=e.Matrix.getQuaternion(l,t.TypedConstraint._helpQuaternionA);n.setValue(l.rawData[8],l.rawData[9],l.rawData[10]),o.setValue(p.x,p.y,p.z,p.w),a.setIdentity(),a.setOrigin(n),a.setRotation(o),i=new Ammo.btSliderConstraint(this._rigidbody.btRigidbody,this._connectedBody.btRigidbody,r,a,!0)}else{this._createFrame(this._axisX,this._axisY,this._anchor,s);var c=e.Matrix.getQuaternion(s,t.TypedConstraint._helpQuaternionA);n.setValue(s.rawData[8],s.rawData[9],s.rawData[10]),o.setValue(c.x,c.y,c.z,c.w),r.setIdentity(),r.setOrigin(n),r.setRotation(o),i=new Ammo.btSliderConstraint(this._rigidbody.btRigidbody,r,!0)}return i.setLowerLinLimit(this._lowerLinearLimit),i.setUpperLinLimit(this._upperLinearLimit),i.setLowerAngLimit(this._lowerAngularLimit),i.setUpperAngLimit(this._upperAngularLimit),i.setBreakingImpulseThreshold(this._breakingImpulseThreshold),i},Object.defineProperty(n.prototype,"lowerLinearLimit",{get:function(){return this._lowerLinearLimit},set:function(e){this._lowerLinearLimit!==e&&(this._lowerLinearLimit=e,this._btTypedConstraint&&this._btTypedConstraint.setLowerLinLimit(this._lowerLinearLimit))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"upperLinearLimit",{get:function(){return this._upperLinearLimit},set:function(e){this._upperLinearLimit!==e&&(this._upperLinearLimit=e,this._btTypedConstraint&&this._btTypedConstraint.setUpperLinLimit(this._upperLinearLimit))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lowerAngularLimit",{get:function(){return this._lowerAngularLimit},set:function(e){this._lowerAngularLimit!==e&&(this._lowerAngularLimit=e,this._btTypedConstraint&&this._btTypedConstraint.setLowerAngLimit(this._lowerAngularLimit))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"upperAngularLimit",{get:function(){return this._upperAngularLimit},set:function(e){this._upperAngularLimit!==e&&(this._upperAngularLimit=e,this._btTypedConstraint&&this._btTypedConstraint.setUpperAngLimit(this._upperAngularLimit))},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_lowerLinearLimit",void 0),__decorate([paper.serializedField],n.prototype,"_upperLinearLimit",void 0),__decorate([paper.serializedField],n.prototype,"_lowerAngularLimit",void 0),__decorate([paper.serializedField],n.prototype,"_upperAngularLimit",void 0),n}(t.TypedConstraint);t.SliderConstraint=i,__reflect(i.prototype,"egret3d.ammo.SliderConstraint")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.collisionObjectType=4,t._prevCollisionObjects=[],t._currentCollisionObjects=[],t}return __extends(t,e),t.prototype._createCollisionObject=function(){var e=new Ammo.btGhostObject;return e.setWorldTransform(this._getBTTransform()),e.setCollisionFlags(this._collisionFlags),e.setUserPointer(this._btPointer),this._btPointer.egretComponent=this,e},t.prototype.initialize=function(){e.prototype.initialize.call(this),this._collisionFlags=4},Object.defineProperty(t.prototype,"collisionFlags",{set:function(e){console.warn("Cannot set the collision flags of ghost gbject.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"btGhostObject",{get:function(){return this._btCollisionObject},enumerable:!0,configurable:!0}),t}(e.CollisionObject);e.GhostObject=t,__reflect(t.prototype,"egret3d.ammo.GhostObject")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._size=e.Vector3.ONE.clone(),t._scale=e.Vector3.ONE.clone(),t}return __extends(n,i),n.prototype._createCollisionShape=function(){var e=t.PhysicsSystem.helpVector3A;e.setValue(.5*this._size.x,.5*this._size.y,.5*this._size.z);var i=new Ammo.btBoxShape(e);return i.setMargin(this._margin),this._updateScale(i),i},n.prototype._updateScale=function(e){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._scale.x,this._scale.y,this._scale.z),e.setLocalScaling(i)},Object.defineProperty(n.prototype,"size",{get:function(){return this._size},set:function(e){this._btCollisionShape?console.warn("Cannot change the size after the collision shape has been created.\nSize is only the initial value.\nUse scale to change the shape of a collision shape."):this._size.copy(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale.copy(e),this._btCollisionShape&&this._updateScale(this._btCollisionShape)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_size",void 0),__decorate([paper.serializedField],n.prototype,"_scale",void 0),n}(t.CollisionShape);t.BoxShape=i,__reflect(i.prototype,"egret3d.ammo.BoxShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype._createConstraint=function(){if(this._rigidbody=this.gameObject.getComponent(e.Rigidbody),!this._rigidbody)return console.debug("Never."),null;var t,i=e.PhysicsSystem.helpVector3A,n=e.PhysicsSystem.helpVector3B;if(i.setValue(this._anchor.x,this._anchor.y,this._anchor.z),1===this._constraintType){if(!this._connectedBody)return console.error("The constraint need to config another rigid body.",this.gameObject.name,this.gameObject.uuid),null;var o=helpMatrixA.copy(this._connectedBody.gameObject.transform.getWorldMatrix()).inverse().transformVector3(this._rigidbody.gameObject.transform.getWorldMatrix().transformVector3(e.TypedConstraint._helpVector3A.copy(this._anchor)));n.setValue(o.x,o.y,o.z),t=new Ammo.btPoint2PointConstraint(this._rigidbody.btRigidbody,this._connectedBody.btRigidbody,i,n)}else t=new Ammo.btPoint2PointConstraint(this._rigidbody.btRigidbody,i);return t.setBreakingImpulseThreshold(this._breakingImpulseThreshold),t},i}(e.TypedConstraint);e.BallSocketConstraint=t,__reflect(t.prototype,"egret3d.ammo.BallSocketConstraint")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var n=null!==i&&i.apply(this,arguments)||this;return n._interests=[{componentClass:t.Rigidbody},{componentClass:[t.BoxShape,t.CapsuleShape,t.ConeShape,t.ConvexHullShape,t.CylinderShape,t.HeightfieldTerrainShape,t.SphereShape],type:4},{componentClass:[t.FixedConstraint,t.SliderConstraint,t.HingeConstraint,t.ConeTwistConstraint],type:4}],n._worldType=1,n._collisionType=0,n._broadphaseType=0,n._axis3SweepBroadphaseMin=new e.Vector3(-1e3,-1e3,-1e3),n._axis3SweepBroadphaseMax=new e.Vector3(1e3,1e3,1e3),n._gravity=new e.Vector3(0,-9.8,0),n._btCollisionWorld=null,n._btDynamicsWorld=null,n}return __extends(n,i),Object.defineProperty(n,"helpVector3A",{get:function(){return this._helpVector3A||(this._helpVector3A=new Ammo.btVector3),this._helpVector3A},enumerable:!0,configurable:!0}),Object.defineProperty(n,"helpVector3B",{get:function(){return this._helpVector3B||(this._helpVector3B=new Ammo.btVector3),this._helpVector3B},enumerable:!0,configurable:!0}),Object.defineProperty(n,"helpVector3C",{get:function(){return this._helpVector3C||(this._helpVector3C=new Ammo.btVector3),this._helpVector3C},enumerable:!0,configurable:!0}),Object.defineProperty(n,"helpVector3D",{get:function(){return this._helpVector3D||(this._helpVector3D=new Ammo.btVector3),this._helpVector3D},enumerable:!0,configurable:!0}),Object.defineProperty(n,"helpQuaternionA",{get:function(){return this._helpQuaternionA||(this._helpQuaternionA=new Ammo.btQuaternion),this._helpQuaternionA},enumerable:!0,configurable:!0}),Object.defineProperty(n,"helpTransformA",{get:function(){return this._helpTransformA||(this._helpTransformA=new Ammo.btTransform),this._helpTransformA},enumerable:!0,configurable:!0}),Object.defineProperty(n,"helpTransformB",{get:function(){return this._helpTransformB||(this._helpTransformB=new Ammo.btTransform),this._helpTransformB},enumerable:!0,configurable:!0}),n.prototype._updateGravity=function(){var e=n.helpVector3A;e.setValue(this._gravity.x,this._gravity.y,this._gravity.z),this._btDynamicsWorld.setGravity(e)},n.prototype.onAwake=function(){var e=new Ammo.btDefaultCollisionConfiguration,t=new Ammo.btCollisionDispatcher(e),i=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;this._btCollisionWorld=new Ammo.btDiscreteDynamicsWorld(t,i,n,e),this._btDynamicsWorld=this._btCollisionWorld,this._btDynamicsWorld&&this._updateGravity()},n.prototype.onAddGameObject=function(e,i){var n=e.getComponent(t.Rigidbody),o=e.getComponent(t.CollisionShape),r=n.btCollisionObject,a=o.btCollisionShape;switch(r.setCollisionShape(a),this._worldType){case 1:2&n.collisionObjectType?(n._updateMass(),this._btDynamicsWorld.addRigidBody(n.btRigidbody,n.collisionGroups,n.collisionMask)):this._btCollisionWorld.addCollisionObject(r,n.collisionGroups,n.collisionMask);break;case 2:break;case 3:}},n.prototype.onAddComponent=function(e,t){t!==this._groups[0]},n.prototype.onUpdate=function(e){var i=this._groups[0].gameObjects,o=n.helpTransformA;this._btDynamicsWorld.stepSimulation(e,this._clock.maxFixedSubSteps,this._clock.fixedDeltaTime);for(var r=0,a=i;r<a.length;r++){var s=a[r],l=s.transform,c=s.getComponent(t.Rigidbody);if(c.isDynamic()){var p=c.btRigidbody.getMotionState();p.getWorldTransform(o);var h=o.getOrigin(),d=o.getRotation();l.setPosition(h.x(),h.y(),h.z()),l.setRotation(d.x(),d.y(),d.z(),d.w())}}},Object.defineProperty(n.prototype,"gravity",{get:function(){return this._gravity},set:function(e){this._gravity.copy(e),this._btDynamicsWorld&&this._updateGravity()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"btCollisionWorld",{get:function(){return this._btCollisionWorld},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"btDynamicsWorld",{get:function(){return this._btDynamicsWorld},enumerable:!0,configurable:!0}),n._helpVector3A=null,n._helpVector3B=null,n._helpVector3C=null,n._helpVector3D=null,n._helpQuaternionA=null,n._helpTransformA=null,n._helpTransformB=null,n}(paper.BaseSystem);t.PhysicsSystem=i,__reflect(i.prototype,"egret3d.ammo.PhysicsSystem")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._upAxis=1,t._radius=1,t._height=1,t._scale=e.Vector3.ONE.clone(),t}return __extends(n,i),n.prototype._createCollisionShape=function(){var e;switch(this._upAxis){case 0:e=new Ammo.btConeShapeX(this._radius,this._height);break;case 1:default:e=new Ammo.btConeShape(this._radius,this._height);break;case 2:e=new Ammo.btConeShapeZ(this._radius,this._height)}return e.setMargin(this._margin),this._updateScale(e),e},n.prototype._updateScale=function(e){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._scale.x,this._scale.y,this._scale.z),e.setLocalScaling(i)},Object.defineProperty(n.prototype,"upAxis",{get:function(){return this._upAxis},set:function(e){this._upAxis!==e&&(this._btCollisionShape?console.warn("Cannot change the up axis after the collision shape has been created."):this._upAxis=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._btCollisionShape?console.warn("Cannot change the radius after the collision shape has been created."):this._radius=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},set:function(e){this._height!==e&&(this._btCollisionShape?console.warn("Cannot change the height after the collision shape has been created."):this._height=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale.copy(e),this._btCollisionShape&&this._updateScale(this._btCollisionShape)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_upAxis",void 0),__decorate([paper.serializedField],n.prototype,"_radius",void 0),__decorate([paper.serializedField],n.prototype,"_height",void 0),__decorate([paper.serializedField],n.prototype,"_scale",void 0),n}(t.CollisionShape);t.ConeShape=i,__reflect(i.prototype,"egret3d.ammo.ConeShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._scale=e.Vector3.ONE.clone(),t}return __extends(n,i),n.prototype._createCollisionShape=function(){var i=this.gameObject.getComponent(e.MeshFilter);if(i&&i.mesh){for(var n=t.PhysicsSystem.helpVector3A,o=new Ammo.btConvexHullShape,r=i.mesh.getVertices(),a=0,s=r.length;s>a;a+=3)n.setValue(r[a],r[a+1],r[a+2]),o.addPoint(n,a===s-1);return o.setMargin(this._margin),this._updateScale(o),o}throw new Error("Arguments error.")},n.prototype._updateScale=function(e){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._scale.x,this._scale.y,this._scale.z),e.setLocalScaling(i)},Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale.copy(e),this._btCollisionShape&&this._updateScale(this._btCollisionShape)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_scale",void 0),n}(t.CollisionShape);t.ConvexHullShape=i,__reflect(i.prototype,"egret3d.ammo.ConvexHullShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._upAxis=1,t._size=e.Vector3.ONE.clone(),t._scale=e.Vector3.ONE.clone(),t}return __extends(n,i),n.prototype._createCollisionShape=function(){var e=t.PhysicsSystem.helpVector3A;e.setValue(.5*this._size.x,.5*this._size.y,.5*this._size.z);var i;switch(this._upAxis){case 0:i=new Ammo.btCylinderShapeX(e);break;case 1:default:i=new Ammo.btCylinderShape(e);break;case 2:i=new Ammo.btCylinderShapeZ(e)}return i.setMargin(this._margin),this._updateScale(i),i},n.prototype._updateScale=function(e){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._scale.x,this._scale.y,this._scale.z),e.setLocalScaling(i)},Object.defineProperty(n.prototype,"upAxis",{get:function(){return this._upAxis},set:function(e){this._upAxis!==e&&(this._btCollisionShape?console.warn("Cannot change the up axis after the collision shape has been created."):this._upAxis=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._size},set:function(e){this._btCollisionShape?console.warn("Cannot change the size after the collision shape has been created.\nSize is only the initial value.\nUse scale to change the shape of a collision shape."):this._size.copy(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale.copy(e),this._btCollisionShape&&this._updateScale(this._btCollisionShape)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_upAxis",void 0),__decorate([paper.serializedField],n.prototype,"_size",void 0),__decorate([paper.serializedField],n.prototype,"_scale",void 0),n}(t.CollisionShape);t.CylinderShape=i,__reflect(i.prototype,"egret3d.ammo.CylinderShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._upAxis=1,e}return __extends(i,t),i.prototype._createCollisionShape=function(){var t=this.gameObject.getComponent(e.MeshFilter);if(t&&t.mesh){var i=(t.mesh.getVertices(),new Ammo.btHeightfieldTerrainShape(0,0,null,1,0,1,this._upAxis,"PHY_FLOAT",!1));return i.setMargin(this._margin),i}throw new Error("Arguments error.")},Object.defineProperty(i.prototype,"upAxis",{get:function(){return this._upAxis},set:function(e){this._upAxis!==e&&(this._btCollisionShape?console.warn("Cannot change the up axis after the collision shape has been created."):this._upAxis=e)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],i.prototype,"_upAxis",void 0),i}(t.CollisionShape);t.HeightfieldTerrainShape=i,__reflect(i.prototype,"egret3d.ammo.HeightfieldTerrainShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));var egret3d;!function(e){var t;!function(t){var i=function(i){function n(){var t=null!==i&&i.apply(this,arguments)||this;return t._radius=1,t._scale=e.Vector3.ONE.clone(),t}return __extends(n,i),n.prototype._createCollisionShape=function(){var e=new Ammo.btSphereShape(this._radius);return e.setMargin(this._margin),this._updateScale(e),e},n.prototype._updateScale=function(e){var i=t.PhysicsSystem.helpVector3A;i.setValue(this._scale.x,this._scale.y,this._scale.z),e.setLocalScaling(i)},Object.defineProperty(n.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius!==e&&(this._btCollisionShape?console.warn("Cannot change the radius after the collision shape has been created."):this._radius=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale.copy(e),this._btCollisionShape&&this._updateScale(this._btCollisionShape)},enumerable:!0,configurable:!0}),__decorate([paper.serializedField],n.prototype,"_radius",void 0),__decorate([paper.serializedField],n.prototype,"_scale",void 0),n}(t.CollisionShape);t.SphereShape=i,__reflect(i.prototype,"egret3d.ammo.SphereShape")}(t=e.ammo||(e.ammo={}))}(egret3d||(egret3d={}));